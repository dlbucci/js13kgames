<script>document.addEventListener("DOMContentLoaded",async()=>{function H(){h.width=window.innerWidth;h.height=window.innerHeight}function u(b,c){function d(g,l){g=a.createShader(g);a.shaderSource(g,l);a.compileShader(g);return a.getShaderParameter(g,a.COMPILE_STATUS)?g:(console.error("Shader compile error:",a.getShaderInfoLog(g)),a.deleteShader(g),null)}b=d(a.VERTEX_SHADER,b);c=d(a.FRAGMENT_SHADER,c);const f=a.createProgram();a.attachShader(f,b);a.attachShader(f,c);a.linkProgram(f);if(!a.getProgramParameter(f,
a.LINK_STATUS))return console.error("Program link error:",a.getProgramInfoLog(f)),a.deleteProgram(f),null;a.uniformBlockBinding(f,a.getUniformBlockIndex(f,"U"),0);return f}function I(b){a.bindFramebuffer(a.FRAMEBUFFER,null);a.clear(a.COLOR_BUFFER_BIT);a.viewport(0,0,h.width,h.height);v.set([h.width,h.height]);m.x(b,!0)}function J(b){requestAnimationFrame(J);e||(w[0]=b,m.y(),I(!0))}function K(b,c){e.requestAnimationFrame(K);w[0]=b;m.y();if(c=c.getViewerPose(e.g)){b=e.renderState.baseLayer;a.bindFramebuffer(a.FRAMEBUFFER,
b.framebuffer);a.clear(a.COLOR_BUFFER_BIT);for(const d of c.views)c=b.getViewport(d),a.viewport(c.x,c.y,c.width,c.height),v.set([c.width,c.height]),L.set(d.projectionMatrix),M.set(d.transform.inverse.matrix),m.x(!1,!1);I(!1)}}const n=new AudioContext,N=new GainNode(n);N.connect(n.destination);document.body.style.cssText="margin:0;padding:0";const p=document.createElement("button");p.textContent="Enter VR";p.style.cssText="position:absolute;margin:25";document.body.appendChild(p);const h=document.createElement("canvas");
document.body.appendChild(h);const a=h.getContext("webgl2",{h:!0});a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);let e=null;H();window.onresize=H;const x=[u("#version 300 es\nprecision mediump float;layout(location=0)in vec3 a;layout(location=1)in vec2 b;layout(std140)uniform U{mat4 c;mat4 d;mat4 e;vec4 f;vec4 g;vec4 h;vec4 i;vec4 j;vec4 k;vec4 l;};out vec2 m;void main(){gl_Position=(c*d)*vec4(a,1.);m=b;}","#version 300 es\nprecision mediump float;in vec2 m;layout(std140)uniform U{mat4 c;mat4 d;mat4 e;vec4 f;vec4 g;vec4 h;vec4 i;vec4 j;vec4 k;vec4 l;};out vec4 n;void main(){float o=f.x;float p=(1.-f.x);p*=p*p;p=1.-p;float q=1.-abs(m.y);q=1.25*1.-q*q;q=mix(q,abs(m.y),p);float r=length(vec2(m.x,q));float s=mix(length(vec2(m.x,.6*m.y)),1.,o);float t=abs(.9-r);t=smoothstep(.1,.085,t);float u=(atan(-m.x,-m.y)/6.2831+.5);float v=t*step(u,f.x);t+=.5*smoothstep(.175,.15,s);float w=.2-.2*r;n=mix(vec4(0.,0.,0.,w),(.1+.6*v)*vec4(1.,.8,.5,1.),t);}"),
u("#version 300 es\nlayout(location=0)in vec3 a;out vec2 b;void main(){b=a.xy;gl_Position=vec4(a,1.);}","#version 300 es\nprecision mediump float;in vec2 b;layout(std140)uniform U{mat4 c;mat4 d;mat4 e;vec4 f;vec4 g;vec4 h;vec4 i;vec4 j;vec4 k;vec4 l;};out vec4 m;float n(float o,float p,float q){o=clamp(o,-1.,1.);p=clamp(p,0.,1.);q=clamp(q,0.,1.);float r=1.-2.*p;float s=(o-r)/max(2.*p,1e-9);s=clamp(s,0.,1.);float t=10.;float u=mix(6.,1.,q/.5);float v=mix(1.,1./t,(q-.5)/.5);float w=step(.5,q);float x=mix(u,v,w);return pow(s,x);}void main(){vec4 y=e*vec4(b,-1.,1.);vec4 z=e*vec4(b,1.,1.);vec3 aa=normalize((z.xyz/z.w)-(y.xyz/y.w));float ab=1.-abs(aa.y);ab=pow(ab,20.);vec3 ac=vec3(ab*.05);ac+=n(dot(normalize(g.xyz),aa),g.w,h.a)*h.rgb;ac+=n(dot(normalize(i.xyz),aa),i.w,j.a)*j.rgb;ac+=n(dot(normalize(k.xyz),aa),k.w,l.a)*l.rgb;m=vec4(ac,1.);}"),
u("#version 300 es\nlayout(location=0)in vec3 a;layout(location=1)in vec2 b;layout(location=2)in vec4 c;layout(std140)uniform U{mat4 d;mat4 e;mat4 f;vec4 g;vec4 h;vec4 i;vec4 j;vec4 k;vec4 l;vec4 m;};out vec2 n;out vec4 o;out float p;void main(){vec4 q=e*vec4(a,1.);gl_Position=d*q;n=b;o=c;p=-q.z;}","#version 300 es\nprecision mediump float;in vec2 n;in vec4 o;in float p;uniform sampler2D T;out vec4 r;void main(){float s=texture(T,n).r;float t=texture(T,n-vec2(.001,.001)).r;float u=smoothstep(50.,1.5,p);u=.9*u+.1;r=mix(vec4(0.,0.,0.,t),vec4(1.)*vec4(vec3(u),1.),s)*o;}")];
let y=!1;h.onclick=()=>{y||e||h.requestPointerLock()};document.onpointerlockchange=()=>{y=document.pointerLockElement===h};document.onmousemove=b=>{y&&O.set([b.movementX,b.movementY])};p.onclick=async()=>{e?e.end():(e=await navigator.xr.requestSession("immersive-vr"),await a.makeXRCompatible(),e.updateRenderState({baseLayer:new XRWebGLLayer(e,a)}),e.g=await e.requestReferenceSpace("local"),e.requestAnimationFrame(K),e.onend=()=>{e=null;p.textContent="Enter VR"},p.textContent="Exit VR")};const P=a.createBuffer();
let w,v,z,L,M,O,Q,A,t;const S=await (await fetch("g.wasm")).arrayBuffer(),{instance:{exports:m}}=await WebAssembly.instantiate(S,{J:{A:Math.pow,B:Math.sqrt,C:Math.sin,D:Math.cos,E:Math.tan,b:b=>{b=new Float32Array(T,b);w=b.subarray(0,1);v=b.subarray(1,3);z=b.subarray(3,79);L=b.subarray(3,19);M=b.subarray(19,35);O=b.subarray(79,81);Q=b.subarray(81,337);A=b.subarray(337,9553);t=b.subarray(9553,13649);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,4*A.length,a.DYNAMIC_DRAW);
a.enableVertexAttribArray(0);a.enableVertexAttribArray(1);a.enableVertexAttribArray(2);a.vertexAttribPointer(0,3,a.FLOAT,!1,36,0);a.vertexAttribPointer(1,2,a.FLOAT,!1,36,12);a.vertexAttribPointer(2,4,a.FLOAT,!1,36,20);a.bindBuffer(a.UNIFORM_BUFFER,P);a.bufferData(a.UNIFORM_BUFFER,4*z.length,a.DYNAMIC_DRAW);a.bindBufferBase(a.UNIFORM_BUFFER,0,P);b=document.createElement("canvas");const c=b.getContext("2d");b.width=b.height=8192;c.fillStyle="black";c.fillRect(0,0,8192,8192);c.font="400px Verdana";c.fillStyle=
"white";c.textAlign="center";c.textBaseline="middle";for(let d=0;d<256;d++){const f=d%16*512+256,g=Math.floor(d/16)*512+256,l=String.fromCharCode(d);Q[d]=c.measureText(l).width;c.fillText(l,f,g)}a.bindTexture(a.TEXTURE_2D,a.createTexture());a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.generateMipmap(a.TEXTURE_2D);a.useProgram(x[2]);a.uniform1i(a.getUniformLocation(x[2],
"T"),0)},c:()=>{a.bufferSubData(a.UNIFORM_BUFFER,0,z)},d:(b,c)=>{a.useProgram(x[b]);a.bufferSubData(a.ARRAY_BUFFER,0,A.subarray(0,9*c));a.drawArrays(a.TRIANGLES,0,c)},e:(b,c,d,f)=>{function g(k,B,C,D,U){const R=n.currentTime,r=new OscillatorNode(n);D=new GainNode(n,{gain:D});const E=new GainNode(n);for(let q=0;q<k.length;q+=1)E.gain.linearRampToValueAtTime(C[q],R+k[q]),r.frequency.linearRampToValueAtTime(U*B[q],R+k[q]);r.connect(E).connect(D).connect(N);r.start();setTimeout(()=>{r.stop();r.disconnect();
E.disconnect()},1E3*k[k.length-1]+100)}const l=t.subarray(0,c);let F=c,G=(1+b)*c;for(let k=0;k<b;k+=1){const B=t.subarray(F,F+c),C=t.subarray(G,G+c);F+=c;G+=c;g(l,B,C,d,f)}},f:b=>Math.floor(Math.random()*b)}}),T=m.memory.buffer;m.z();requestAnimationFrame(J)});
</script>