import{randA as e,ranR as t}from"./util.js";const n=new(window.AudioContext||window.webkitAudioContext),a=n.createGain();a.connect(n.destination),a.gain.setValueAtTime(.2,n.currentTime);const c=n.createGain();c.connect(n.destination),c.gain.setValueAtTime(.6,n.currentTime);const o=2*n.sampleRate,i=n.createBuffer(1,o,n.sampleRate),r=i.getChannelData(0);for(let T=0;T<o;T++)r[T]=t(-1,1);function s(){const e=n.createBufferSource();return e.buffer=i,e.loop=!0,e}export const sFX={grind:(e,t)=>{const a=s(),o=n.currentTime,i=n.createBiquadFilter();i.type="lowpass",i.frequency.value=100;const r=n.createWaveShaper();r.curve=function(e){const t="number"==typeof e?e:50,n=44100,a=new Float32Array(n),c=Math.PI/180;for(let e=0;e<n;++e){const o=2*e/n-1;a[e]=(3+t)*o*20*c/(Math.PI+t*Math.abs(o))}return a}(200),r.oversample="4x";const u=n.createOscillator();u.frequency.value=10;const l=n.createGain();l.gain.value=50,u.connect(l).connect(i.frequency),u.start(),a.connect(i),i.connect(r),r.connect(c),a.start(o),a.stop(o+Math.min(e,t))},woosh:(e,t,a=!1)=>{const o=s(),i=n.currentTime,r=1.5*e,u=n.createBiquadFilter();u.type="bandpass",u.frequency.value=1500,u.Q.value=1;const l=n.createGain();l.gain.setValueAtTime(0,i),l.gain.linearRampToValueAtTime(1,i+r*(a?.5:.05)),l.gain.exponentialRampToValueAtTime(.001,i+r),o.connect(u).connect(l).connect(c),o.start(),o.stop(i+t)},wooshUp:(e,t)=>sFX.woosh(e,t,!0),spin:(e,t)=>{const a=n.currentTime,o=n.createOscillator();o.type="triangle",o.frequency.setValueAtTime(100,a),o.frequency.exponentialRampToValueAtTime(300,a+.4*e),o.frequency.setValueAtTime(300,a+.6*e),o.frequency.exponentialRampToValueAtTime(100,a+e);const i=s(),r=n.createBiquadFilter();r.type="highpass",r.frequency.value=400;const u=n.createGain();u.gain.setValueAtTime(.001,a),u.gain.exponentialRampToValueAtTime(.2,a+.4*e),u.gain.setValueAtTime(.2,a+.6*e),u.gain.exponentialRampToValueAtTime(.001,a+e),o.connect(u),i.connect(r).connect(u),u.connect(c),o.start(a),i.start(a),o.stop(a+Math.min(e,t)),i.stop(a+Math.min(e,t))},bash:(e,t)=>{const a=n.currentTime,o=s(),i=n.createGain();i.gain.setValueAtTime(.4,a),i.gain.exponentialRampToValueAtTime(.001,a+e),o.connect(i).connect(c),o.start(a),o.stop(a+t)},hng:(e,t)=>sFX.mew(e,t,0,100,200,10),mew:(e,t,a=0,o=600,i=400,r=30)=>{const s=n.currentTime+a,u=n.createOscillator();u.type="sawtooth",u.frequency.setValueAtTime(400,s),u.frequency.exponentialRampToValueAtTime(o,s+.2*e),u.frequency.linearRampToValueAtTime(i,s+.8*e);const l=n.createBiquadFilter();l.type="bandpass",l.frequency.value=1e3,l.Q.value=4;const m=n.createBiquadFilter();m.type="bandpass",m.frequency.value=2500,m.Q.value=6;const p=n.createOscillator();p.frequency.value=r;const T=n.createGain();T.gain.value=40,p.connect(T).connect(u.frequency),p.start(s);const f=n.createGain();f.gain.setValueAtTime(.001,s),f.gain.exponentialRampToValueAtTime(6,s+.05*e),f.gain.setValueAtTime(6,s+.5*e),f.gain.exponentialRampToValueAtTime(.001,s+1.2*e),u.connect(l).connect(m).connect(f).connect(c),u.start(s),u.stop(s+t)},yowl:(e,t)=>{sFX.mew(e,e,0,600,400,30),sFX.mew(e-.1,e,.1,800,1e3,30),sFX.mew(e-.2,e,.2,200,500,20),sFX.mew(e-.5,e,.4,500,100,10),sFX.mew(e-.2,e,0,500,1200,40)}};function u(e,t,a,c){const o=n.createOscillator();o.frequency.setValueAtTime(e,a);const i=n.createGain();i.gain.setValueAtTime(1,a),i.gain.exponentialRampToValueAtTime(1e-4,a+c),o.connect(i).connect(t),o.start(a),o.stop(a+c)}var l=null,m=[[0,2,4,7,9],[0,3,5,7,10],[0,2,5,7,10],[0,1,5,7,10],[0,2,5,7,9]];function p(){l&&(!function(e,t,c=10,o=1){const i=440*Math.pow(2,(12*t+e-57)/12),r=n.currentTime,s=n.createGain();s.gain.setValueAtTime(.2*o,r).exponentialRampToValueAtTime(1e-4,r+c),s.connect(a),u(i,s,r,c),u(2.01*i,s,r,.9*c),u(2.62*i,s,r,.7*c),u(3.95*i,s,r,.5*c)}(e(m[l.t]),e(l.o),e(l.d||[10,20,25]),t(l.vs||.1,l.ve||.5)),setTimeout(p,1e3*t(l.gs||.5,l.ge||1)))}export function pChimes(e=null){l||setTimeout(p,10),l=e}