import*as e from"three";import{tickCount as t,inRange as n}from"./util.js";export function initMouse(i,o,a){var c,r,s,u,d,f=!1,v=new e.Raycaster;function l(e,n){f||(f=!0,c=e,r=n,s=t(),u=i.rotation.x,d=i.rotation.y)}function h(e,n){if(Math.abs(e-c)<5&&Math.abs(n-r)<5&&Math.abs(t()-s)<400)return f=!1,void function(e,t){v.setFromCamera({x:e/window.innerWidth*2-1,y:-t/window.innerHeight*2+1},o);var n=v.intersectObject(i,!0),c=n[0]?.object;for(;c&&(!c.name||c?.passDown);)c=c.parent;c&&a(c,c?.name)}(e,n);m(e,n),f=!1}function m(e,t){if(f){var o=e-c,a=t-r;i.rotation.x=n(-.1,1,u+a/window.innerHeight*3.14),i.rotation.y=d+o/window.innerWidth*3.14}}let p=document.getElementsByTagName("canvas")[0];p.addEventListener("mousemove",function(e){e.preventDefault(),m(e.clientX,e.clientY)},!1),p.addEventListener("mousedown",function(e){e.preventDefault(),l(e.clientX,e.clientY)},!1),p.addEventListener("mouseup",function(e){e.preventDefault(),h(e.clientX,e.clientY)},!1),p.addEventListener("touchstart",function(e){e.preventDefault(),l(e.touches[0].clientX,e.touches[0].clientY)},{passive:!1}),p.addEventListener("touchmove",function(e){e.preventDefault(),m(e.touches[0].clientX,e.touches[0].clientY)},{passive:!1}),p.addEventListener("touchend",function(e){e.preventDefault(),h(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},{passive:!1})}