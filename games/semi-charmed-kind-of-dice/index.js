const t=["d20","d12","d10","d8","d6","d4","cat","charm","charm-2","charm-3"],e={20:"#ff7f50",12:"#f1c432ff",10:"#35c356ff",8:"#40c3ebff",6:"#3855f8ff",4:"#8051d5ff"},i={cat:'<svg fill="#fff" class="cat die-number" viewBox="-3 0 189 129"><path fill-rule="evenodd" d="m139.18 128.81-88.943.009c2.36-4.565 9.472-11.158 8.453-16.317-.692-3.501-17.192-16-20.897-38.691C34.087 51.12 45.473.002 53.498.002c4 0 14.08 19.839 19.312 28.978 13.863-5.206 34.687-4.478 44.423-.478 5.265-9.498 15.228-28.5 18.764-28.5 4 0 13.505 55.286 12 73.809-1.505 18.523-18.255 34.189-18.255 38.69 0 4.5 3.755 10.5 9.437 16.309zM71.252 63.957c7.461 5.615-6.173 13.217-12.177 8.268-8.342-6.882 5.816-13.05 12.177-8.268zm58.671 9.107c-5.752 4.108-19.505-.927-12.689-7.807 6.457-6.512 21.021 1.867 12.689 7.807zm-30.747 8.329c11.172-8.49-21.422-9.566-9.608.157 5.563 4.573-1.089 6.85-3.09 8.66 3.09 4.293 7.373-1.991 8.52-4.707 0 0 5.495 9.32 8 4.707-1.18-1.387-7.057-6.365-3.822-8.817z" class="cat-body" clip-rule="evenodd"/><path d="M33.221 71.156 18.5 66.5 3.156 64.779M33.5 79.5h-16L2 81M33.5 86h-5l-6 4M155.779 71.156 171 67.5l14.844-2.721M155.5 79.5l16-.5 15.5 2M155.5 86l6 1.5 5 2.5" class="cat-whisker"/></svg>',charm:'<svg class="charm charm-1 die-number" viewBox="0 0 200 200" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M100.44 42L117.351 83.326L161.88 86.638L127.803 115.491L138.412 158.864L100.44 135.371L62.468 158.864L73.078 115.491L39 86.638L83.529 83.326L100.44 42Z"/></svg>',"charm-2":'<svg class="charm charm-2 die-number" viewBox="0 0 200 200" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M146.5 62L157.372 88.5219L186 90.6474L164.092 109.164L170.912 137L146.5 121.923L122.088 137L128.909 109.164L107 90.6474L135.628 88.5219L146.5 62Z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M53.5 62L64.3721 88.5219L93 90.6474L71.0918 109.164L77.9123 137L53.5 121.923L29.0877 137L35.9089 109.164L14 90.6474L42.6279 88.5219L53.5 62Z"/></svg>',"charm-3":'<svg class="charm charm-3 die-number" viewBox="0 0 200 200" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M148.5 102L158.822 127.107L186 129.12L165.201 146.649L171.676 173L148.5 158.727L125.324 173L131.8 146.649L111 129.12L138.178 127.107L148.5 102Z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M51.5 102L61.8217 127.107L89 129.12L68.2011 146.649L74.6763 173L51.5 158.727L28.3237 173L34.7996 146.649L14 129.12L41.1783 127.107L51.5 102Z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M101.5 25L111.822 50.1074L139 52.1195L118.201 69.649L124.676 96L101.5 81.727L78.3237 96L84.7996 69.649L64 52.1195L91.1783 50.1074L101.5 25Z"/></svg>',d4:'<svg class="die-svg" viewBox="-8 0 96 69"><path fill="currentColor" d="m1.875 66.497 37.26-64.012a1 1 0 0 1 1.73 0l37.26 64.012A1 1 0 0 1 77.261 68H2.739a1 1 0 0 1-.864-1.503z" class="face"/><path stroke="#000" stroke-width="3" d="m1.875 66.497 37.26-64.012a1 1 0 0 1 1.73 0l37.26 64.012A1 1 0 0 1 77.261 68H2.739a1 1 0 0 1-.864-1.503z" class="edges"/></svg>',d6:'<svg class="die-svg" viewBox="-8 0 94 78"><rect width="76" height="76" x="1" y="1" class="face" rx="3"/><rect width="76" height="76" x="1" y="1" class="edges" rx="3"/></svg>',d8:'<svg class="die-svg" viewBox="-8 0 96 92"><path d="M3.025 22.987 40 2l36.975 20.987A4 4 0 0 1 79 26.466v41.493L42.035 89.798a4 4 0 0 1-4.07 0L1 67.959V26.466a4 4 0 0 1 2.025-3.479Z" class="face"/><path d="M40 2 3.025 22.987A4 4 0 0 0 1 26.466v41.493M40 2l36.975 20.987A4 4 0 0 1 79 26.466v41.493M40 2 1 67.96M40 2l39 65.96m0 0L42.035 89.797a4 4 0 0 1-4.07 0L1 67.959m78 0H1" class="edges"/></svg>',d10:'<svg class="die-svg" viewBox="-8 0 96 78"><path d="M40.245 76 1 49.536v-16.6a4 4 0 0 1 1.627-3.221L40.245 2l37.147 27.714A4 4 0 0 1 79 32.92v16.616L40.245 76Z" class="face"/><path d="M40.245 76 1 49.536M40.245 76 79 49.536M40.245 76V61.788M1 49.536v-16.6a4 4 0 0 1 1.627-3.221L40.245 2M1 49.536h13.736M40.246 2l37.146 27.714A4 4 0 0 1 79 32.92v16.616M40.245 2l-25.51 47.536M40.246 2l25.02 47.536m13.735 0H65.264m-50.528 0 25.51 12.252m25.018-12.252L40.245 61.788" class="edges"/></svg>',d12:'<svg class="die-svg" viewBox="-8 0 96 86"><path d="M1 55.399V30.82l14.746-19.76a4 4 0 0 1 1.907-1.391L40 2l22.864 7.66a4 4 0 0 1 1.978 1.458L79 30.82v24.62a4 4 0 0 1-.783 2.378L64.838 75.917a4 4 0 0 1-1.946 1.415L41.286 84.57a4 4 0 0 1-2.57-.01l-22.231-7.629L1.827 57.837A4 4 0 0 1 1 55.4z" class="face"/><path d="M1 30.819v24.579a4 4 0 0 0 .827 2.436L16.485 76.93M1 30.819l14.746-19.76a4 4 0 0 1 1.907-1.391L40 1.999M1 30.82l13.191 4.034M40 1.999l22.863 7.66a4 4 0 0 1 1.978 1.458L79 30.819M40 1.999v13.258m39 15.562v24.62a4 4 0 0 1-.783 2.377l-13.378 18.1a4 4 0 0 1-1.946 1.415l-21.606 7.238a4 4 0 0 1-2.57-.01l-22.231-7.63M79 30.82l-13.765 4.035M16.485 76.93l7.456-12.104h31.544m-31.544 0-9.75-29.972m41.294 29.972 8.602 12.68m-8.602-12.68 9.75-29.972L40 15.257 14.19 34.854" class="edges"/></svg>',d20:'<svg class="die-svg" viewBox="-8 0 96 94"><path d="M1 69.877V23.62L40 2l39 21.62v46.257L40 92 1 69.877Z" class="face"/><path d="M1 69.877V23.62m0 46.257L40 92M1 69.877l12.156-7.039M1 23.62 40 2M1 23.62l39-9.553M1 23.62l12.156 39.218M40 2l39 21.62M40 2v12.067m39 9.553v46.257m0-46.257-39-9.553m39 9.553L67.35 62.838M79 69.878 40 92m39-22.123-11.65-7.039M40 92l27.35-29.162M40 92 13.156 62.838M40 14.067 13.156 62.838M40 14.067l27.35 48.771m0 0H13.157" class="edges"/></svg>'},s=(t,...e)=>{const i="object"!=typeof e[0]||e[0]instanceof HTMLElement?null:e.shift(),s=document.createElement(t);return i&&a(s,i),s.append(...e.map(t=>t)),s},a=(t,e)=>Object.entries(e).forEach(([e,i])=>{if("object"==typeof i&&e in t)return a(t[e],i);Object.assign(t,{[e]:i})});const n=new class{particles=[];orbitalParticles=[];canvas=null;ctx=null;animationId=null;initialized=!1;globalOrbitalAngle=0;baseAngularVelocity=.02;orbitalParticleCount=0;pointCount=0;fadeAlpha=0;centerX=innerWidth/2;centerY=innerHeight/2;centerYOffset=0;scale=1;constructor(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.init()):this.init()}init(){this.initialized||(this.canvas=s("canvas",{className:"particle-canvas"}),document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.initialized=!0,this.animate(),this.resize(),addEventListener("resize",()=>this.resize()))}resize(){this.canvas&&(this.canvas.width=innerWidth,this.canvas.height=innerHeight,this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2,this.scale=Math.min(500,this.canvas.width)/500)}createConfetti(t,e,i,s=20,a){for(let n=0;n<s;n++){const r=2*Math.PI*n/s+.5*Math.random(),l=(.5+3*Math.random())*this.scale,o=(40+90*Math.random())*this.scale;this.particles.push({x:t,y:e,rotation:0,color:i,isStar:a,life:o,maxLife:o,vx:Math.cos(r)*l,vy:Math.sin(r)*l,size:5+5*Math.random(),rotationSpeed:.2*Math.random()})}this.animationId||this.animate()}createOrbitalParticle(){this.orbitalParticles.forEach((t,e)=>{t.orbitalIndex=e,t.currentSpeedMultiplier=1}),this.orbitalParticles.push({x:this.centerX,y:this.centerY+this.centerYOffset,rotation:0,orbitalIndex:this.orbitalParticles.length,currentSpeedMultiplier:1}),this.orbitalParticleCount=this.orbitalParticles.length,this.animationId||this.animate()}fireOffOrbitalParticles(){this.convertOrbitalParticlesToRegular(.1*this.scale,1)}removeOrbitalParticle(){const t=this.orbitalParticles.shift();this.particles.push({x:t.x,y:t.y,vx:0,vy:0,life:30,maxLife:30,size:18,color:"#FFD700",isStar:!0,rotation:t.rotation,rotationSpeed:.1}),setTimeout(()=>this.createConfetti(t.x,t.y,"#FFD700",10,!0),200)}convertOrbitalParticlesToRegular(t,e){this.orbitalParticles.forEach(i=>{const s=this.globalOrbitalAngle+2*Math.PI*i.orbitalIndex/this.orbitalParticleCount,a=-Math.sin(s)*this.baseAngularVelocity*t,n=Math.cos(s)*this.baseAngularVelocity*t,r=100*(a+Math.cos(s)*t*.5*e),l=100*(n+Math.sin(s)*t*.5*e),o=60*this.scale;this.particles.push({x:i.x,y:i.y,vx:r,vy:l,life:o,maxLife:o,size:18,color:"#FFD700",isStar:!0,rotation:i.rotation,rotationSpeed:.1})}),this.orbitalParticles=[],this.animationId||this.animate()}animate(){if(this.canvas&&this.ctx){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),0===this.pointCount?this.fadeAlpha=Math.max(0,this.fadeAlpha-.02):this.pointCount>0&&(this.fadeAlpha=Math.min(1,this.fadeAlpha+.1)),this.renderNumber(),this.globalOrbitalAngle+=this.baseAngularVelocity,this.globalOrbitalAngle=this.globalOrbitalAngle%(2*Math.PI);for(let t=0;t<this.orbitalParticles.length;t++){const e=this.orbitalParticles[t],i=this.globalOrbitalAngle+2*Math.PI*e.orbitalIndex/this.orbitalParticleCount,s=(100+(150-100)*(1-Math.exp(-.05*this.orbitalParticleCount)))*this.scale,a=this.centerX+Math.cos(i)*s,n=this.centerY+this.centerYOffset+Math.sin(i)*s;let r=i-Math.atan2(e.y-(this.centerY+this.centerYOffset),e.x-this.centerX);r=(r+Math.PI)%(2*Math.PI)-Math.PI;const l=Math.PI/4,o=Math.abs(r)/l;Math.abs(r)>.05?(e.currentSpeedMultiplier=1+(r>0?2*o:.5*-o),e.currentSpeedMultiplier=Math.max(.2,Math.min(3,e.currentSpeedMultiplier))):e.currentSpeedMultiplier=1;const c=.15;e.x=e.x+(a-e.x)*c,e.y=e.y+(n-e.y)*c,e.rotation=i+.2}for(let t=this.particles.length-1;t>=0;t--){const e=this.particles[t];e.x+=e.vx,e.y+=e.vy,e.vx*=.98,e.vy*=.98,e.life--,void 0!==e.rotationSpeed&&void 0!==e.rotation&&(e.rotation+=e.rotationSpeed),e.life<=0&&this.particles.splice(t,1)}this.orbitalParticles.forEach(t=>{this.renderOrbitalParticle(t)}),this.particles.forEach(t=>{this.renderParticle(t)}),this.animationId=requestAnimationFrame(()=>this.animate())}}renderNumber(){if(!this.ctx)return;this.ctx.save();const t=.001*Date.now(),e=(1+Math.min(this.pointCount,200)/400+.05*Math.sin(4*t))*this.scale;this.ctx.translate(this.centerX,this.centerY+this.centerYOffset),this.ctx.scale(e,e),this.ctx.rotate(.1*Math.sin(1.5*t)),this.ctx.font="bold 42px system-ui",this.ctx.fillStyle=`rgba(72, 157, 255, ${this.fadeAlpha})`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(`${this.pointCount}`,0,0),this.ctx.restore()}renderOrbitalParticle(t){if(!this.ctx)return;this.ctx.save();const e=document.querySelector(".charm-1 path");this.ctx.fillStyle="#FFD700",this.ctx.beginPath();const i=.45*this.scale;this.ctx.translate(t.x,t.y),this.ctx.scale(i,i),this.ctx.rotate(t.rotation),this.ctx.translate(-100,-100);let s=new Path2D(e.getAttribute("d"));this.ctx.lineWidth=10,this.ctx.stroke(s),this.ctx.fill(s),this.ctx.restore()}renderParticle(t){if(!this.ctx)return;const e=t.life/t.maxLife,i=t.size*e;this.ctx.save();const s=document.querySelector(".charm-1 path");this.ctx.fillStyle=t.color,this.ctx.beginPath();const a=i/40*this.scale,n="black"!==t.color;let r=n?0:15;if(this.ctx.translate(t.x-r,t.y-r),this.ctx.scale(a,a),void 0!==t.rotation&&this.ctx.rotate(t.rotation),this.ctx.lineWidth=10,t.isStar){n&&this.ctx.translate(-100,-100);let t=new Path2D(s.getAttribute("d"));this.ctx.stroke(t),this.ctx.fill(t)}else this.ctx.arc(0,0,10*i,0,360),this.ctx.stroke(),this.ctx.fill();this.ctx.restore()}},r=[1,,95,.01,.01,,,4.4,,4,193,.05,,,,,.28,.82,.02,.09],l=[.7,,296,.01,.21,.14,3,1.6,,-8,3,.01,,,4.2,,.02,.62],o=[1.6,,459,.08,,.12,1,4.7,-1,,-195,.01,.02,.1,.3,,.21,.67,.03,.05,161],c=[.25,.2,400,.05,.02,.2,,.3,,,132,.1,,.1,,,,.6,.02],d=[1.6,,190,.33,.13,.26,,2.5,,-91,,,.12,,77,,,.58,.01,,134],h=[,,488,.16,.09,.15,1,.7,,52,,,.06,,,,,.96,.05,.45],m=[.2,,858,.01,.1,,1,2.7,-9,-43,,,,,,,,.68,.07],u=[.8,,691,.01,.17,.4,2,.6,,91,473,.31,,,,,.08,,.04,,-1473],p=[.18,,900,,.01,.01,4,,,,,,,,,,,.2],g=[[[.25,0,25,.001,.05,,3,,,,,,,,,,.02],[.9,0,120,,,.03,1,1.25,,,,,.02,6.8,-.3,,.5,.5],[.6,0,40,,,,,.7,,,,.5,,6.7,1,.05],[1.5,0,40,,,,,1.1,,-.1,-10,-.05,-.01,1],[.35,0,25,,.06,.14,3,,,,,,,,,,,.57]],[[[2,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,],[,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,19,,],[1,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,],[3,,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30]],[[2,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,],[,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,19,,],[4,,31,,,28,,,26,,,,28,,,,,,31,,,28,,,31,,,,28,,,,,,28,,,28,,,26,,,,28,,31,,33,,33,,28,,,,26,,,,28,,,,,,],[1,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,],[3,,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30]],[[2,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,],[,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,],[4,,28,,26,28,,26,31,33,35,33,31,28,26,,28,,28,,26,28,,26,31,33,28,,,,,,,,28,,26,28,,26,28,31,33,35,33,31,26,,28,,28,,,28,,,26,,26,,28,,28,,,,],[1,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,],[3,,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30]],[[2,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,29,,,,,,,,,29,29,,29,,,,],[,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,16,,16,,19,,21,,,,21,,19,,21,,16,,16,,19,,21,,,,21,,19,,14,,],[4,,14,16,,16,,16,,14,16,,19,,21,,23,,14,16,,16,,19,,21,16,,,,,,,,14,16,,16,,16,,14,16,,19,,21,,23,,19,19,,19,,16,,14,16,,,,,,,,],[1,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,,,32,,,,32,,32,,,,,,,,],[3,,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30,,,,,30,,,,,,,,,,29,30]]],[0,1,1,2,2,3,3]];let f=.3,v=null;const M=44100,L=new AudioContext,x=()=>{q.muteState=(q.muteState+1)%3,f=0===q.muteState?0:.3,2===q.muteState&&y(...r),v&&(v.gain.value=1===q.muteState?1:0)},b=()=>{const t=S(...A(...g));v=L.createGain(),v.connect(L.destination),t.disconnect(),t.connect(v),t.loop=!0,v.gain.value=1===q.muteState?1:0};function y(...t){return 0===q.muteState?{}:S(P(...t))}function S(...t){const e=L.createBuffer(t.length,t[0].length,M),i=L.createBufferSource();return t.map((t,i)=>e.getChannelData(i).set(t)),i.buffer=e,i.connect(L.destination),i.start(),i}function P(t=1,e=.05,i=220,s=0,a=0,n=.1,r=0,l=1,o=0,c=0,d=0,h=0,m=0,u=0,p=0,g=0,v=0,L=1,x=0,b=0,y=0){const S=2*Math.PI,P=t=>t<0?-1:1,A=o=o*(500*S)/M/M,w=i=i*((1+2*e*Math.random()-e)*S)/M,C=[];let N,D,O=0,k=0,T=0,I=1,H=0,U=0,E=0;const z=S*Math.abs(y)*2/M,B=Math.cos(z),q=Math.sin(z)/2/2,Y=1+q,F=-2*B/Y,$=(1-q)/Y,V=(1+P(y)*B)/2/Y,Z=-(P(y)+B)/Y,j=V;let R=0,W=0,X=0,_=0;for(c*=500*S/M**3,p*=S/M,d*=S/M,h*=M,m=m*M|0,t*=f,D=(s=s*M+9)+(x*=M)+(a*=M)+(n*=M)+(v*=M)|0;T<D;){if(!(++U%(100*g|0))){if(E=r?r>1?r>2?r>3?Math.sin(O**3):Math.max(Math.min(Math.tan(O),1),-1):1-(2*O/S%2+2)%2:1-4*Math.abs(Math.round(O/S)-O/S):Math.sin(O),E=(m?1-b+b*Math.sin(S*T/m):1)*P(E)*Math.abs(E)**l*(T<s?T/s:T<s+x?1-(T-s)/x*(1-L):T<s+x+a?L:T<D-v?(D-T-v)/n*L:0),v)if(v>T)E/=2;else{E=E/2+(T<D-v?1:(D-T)/v)*C[T-v|0]/2/t}y&&(R=W,W=E,X=_,_=j*R+Z*R+V*W-$*X-F*_,E=_)}N=(i+=o+=c)*Math.cos(p*k++),O+=N+N*u*Math.sin(T**5),I&&++I>h&&(i+=d,I=0),!m||++H%m||(i=w,o=A,I=I||1),C[T++]=E*t}return Float32Array.from(C)}const A=(t,e,i,s=125)=>{let a,n,r,l,o,c,d,h,m,u,p,g,f,v,L=0,x=[],b=[],y=[],S=0,A=0,w=1,C={},N=M/s*60>>2;for(;w;S++)x=[w=h=g=0],i.map((s,M)=>{for(d=e[s][S]||[0,0,0],w|=!!e[s][S],v=g+(e[s][0].length-2-!h)*N,f=M==i.length-1,n=2,l=g;n<d.length+f;h=++n){for(o=d[n],m=n==d.length+f-1&&f||u!=(d[0]||0)|o|0,r=0;r<N&&h;r++>N-99&&m?p+=(p<1)/99:0)c=(1-p)*x[L++]/2||0,b[l]=(b[l]||0)-c*A+c,y[l]=(y[l++]||0)+c*A+c;o&&(p=o%1,A=d[1]||0,(o|=0)&&(x=C[[u=d[L=0]||0,o]]=C[[u,o]]||(a=[...t[u]],a[2]*=2**((o-12)/12),o>0?P(...a):[])))}g=v});return[b,y]},w={4:4,6:6,8:7,10:9,12:12,20:21},C={4:1,6:1,8:2,10:2,12:3,20:5},N=t=>!!t.roll&&t.roll>=w[t.sides],D=t=>!!t.roll&&t.roll<=C[t.sides],O=(t,e)=>({sides:t,roll:t,index:e}),k=t=>{y(...d),T((e,i)=>{const s=e.sides>=12?20:e.sides+2;return i===t?{...e,sides:s,roll:s}:e})},T=t=>q.dice=q.dice.map(t),I=async(t,i)=>{if(D(t))return;const s=document.querySelector(".dice-game");return new Promise(a=>setTimeout(()=>{s.classList.remove("shake");const i=B(t.sides,t.index);q.dice=q.dice.map((e,s)=>s===t.index?{...e,roll:i}:e);const r={sides:q.dice[t.index].sides,roll:i},d=N(r),h=D(r),m=d?r.sides>=10?3:r.sides>=6?2:1:0,u=h||d?0:i??0;q.pendingPoints+=u;const p=document.querySelectorAll(".die")[t.index].getBoundingClientRect(),g=p.left+p.width/2+(h?20:0),f=p.top+p.height/2+(h?20:0),v=h?"black":d?"#f1da41":e[r.sides],M=d||h?10:6;if(n.createConfetti(g,f,v,M,d),d)for(let t=0;t<m;t++)setTimeout(()=>{y(...c),q.pendingCharms++,n.createOrbitalParticle()},150*t);else h?(q.dice.every(t=>D(t))?(n.fireOffOrbitalParticles(),n.createConfetti(n.centerX,n.centerY+n.centerYOffset,"black",30),y(...l)):y(...o),setTimeout(()=>s.classList.add("shake"),10),setTimeout(()=>s.classList.remove("shake"),200)):y(...(L=q.pendingPoints,[.45,,600-Math.min(500,L),,,.02,,3.5,-33,,,,,.2,17,,,.64,.08]));var L;a(void 0)},i))},H=t=>20===t?7:t/2,U=()=>2*(q.dice.length-2),E=()=>{const t=U();q.charms<t||(y(...h),q.dice=[...q.dice,O(4,q.dice.length)],q.charms-=t)},z=new Map,B=(t,e)=>{if(t<1)return 0;const i=t+"-"+e;let s=z.get(i);if(!s||0===s.length){s=[];for(let e=1;e<=t;e++)s.push(e,e,e);s=(t=>{const e=t.slice();for(let i=e.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1));[e[i],e[t]]=[e[t],e[i]]}return e})(s),z.set(i,s)}return s.pop()};let q=(t=>{const e=Object.fromEntries(Object.keys(t).map(t=>[t,[]]));return new Proxy({...t,_updates:e,_update:t=>e[t].forEach(t=>t()),addUpdate:(t,i)=>e[t].push(i)},{set:(t,e,i)=>"string"==typeof e&&(t[e]=i,t._update(e),!0)})})({dice:[],charms:0,points:0,highScore:JSON.parse(localStorage.getItem("jynx-dice-highscore")||"0"),pendingCharms:0,pendingPoints:0,muteState:1,selectedDie:-1,round:1,status:"menu",isAnimating:!1});const Y=async()=>{if(!q.isAnimating){if(q.isAnimating=!0,y(...m),await F(q.pendingPoints,q.pendingCharms),q.isAnimating=!1,13===q.round)return q.status="menu",y(...u),void(q.points>q.highScore&&(q.highScore=q.points,localStorage.setItem("jynx-dice-highscore",q.points.toString())));q.round++,q.dice=q.dice.map(t=>({...t,roll:t.sides})),q.status="shop"}},F=(t=0,e=0)=>new Promise(i=>{if(0===t&&0===e)return i(!0);const s=Math.min(1e3+10*t,3e3),a=Math.min(150*e,1500),r=Date.now();let l=0;const o=()=>{const d=Date.now()-r,h=Math.min((d-1.2*a)/s,1),m=Math.min(d/a,1),u=1-Math.pow(1-h,1.8),g=Math.floor(t*u)-(t-q.pendingPoints),f=Math.floor(e*m)-(e-q.pendingCharms);if(g>0&&(q.points+=g,q.pendingPoints-=g,(q.pendingPoints<=1||t<50||l++>=5)&&(y(...p),l=0)),f>0){q.charms+=f,q.pendingCharms-=f;for(let t=0;t<f;t++)n.removeOrbitalParticle();y(...c)}m>=1&&h>=1?i(!0):requestAnimationFrame(o)};requestAnimationFrame(o)}),$=async()=>{if("rolling"===q.status)return;y(...r),q.status="rolling",T(t=>({...t,roll:D(t)?t.roll:null}));let t=0;const e=1750/q.dice.length;await Promise.all(q.dice.filter(t=>!D(t)).map(async i=>{const s=++t*e;await I(i,s)}));q.dice.every(t=>D(t))&&(q.pendingCharms=0,q.pendingPoints=0),q.status="ready"},V=()=>{q.charms=3,q.points=0,q.pendingCharms=0,q.pendingPoints=0,q.round=1,q.status="shop",q.dice=[O(4,0),O(4,1),O(4,2)],q.selectedDie=-1,q.isAnimating=!1,y(...m)},Z=t=>{const e=s("div",{className:"die-container"}),i=s("button",{className:"die-upgrade",onclick:()=>(t=>{const e=q.dice[t].sides;if(e>=20)return!1;const i=H(e);q.charms<i||(q.charms-=i,k(t))})(t)},"Upgrade"),a=j();e.append(a.container,i);const n=()=>{const e=q.dice[t];if(!e)return;const s="shop"!==q.status,n=H(e.sides),r=20===e.sides?"Upgrade -<br/>Max Level":"Upgrade -<br/>"+n+" Charms";a.update(()=>{return q.status.match(/ready|shop/)&&(e=t,void(q.selectedDie=e));var e},e.sides,e.roll,"rolling"===q.status&&null==e.roll,q.selectedDie===t),i.toggleAttribute("disabled",q.charms<n||e.sides>=20),i.classList.toggle("hidden",s),i.innerHTML=r};return q.addUpdate("dice",n),q.addUpdate("charms",n),q.addUpdate("status",n),q.addUpdate("selectedDie",n),n(),e},j=()=>{const t=s("div",{className:"die-number"}),i=document.querySelector("#cat svg").cloneNode(!0),a=document.querySelector("#charm svg").cloneNode(!0),n=document.querySelector("#charm-2 svg").cloneNode(!0),r=document.querySelector("#charm-3 svg").cloneNode(!0),l=s("svg"),o=s("div",{className:"die"});o.append(t,i,a,n,r,l);let c=-1;return{container:o,update:(i,s=4,a=1,n=!1,r=!1)=>{if(o.style.color=e[s],o.classList.remove("d4","d6","d8","d10","d12","d20"),o.classList.add("d"+s),o.classList.toggle("clickable",!!q.status.match(/ready|shop/)),o.classList.toggle("rolling",n),o.classList.toggle("selected",r),o.classList.toggle("die-number-cat",D({roll:a,sides:s})),o.classList.toggle("die-number-charm",N({roll:a,sides:s})),o.style.animationDuration=1750/q.dice.length+"ms",t.textContent=a?a+"":"",c!==s){const t=document.querySelector("#d"+s+" svg").cloneNode(!0);c=s,l.innerHTML="",l.append(t),t.querySelector(".face")&&(t.querySelector(".face").onclick=i)}}}};class R{grad3;p;perm;simplex;constructor(t=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(let e=0;e<256;e++)this.p[e]=Math.floor(256*t.random());this.perm=[];for(let e=0;e<512;e++)this.perm[e]=this.p[255&e];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(t,e,i,s=0){return t[0]*e+t[1]*i+t[2]*s}noise3d(t,e,i){let s,a,n,r;const l=(t+e+i)*(1/3),o=Math.floor(t+l),c=Math.floor(e+l),d=Math.floor(i+l),h=1/6,m=(o+c+d)*h,u=t-(o-m),p=e-(c-m),g=i-(d-m);let f,v,M,L,x,b;u>=p?p>=g?(f=1,v=0,M=0,L=1,x=1,b=0):u>=g?(f=1,v=0,M=0,L=1,x=0,b=1):(f=0,v=0,M=1,L=1,x=0,b=1):p<g?(f=0,v=0,M=1,L=0,x=1,b=1):u<g?(f=0,v=1,M=0,L=0,x=1,b=1):(f=0,v=1,M=0,L=1,x=1,b=0);const y=u-f+h,S=p-v+h,P=g-M+h,A=u-L+2*h,w=p-x+2*h,C=g-b+2*h,N=u-1+.5,D=p-1+.5,O=g-1+.5,k=255&o,T=255&c,I=255&d,H=this.perm[k+this.perm[T+this.perm[I]]]%12,U=this.perm[k+f+this.perm[T+v+this.perm[I+M]]]%12,E=this.perm[k+L+this.perm[T+x+this.perm[I+b]]]%12,z=this.perm[k+1+this.perm[T+1+this.perm[I+1]]]%12;let B=.6-u*u-p*p-g*g;B<0?s=0:(B*=B,s=B*B*this.dot(this.grad3[H],u,p,g));let q=.6-y*y-S*S-P*P;q<0?a=0:(q*=q,a=q*q*this.dot(this.grad3[U],y,S,P));let Y=.6-A*A-w*w-C*C;Y<0?n=0:(Y*=Y,n=Y*Y*this.dot(this.grad3[E],A,w,C));let F=.6-N*N-D*D-O*O;return F<0?r=0:(F*=F,r=F*F*this.dot(this.grad3[z],N,D,O)),32*(s+a+n+r)}}function W(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const X=s("div",{className:"svgs hidden"},"");t.forEach(t=>{const e=i[t];e&&X.append(s("div",{id:`${t}`,innerHTML:e}))}),document.body.append(X),document.body.append((()=>{const t=s("div",{className:"dice-game"},(()=>{const t=s("div",{className:"dice"});return q.addUpdate("dice",()=>{t.querySelectorAll(".die").length!==q.dice.length&&(t.innerHTML="",q.dice.forEach((e,i)=>t.append(Z(i))))}),t})(),(()=>{const t=s("button",""),e=s("button",""),i=s("div",{className:"round-count"}),a=s("div",{className:"charm-count"}),r=s("div",{className:"chip-count"}),l=s("div",{className:"buttons"},e,t),o=s("div",{className:"info"},i,a,r),c=s("div",{className:"controls"},o,l),d=()=>{const l=q.isAnimating||!!q.status.match(/rolling|menu/),o=q.dice.every(D);t.toggleAttribute("disabled",l),t.textContent=o?"End Day":"shop"===q.status?"Start Day":"Roll",t.style.flex="1",e.toggleAttribute("disabled",q.isAnimating||("shop"===q.status?q.charms<U()||q.dice.length>=8:"ready"!==q.status)),e.style.display=o||"shop"===q.status&&q.dice.length>=8?"none":"block",e.innerHTML="shop"===q.status?q.dice.length>=8?"":`Buy Die -<br/>${U()} Charms`:"End Day",t.onclick=o?Y:$,e.onclick="shop"===q.status?E:Y,n.pointCount=q.pendingPoints;const c=document.querySelector(".dice-game"),d=c?.getBoundingClientRect().height??0,h=innerHeight/2-d-150;n.centerYOffset=innerWidth<500?h:q.dice.length>4?-210:-105,i.innerHTML="",a.innerHTML="",r.innerHTML="",i.append(s("div",{},`${q.round}`),s("div",{},"DAY")),a.append(s("div",{},`${q.charms}${"shop"===q.status?"":` + ${q.pendingCharms}`}`),s("div",{},"CHARMS")),r.append(s("div",{},`${q.points}${"shop"===q.status?"":` + ${q.pendingPoints}`}`),s("div",{},"POINTS"))};return document.addEventListener("keydown",i=>{if("Space"===i.code){if(i.preventDefault(),"menu"===q.status)return V();t.hasAttribute("disabled")||t.click()}"Enter"!==i.code||e.hasAttribute("disabled")||(i.preventDefault(),e.click()),"KeyM"===i.code&&x()}),q.addUpdate("status",d),q.addUpdate("points",d),q.addUpdate("charms",d),q.addUpdate("pendingCharms",d),q.addUpdate("pendingPoints",d),q.addUpdate("isAnimating",d),q.addUpdate("dice",d),d(),c})(),(()=>{const t=s("div",{className:"modal-overlay"}),e=s("div",{className:"modal"}),i=s("div",{className:"modal-content"}),a=s("div",{className:"modal-content"}),n=s("h3"),r=s("h3"),l=()=>q.selectedDie=-1,o=s("button",{onclick:l},"Close"),c=s("div",{className:"modal-buttons"},o);return t.onclick=e=>e.target===t&&l(),e.append(n,i,r,a,c),t.appendChild(e),q.addUpdate("selectedDie",()=>{const e=-1!==q.selectedDie;if(t.classList.toggle("open",e),!e)return;const s=q.dice[q.selectedDie]?.sides;i.innerHTML="";for(let t=1;t<=s;t++){const{container:e,update:a}=j();a(null,s,t,!1,!1),i.append(e)}if(n.innerText="Current Level (d"+s+")",a.innerHTML="",s<=12){const t=12===s?20:s+2;for(let e=1;e<=t;e++){const{container:i,update:s}=j();s(null,t,e,!1,!1),a.append(i)}r.innerText="Next Level (d"+t+")"}else r.innerText="Max Level Reached"}),t})(),(()=>{const t=s("button","Start Game"),e=s("button"),i=s("h2");i.innerHTML="Semi-Charmed<br/>Kind of Dice";const a=s("div","By Daniel Whiffing"),n=s("div"),r=s("div"),l=s("div",{className:"buttons"},t,e),o=s("div",{className:"menu"},i,a,n,r,l),c=()=>{const t="menu"!==q.status;o.style.opacity=t?"0":"1",o.style.pointerEvents=t?"none":"auto",a.style.marginBottom="10px",r.textContent="High Score: "+q.highScore,n.textContent="Last Score: "+q.points,r.style.display=q.highScore?"block":"none",n.style.display=q.points?"block":"none",e.textContent=0===q.muteState?"Muted":2===q.muteState?"Music off":"Sound/Music on"};return t.onclick=()=>V(),e.onclick=()=>x(),q.addUpdate("points",c),q.addUpdate("highScore",c),q.addUpdate("muteState",c),q.addUpdate("status",c),c(),o})()),e=s("div",{className:"dice-game-container"},(()=>{const t=s("canvas",{className:"background-canvas"}),e=t.getContext("2d"),i=new R,a=()=>{t.width=Math.floor(.15*window.innerWidth),t.height=Math.floor(.15*window.innerHeight)};let n;a(),window.addEventListener("resize",()=>{clearTimeout(n),n=setTimeout(a,100)});const r=["#42176A","#441771","#471976","#4a1a7a","#4c1b7e","#511C85"];let l=0;const o=()=>{l+=25e-5;const s=e.createImageData(t.width,t.height),a=s.data;for(let e=0;e<t.height;e++)for(let s=0;s<t.width;s++){const n=.01*s,o=.01*e,c=i.noise3d(n,o,l),d=Math.floor((c+1)/2*7),h=W(r[Math.min(5,Math.max(0,d))]),m=4*(e*t.width+s);a[m]=h.r,a[m+1]=h.g,a[m+2]=h.b,a[m+3]=255}e.putImageData(s,0,0),requestAnimationFrame(o)};return o(),t})(),t),i=()=>{t.classList.toggle("shop-mode",q.status.includes("shop")),t.classList.toggle("menu-mode",q.status.includes("menu"))};return q.addUpdate("status",i),i(),e})());const _=()=>{setTimeout(b,10),document.removeEventListener("pointerdown",_)};document.addEventListener("pointerdown",_);
