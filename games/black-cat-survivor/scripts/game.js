(()=>{function Et(){var i=function(r){return Math.sin(r*6.283184)},t=function(r){return 2*(r%1)-1},e=function(r){return r%1<.5?1:-1},s=function(r){var u=r%1*4;return u<2?u-1:3-u},a=function(r){return .003959503758*2**((r-128)/12)},o=function(r,u,B){var I=l[r.i[0]],_=r.i[1],L=r.i[3]/32,b=l[r.i[4]],C=r.i[5],g=r.i[8]/32,S=r.i[9],n=r.i[10]*r.i[10]*4,v=r.i[11]*r.i[11]*4,H=r.i[12]*r.i[12]*4,x=1/H,N=-r.i[13]/16,M=r.i[14],nt=B*2**(2-r.i[15]),q=new Int32Array(n+v+H),R=0,V=0,D,G,X,lt,Y,st,J;for(D=0,G=0;D<n+v+H;D++,G++)G>=0&&(M=M>>8|(M&255)<<4,G-=nt,st=a(u+(M&15)+r.i[2]-128),J=a(u+(M&15)+r.i[6]-128)*(1+8e-4*r.i[7])),X=1,D<n?X=D/n:D>=n+v&&(X=(D-n-v)*x,X=(1-X)*3**(N*X)),R+=st*X**L,Y=I(R)*_,V+=J*X**g,Y+=b(V)*C,S&&(Y+=(2*Math.random()-1)*S),q[D]=80*Y*X|0;return q},l=[i,e,t,s],d,m,w,p,j;this.init=function(r){d=r,m=r.endPattern,w=0,p=r.rowLen*r.patternLen*(m+1)*2,j=new Int32Array(p)},this.generate=function(){var r,u,B,I,_,L,b,C,g,S,n,v,H,x,N,M,nt,q=new Int32Array(p),R=d.songData[w],V=d.rowLen,D=d.patternLen,G=0,X=0,lt,Y,st=!1,J=[];for(I=0;I<=m;++I)for(C=R.p[I],_=0;_<D;++_){var ft=C?R.c[C-1].f[_]:0;ft&&(R.i[ft-1]=R.c[C-1].f[_+D]||0,ft<17&&(J=[]));var Ut=l[R.i[16]],Pt=R.i[17]/512,Kt=2**(R.i[18]-9)/V,Nt=R.i[19],Ht=R.i[20],qt=R.i[21]*43.23529*3.141592/44100,Vt=1-R.i[22]/255,mt=R.i[23]*1e-5,zt=R.i[24]/32,Gt=R.i[25]/512,Zt=6.283184*2**(R.i[26]-9)/V,kt=R.i[27]/255,pt=R.i[28]*V&-2;for(N=(I*D+_)*V,L=0;L<4;++L)if(b=C?R.c[C-1].n[_+L*D]:0,b){J[b]||(J[b]=o(R,b,V));var It=J[b];for(u=0,r=N*2;u<It.length;u++,r+=2)q[r]+=It[u]}for(u=0;u<V;u++)g=(N+u)*2,x=q[g],x||st?(M=qt,Nt&&(M*=Ut(Kt*g)*Pt+.5),M=1.5*Math.sin(M),G+=M*X,lt=Vt*(x-X)-G,X+=M*lt,x=Ht==3?X:Ht==1?lt:G,mt&&(x*=mt,x=x<1?x>-1?i(x*.25):-1:1,x/=mt),x*=zt,st=x*x>1e-5,S=Math.sin(Zt*g)*Gt+.5,Y=x*(1-S),x*=S):Y=0,g>=pt&&(Y+=q[g-pt+1]*kt,x+=q[g-pt]*kt),q[g]=Y|0,q[g+1]=x|0,j[g]+=Y|0,j[g+1]+=x|0}return w++,w/d.numChannels},this.createWave=function(){var r=44,u=r+p*2-8,B=u-36,I=new Uint8Array(r+p*2);I.set([82,73,70,70,u&255,u>>8&255,u>>16&255,u>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,B&255,B>>8&255,B>>16&255,B>>24&255]);for(var _=0,L=r;_<p;++_){var b=j[_];b=b<-32767?-32767:b>32767?32767:b,I[L++]=b&255,I[L++]=b>>8&255}return I}}if((typeof Blob!="function"||typeof $t>"u")&&typeof Blob=="function"&&typeof webkitURL<"u")var $t=webkitURL;var Tt=Blob||function(i){"use strict";var t=i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder||function(e){var s=function(n){return Object.prototype.toString.call(n).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},o=function(v,H,x){this.data=v,this.size=v.length,this.type=H,this.encoding=x},l=a.prototype,d=o.prototype,m=e.FileReaderSync,w=function(n){this.code=this[this.name=n]},p="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),j=p.length,r=e.URL||e.webkitURL||e,u=r.createObjectURL,B=r.revokeObjectURL,I=r,_=e.btoa,L=e.atob,b=!1,C=function(n){b=!n},g=e.ArrayBuffer,S=e.Uint8Array;for(o.fake=d.fake=!0;j--;)w.prototype[p[j]]=j+1;try{S&&C.apply(0,new S(3528e4))}catch{}return r.createObjectURL||(I=e.URL={}),I.createObjectURL=function(n){var v=n.type,H;if(v===null&&(v="application/octet-stream"),n instanceof o)return H="data:"+v,n.encoding==="base64"?H+";base64,"+n.data:n.encoding==="URI"?H+","+decodeURIComponent(n.data):_?H+";base64,"+_(n.data):H+","+encodeURIComponent(n.data);if(u)return u.call(r,n)},l.append=function(n){var v=this.data;if(S&&(n instanceof g||n instanceof S))if(b)v.push(String.fromCharCode.apply(String,new S(n)));else{for(var H="",x=new S(n),N=0,M=x.length;N<M;N++)H+=String.fromCharCode(x[N]);v.push(H)}else if(s(n)==="Blob"||s(n)==="File")if(m){var nt=new m;v.push(nt.readAsBinaryString(n))}else throw new w("NOT_READABLE_ERR");else n instanceof o?n.encoding==="base64"&&L?v.push(L(n.data)):n.encoding==="URI"?v.push(decodeURIComponent(n.data)):n.encoding==="raw"&&v.push(n.data):(typeof n!="string"&&(n+=""),v.push(unescape(encodeURIComponent(n))))},l.getBlob=function(n){return arguments.length||(n=null),new o(this.data.join(""),n,"raw")},l.toString=function(){return"[object BlobBuilder]"},d.toString=function(){return"[object Blob]"},a}(i);return function(s,a){var o=a&&a.type||"",l=new t;if(s)for(var d=0,m=s.length;d<m;d++)l.append(s[d]);return l.getBlob(o)}}(self);var f=document.getElementById("game"),h=f.getContext("2d"),k=6;h.imageSmoothingEnabled=!1;var Dt=function(){f.width=window.innerWidth,f.height=window.innerHeight,h.scale(k,k),h.imageSmoothingEnabled=!1};Dt();window.addEventListener("resize",Dt);var Ct={},Jt=function(i){Ct[i.code]=!0},Qt=function(i){Ct[i.code]=!1};window.addEventListener("keydown",Jt);window.addEventListener("keyup",Qt);function U(i){return Ct[i]}var z=function(i){var t=new Et;for(i=Object.assign({loop:!1,rowLen:5513,patternLen:1,endPattern:0,numChannels:1},i),t.init(i);t.generate()<1;);var e=t.createWave(),s=document.createElement("audio");return s.src=URL.createObjectURL(new Tt([e],{type:"audio/wav"})),s.loop=i.loop!=null?i.loop:!0,i.volume!=null&&(s.volume=i.volume),s.tryplay=function(){window.addEventListener("focus",()=>{s.paused&&s.play()}),window.addEventListener("blur",()=>{s.paused||s.pause()}),s._tryplay()},s._tryplay=function(){s.play().catch(()=>{requestAnimationFrame(s._tryplay)})},s},Z=function(i,t){return Math.random()*(t-i)+i},te=function(i,t){return i.x*t.x+i.y*t.y},gt=function(i){return(Math.sin(te(i,{x:12.9898,y:78.233}))*43758.5453%1+1)/2},rt=function(i){let t={};for(let e in i)t[e]=i[e].clone();return t},ee=function(i,t,e,s){let a=s?1:10;return parseInt(Math.floor(i/a)*a).toString(16).padStart(2,"0")+parseInt(Math.floor(t/a)*a).toString(16).padStart(2,"0")+parseInt(Math.floor(e/a)*a).toString(16).padStart(2,"0")},ie=function(i){let t=i.match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/);return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]},F=function(i,t){var e=new OffscreenCanvas(i.width,i.height);let s=e.getContext("2d");s.drawImage(i,0,0);let a=s.getImageData(0,0,i.width,i.height);for(let l=0;l<a.data.length;l+=4){let d=ee(a.data[l],a.data[l+1],a.data[l+2]);if(Object.keys(t).includes(d)){let m=ie(t[d]);a.data[l]=m[0],a.data[l+1]=m[1],a.data[l+2]=m[2]}}return s.putImageData(a,0,0),e.transferToImageBitmap()},Ot=function(i){switch(this.targetType){case 1:let t=null,e=1/0,s=tt.getEnemies();for(let o=0;o<s.length;o++){let l=s[o];if(i==l)continue;let d=it(this.world,l.world);d<e&&d<=this.maxAttackRange&&(e=d,t={obj:l,dist:d,dir:K(this.world,l.world)})}return t;case 2:let a=it(this.world,c.world);return a<=this.maxAttackRange?{obj:c,dist:a,dir:K(this.world,c.world)}:null}return null},wt=class{constructor(t={x:0,y:0,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},objects:[],animations:null,grass:null}){if(Object.assign(this,t),this.animations!=null)for(this.animations=rt(this.animations),this.grass=[],Object.values(this.animations).forEach(e=>{let s=e.frames[0]/e.spriteSheet._f|0,a=e.frames[0]%e.spriteSheet._f|0;createImageBitmap(e.spriteSheet.image,a*e.width,s*e.height,e.width,e.height).then(l=>{this.grass.push(l)})});this.grass.length<this.animations.length;);}render(){if(this.grass!=null){let e={h:f.height/k/8,w:f.width/k/8};for(let s=0;s<e.h;s++)for(let a=0;a<e.w;a++){let o=Math.floor(this.x/8),l=Math.floor(this.y/8),d=gt({x:o+a,y:l+s});if(d>.85){let m=(d+gt({x:o+a+1e3,y:l+s+1e3}))/2>.5?1:-1;h.save();let w=this.grass[0];d>.95?w=this.grass[2]:d>.9&&(w=this.grass[1]);let p=this.x-o*8,j=this.y-l*8,r=a*8-p,u=s*8-j;h.translate(r,u);let B=Math.min(.8,Math.max(.5,(d+gt({x:o+a+2e3,y:l+s+2e3}))/2));h.scale(m*B,1*B),h.drawImage(w,0,0,w.width,w.height,0,0,w.width*m,w.height),h.restore()}}}h.save(),h.translate(-this.x,-this.y);for(let e=0;e<this.objects.length;e++)this.objects[e].render();h.restore()}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],s=e.indexOf(t);s>=0&&e.splice(s,1),t.parent=null}reset(){this.objects=[]}update(t){this.x=c.x-f.width/2/k,this.y=c.y-f.height/2/k,(this.grass||[]).forEach(e=>e.update&&e.update(t)),(this.objects||[]).forEach(e=>e.update&&e.update(t))}},O=1/60,P=0,ot=!1,yt=null,T=null,dt={x:0,y:14,cardSeparation:4,objects:[],reset:function(){this.objects=[]},render:function(){h.save(),(this.x||this.y)&&h.translate(this.x,this.y);for(let i=0;i<this.objects.length;i++)this.objects[i].render(),h.translate(this.objects[i].cardWidth+this.cardSeparation,0);h.restore()},addChild:function(i){let t=this.objects||[];i.parent=this,t.push(i),this.objects=t},removeChild:function(i){let t=this.objects||[],e=t.indexOf(i);e>=0&&t.splice(e,1),i.parent=null},update:function(i){let t=0;(this.objects||[]).forEach(e=>{e.update&&e.update(i),t+=e.cardWidth+e.border.l+e.border.r+this.cardSeparation}),this.x=f.width/2/k-t/2}},c=null;var tt=null,A={},y=[],se="#334e1b",W={background:z({loop:!0,songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[139,,,,137,,,,139,,,,140,,,,,,,,135],f:[]}]}],patternLen:32}),edie:z({songData:[{i:[0,255,116,64,0,255,120,0,64,127,4,6,35,0,0,0,0,0,0,0,2,14,0,10,32,0,0,0,0],p:[1],c:[{n:[156],f:[]}]}]}),ehit:z({songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[151],f:[]}]}]}),pickup:z({songData:[{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[1],c:[{n:[182],f:[]}]}]}),gshoot:z({volume:.5,songData:[{i:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[1],c:[{n:[175],f:[]}]}]}),lbounce:z({songData:[{i:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[1],c:[{n:[182],f:[]}]}]}),lvlup:z({songData:[{i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[166,,168,,170,,159],f:[]}]}],patternLen:12}),gover:z({songData:[{i:[0,214,104,64,0,204,104,0,64,229,4,40,43,51,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[1],c:[{n:[159],f:[]}]}],patternLen:8}),gwin:z({songData:[{i:[3,100,128,0,3,201,128,2,0,0,0,6,49,0,0,0,0,139,4,1,3,30,184,119,244,147,6,84,6],p:[1],c:[{n:[156,,154,,156,,158],f:[]}]}],patternLen:8})},ut=null,bt,ae=function(){ut={pew:function(){return ct({itemType:"pew",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bulletSpeed:25,reloadTime:2,shootSound:W.gshoot,damage:1,icon:y[5].animations,iconWidth:4,iconHeight:4,bulletArgs:{width:4,height:4,hurtHeight:1,hurtWidth:1,animations:y[5].animations,removeOnHit:!0}})},flame:function(){return ct({itemType:"flame",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bulletSpeed:2,anchor:{x:.5,y:.5},flames:[],maxFlames:1,flameDist:16,time:0,icon:y[7].animations,bulletArgs:{width:8,height:8,scaleX:.75,scaleY:.75,hurtHeight:4,hurtWidth:4,anchor:{x:.5,y:.5},ttl:1/0,removeOnHit:!1,animations:y[7].animations},aiTransitions:{spawnFlames:[{method:"updateFlames",args:[]},{method:"fire",args:[]},{method:"addFlame",args:[]},{method:"changeState",args:["reloadg"]}],reloadg:[{method:"updateFlames",args:[]},{method:"reload",args:[]},{method:"changeState",args:["spawnFlames"]}]},aiState:"reloadg",addFlame:function(i){return this.addChild(i),!0},updateFlames:function(){this.time+=O;let i={x:this.parent?.world?.x|0+this.x,y:this.parent?.world?.y|0+this.y};for(let t=0;t<this.objects?.length|0;t++){let e=this.objects[t];e.speed=this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,e.damage=this.damage*(1+this.level);let s=3,a=Math.floor(t/s),o=t-a*s,l=this.objects.length-a*s,d=o*Math.PI*2/Math.min(s,l),m=a%2==0?1:-1,w=Lt({x:this.flameDist-a*4*Math.sin(this.time*e.speed),y:0},d+m*this.time*e.speed);e.x=w.x,e.y=w.y}return this.maxFlames=this.level,(this.objects?.length|0)<this.maxFlames?{dir:{x:0,y:0}}:null}})},magnet:function(){return{itemType:"magnet",itemFlavor:"support",level:1,maxLevel:2,scaleX:.5,scaleY:.5,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},icon:y[14].animations,update:function(i){let t=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*t.scaleX,this.world.scaleY=this.scaleY*t.scaleY,this.world.x=this.x+t.x,this.world.y=this.y+t.y,this.world.width=this.width*t.scaleX,this.world.height=this.height*t.scaleY,this.attractionRange||(this.attractionRange=this.parent?.attractionRange),this.attractionSpeed||(this.attractionSpeed=this.parent?.attractspeed),this.parent.attractionRange=this.attractionRange*(1+this.level),this.parent.attractspeed=this.attractionSpeed+40*this.level}}},hiheel:function(){return{itemType:"hiheel",itemFlavor:"support",level:1,maxLevel:2,scaleX:.5,scaleY:.5,world:{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},icon:y[15].animations,update:function(i){let t=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*t.scaleX,this.world.scaleY=this.scaleY*t.scaleY,this.world.x=this.x+t.x,this.world.y=this.y+t.y,this.world.width=this.width*t.scaleX,this.world.height=this.height*t.scaleY,this.speed?this.parent.speed=this.speed+this.level*5:this.speed=this.parent?.speed}}},ltn:function(){return ct({itemType:"ltn",itemFlavor:"d",level:1,maxLevel:6,x:0,y:0,scaleX:1,scaleY:1,bounceAmt:1,bulletSpeed:40,reloadTime:4,shootSound:W.gshoot,damage:1,icon:y[6].animations,iconWidth:4,iconHeight:4,bulletArgs:{width:4,height:4,hurtHeight:1,hurtWidth:1,animations:y[6].animations,maxAttackRange:40},reload:function(){let i=Math.max(O,this.reloadTime-.03*this.level*this.level);return this.aiDeltaUpdate(i)},fire:function(i){if(i==null)return null;let t=Yt(Object.assign({x:this.world.x,y:this.world.y,speed:this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,target:i.obj,ttl:1/O*5,width:1,height:1,scaleX:1,scaleY:1,bounceAmt:this.bounceAmt+this.level,targetType:this.targetType,damage:this.damage*((this.targetType==1?1:0)+this.level),getClosestTargetInRange:Ot,update:function(e){if(!this.target||this.target?.curHealth<=0||it(this.target,this)>this.maxAttackRange)this.target=this.getClosestTargetInRange(this.target)?.obj;else switch(this.direction=K(this.world,this.target.world),this.dx=this.direction.x*this.speed,this.dy=this.direction.y*this.speed,this.advance(e),this.targetType){case 1:this.hurtBox.intersects(this.target.hurtBox)&&(this.target?.takeDamage&&this.target.takeDamage(this.damage),this.bounceAmt-=1,this.target=this.getClosestTargetInRange(this.target)?.obj,this.bounceAmt>0&&W.lbounce.play());break}(this.ttl<=0||this.bounceAmt<=0||this.target==null)&&T.removeChild(this)}},this.bulletArgs));return this.shootSound&&this.shootSound.play(),t}})}},bt={pew:"d",flame:"d",magnet:"support",hiheel:"support",ltn:"d"}},Mt=function(i,t,e){return Math.min(Math.max(i,t),e)},re=function(i){return new Promise((t,e)=>{if(A[i])return t(A[i]);let s=new Image;s.onload=function(){let a=new URL(i,window.location.href).href;A[i]=A[a]=this,t(this)},s.onerror=function(){e(i)},s.src=i})},he=function(...i){return Promise.all(i.map(t=>re(t)))},et=function(i){let t=Math.sqrt(i.x*i.x+i.y*i.y);return{x:i.x/(t!=0?t:1),y:i.y/(t!=0?t:1)}},it=function(i,t){var e={x:i.x-t.x,y:i.y-t.y};return Math.sqrt(e.x*e.x+e.y*e.y)},K=function(i,t){return et({x:t.x-i.x,y:t.y-i.y})},Lt=function(i,t){let e=Math.cos(t),s=Math.sin(t);return{x:e*i.x-s*i.y,y:s*i.x+e*i.y}},ne=function(i){return{x:-i.y,y:i.x}},Q=function(i,t,e){h.save(),h.font=e,h.fillText(i,t.x,t.y),h.restore()},$=class{constructor(t){this.init(t),this.initialize()}init(t){Object.assign(this,{x:0,y:0,dx:0,dy:0,ddx:0,ddy:0,anchor:{x:0,y:0},ttl:1/0,scaleX:1,scaleY:1,parent:null,visible:!0,world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1},hurtWidth:0,hurtHeight:0,flipy:!1,flipx:!1}),Object.assign(this,t),"animations"in t&&(this.animations=rt(t.animations),this.currentAnimation=this.animations[Object.keys(this.animations)[0]],this.width=this.currentAnimation.width,this.height=this.currentAnimation.height),this.hurtBox=new vt({parent:this,center:{x:0,y:0},width:this.hurtWidth,height:this.hurtHeight})}initialize(){}isAlive(){return this.ttl>0}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],s=e.indexOf(t);s>=0&&e.splice(s,1),t.parent=null}update(t=O){this.advance(t)}advance(t=O){this.dx+=this.ddx*t,this.dy+=this.ddy*t,this.x+=this.dx*t,this.y+=this.dy*t,this.ttl--,this.currentAnimation?.update(t);let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,(this.objects||[]).forEach(s=>s.update&&s.update(t))}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}render(){if(this.visible){if(h.save(),(this.x||this.y)&&h.translate(this.x,this.y),h.save(),"currentAnimation"in this){let t=this.currentAnimation.frames[this.currentAnimation._f]/this.currentAnimation.spriteSheet._f|0,e=this.currentAnimation.frames[this.currentAnimation._f]%this.currentAnimation.spriteSheet._f|0,s=this.flipx?-1:1,a=this.flipy?-1:1;h.scale(s*this.scaleX,a*this.scaleY),h.filter=this?.invert?"invert(1)":"",h.translate(-1*s*this.currentAnimation.width*this.anchor.x,-1*a*this.currentAnimation.height*this.anchor.y),h.drawImage(this.currentAnimation.spriteSheet.image,this.currentAnimation.margin+e*this.currentAnimation.width+(e*2+1)*this.currentAnimation.spacing,this.currentAnimation.margin+t*this.currentAnimation.height+(t*2+1)*this.currentAnimation.spacing,this.currentAnimation.width,this.currentAnimation.height,0,0,this.currentAnimation.width*s,this.currentAnimation.height*a)}h.restore(),(this.objects||[]).forEach(t=>t.render&&t.render()),h.restore()}}},vt=class{constructor({parent:t,center:e,width:s,height:a}={}){this.center=e,this.width=s,this.height=a,this.parent=t}getWorldPos(){return{x:this.center.x+this.parent?.world?.x|0,y:this.center.y+this.parent?.world?.y|0}}intersects(t){let e=this.getWorldPos(),s=t.getWorldPos();return Math.abs(e.x-s.x)*2<this.width+t.width&&Math.abs(e.y-s.y)*2<this.height+t.height}},_t=class{constructor(t){this.fps=60,Object.assign(this,t),this.isStopped=!0,this.accumulator=0,this.delta=1e3/this.fps,this.step=1/this.fps,this.last=null,this.rAF=null,this.dt=null,this.focused=!0,window.addEventListener("focus",()=>{this.focused=!0}),window.addEventListener("blur",()=>{this.focused=!1})}frame(){if(this.isStopped)return;if(!this.focused){this.rAF=requestAnimationFrame(this.frame.bind(this));return}let t=performance.now();if(this.dt=t-this.last,this.last=t,this.dt>1e3){this.rAF=requestAnimationFrame(this.frame.bind(this));return}for(this.accumulator+=this.dt;this.accumulator>=this.delta&&(this.update(this.step),!this.isStopped);)this.accumulator-=this.delta;h.clearRect(0,0,f.width,f.height),this.render(),this.rAF=requestAnimationFrame(this.frame.bind(this))}start(){this.isStopped&&(this.last=performance.now(),this.isStopped=!1,this.rAF=requestAnimationFrame(this.frame.bind(this)))}stop(){this.isStopped=!0,cancelAnimationFrame(this.rAF)}update(){}fill_canvas(t,e="destination-under",s=null){h.save(),h.globalCompositeOperation=e,h.fillStyle=t,s?h.fillRect(s.x,s.y,s.width,s.height):h.fillRect(0,0,f.width,f.height),h.restore()}renderInside(){}render(){this.fill_canvas(se,"source-over"),this.renderInside()}},St=class i{constructor({spriteSheet:t,frames:e,frameRate:s,loop:a=!0,name:o}){let{width:l,height:d,spacing:m=0,margin:w=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:e,frameRate:s,loop:a,name:o,width:l,height:d,spacing:m,margin:w,isStopped:!1,_f:0,_a:0})}clone(){return new i(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1){this.stop();return}for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:e,width:s=this.width,height:a=this.height,context:o=o}){let l=this.frames[this._f]/this.spriteSheet._f|0,d=this.frames[this._f]%this.spriteSheet._f|0;o.drawImage(this.spriteSheet.image,this.margin+d*this.width+(d*2+1)*this.spacing,this.margin+l*this.height+(l*2+1)*this.spacing,this.width,this.height,t,e,s,a)}},E=class{constructor({image:t,frameWidth:e,frameHeight:s,spacing:a=0,margin:o=0,animations:l}={}){this.animations={},this.image=t,this.frame={width:e,height:s,spacing:a,margin:o},this._f=(t.width-o)/e|0,this.createAnimations(l)}parseFrames(t){if(+t==t)return t;let e=[],s=t.split(".."),a=+s[0],o=+s[1],l=a;if(a<o)for(;l<=o;l++)e.push(l);else for(;l>=o;l--)e.push(l);return e}createAnimations(t){let e,s;for(s in t){let{frames:a,frameRate:o,loop:l}=t[s];e=[],[].concat(a).map(d=>{e=e.concat(this.parseFrames(d))}),this.animations[s]=new St({spriteSheet:this,frames:e,frameRate:o,loop:l,name:s})}}},ht=class{constructor(t){Object.assign(this,Object.assign({maxValue:100,minValue:0,value:0,x:0,y:0,anchor:{x:0,y:0},scaleX:1,scaleY:1,parent:null,visible:!0,width:1,height:1,world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}},t)),"animations"in t&&(this.animations=rt(t.animations),Object.keys(this.animations).map(e=>{let s=new $({width:12,height:4,animations:rt(t.animations),flipy:t.flipy||!1});return s.playAnimation(e),s}).forEach(e=>{this.addChild(e)}),this.width=Math.max(this.width,12),this.height=Math.max(this.height,4))}addChild(t){let e=this.objects||[];t.parent=this,e.push(t),this.objects=e}removeChild(t){let e=this.objects||[],s=e.indexOf(t);s>=0&&e.splice(s,1),t.parent=null}update(t=O){this.advance(t)}advance(t=O){let e=this.parent?.world||{x:0,y:0,width:0,height:0,scaleX:1,scaleY:1};this.world.scaleX=this.scaleX*e.scaleX,this.world.scaleY=this.scaleY*e.scaleY,this.world.x=this.x+e.x,this.world.y=this.y+e.y,this.world.width=this.width*e.scaleX,this.world.height=this.height*e.scaleY,this.world.dirty=!0;let s=this.value/(this.maxValue-this.minValue);this.objects[1].scaleX=s,(this.objects||[]).forEach(a=>a.update&&a.update(t))}render(){this.visible&&(h.save(),h.translate(this.x-this.width*this.anchor.x*this.scaleX,this.y-this.height*this.anchor.y*this.scaleY),h.scale(this.scaleX,this.scaleY),(this.objects||[]).forEach(t=>t.render&&t.render()),h.restore())}},Rt=class extends ${constructor(t){super(Object.assign({shinedx:0,shinetime:5},t))}pickup(){return!1}update(t){let e=it(c.world,this.world);if(e<=c.attractionRange){let s=K(this.world,c.world),a=c.attractionSpeed/2+(1-e/c.attractionRange)*c.attractionSpeed*.75;this.dx=s.x*a,this.dy=s.y*a}else this.dx=0,this.dy=0;this.advance(t),c.hurtBox.intersects(this.hurtBox)&&this.pickup()&&T.removeChild(this),this.shinedx+=t,this.shinedx>=this.shinetime&&(this.shinedx=0,this.playAnimation("shine"))}},At=class{constructor(t){Object.assign(this,Object.assign({icon:null,cardWidth:8,cardHeight:8,border:{l:1,r:2,b:-.5,t:-.5},color:"#333333",borderColor:"#000000",emptyColor:"#000000",filledColor:"#00FF00",anchor:{x:.5,y:.5},banchor:{x:.26,y:.5},world:{x:0,y:0,width:0,height:0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}},t)),this.icon=rt(this.icon),this.frame=this.icon[Object.keys(this.icon)[0]],this.frameCoords={y:this.frame.frames[0]/this.frame.spriteSheet._f|0,x:this.frame.frames[0]%this.frame.spriteSheet._f|0},this.scale={x:(this.cardWidth-3)/this.frame.width,y:(this.cardHeight-3)/this.frame.height},this.iconSize={x:this.frame.width*this.scale.x,y:this.frame.height*this.scale.y}}update(t){this.frame.update(t)}render(){h.save(),h.save();let t=this.cardWidth+this.border.l+this.border.r,e=this.cardHeight+this.border.t+this.border.b;h.translate(-t*this.banchor.x,-e*this.banchor.y),h.fillStyle=this.borderColor,h.fillRect(0,0,t,e),h.fillStyle=this.color,h.translate(.1,.1),h.fillRect(0,0,t-.2,e-.2),h.restore();let s=1,a=1;for(let o=1;o<=this.item.maxLevel;o++){h.fillStyle=this.emptyColor;let l=Math.floor(o/4);h.fillRect(-t*this.banchor.x+this.cardWidth+2*(l-1),-e*this.banchor.y+.65+(1.5+.5)*(o-l*3-1),1.5,1.5),h.fillStyle=o<=this.item.level?this.filledColor:"#555555",h.fillRect(-t*this.banchor.x+this.cardWidth+2*(l-1)+.1,-e*this.banchor.y+.65+(1.5+.5)*(o-l*3-1)+.1,1.3,1.3)}h.scale(this.scale.x,this.scale.y),h.translate(-this.frame.width*this.anchor.x,-this.frame.height*this.anchor.y),h.drawImage(this.frame.spriteSheet.image,this.frame.margin+this.frameCoords.x*this.frame.width+(this.frameCoords.x*2+1)*this.frame.spacing,this.frame.margin+this.frameCoords.y*this.frame.height+(this.frameCoords.y*2+1)*this.frame.spacing,this.frame.width,this.frame.height,0,0,this.frame.width,this.frame.height),h.restore()}},Bt=function(i){return new Rt(Object.assign({animations:y[12].animations,anchor:{x:.5,y:.5},score:1,hurtWidth:4,hurtHeight:4,scaleX:1,scaleY:1,pickup:function(){return c.score+=this.score,c.addXp(this.score),W.pickup.play(),!0}},i))},le=function(i){return Bt(Object.assign({animations:y[16].animations,pickup:function(){return c.score+=this.score,W.pickup.play(),ot=!0,!0}},i))},Wt=function(i){return new $(Object.assign({x:0,y:0,anchor:{x:.5,y:.5},animations:y[8].animations,ttl:30,update:function(){this.advance(),this.ttl<=0&&T.removeChild(this)}},i))},Yt=function(i){return new $(Object.assign({targetType:1,direction:{x:1,y:0},speed:5,hurtWidth:1,hurtHeight:1,damage:1,removeOnHit:!0,cooldown:.5,dt:0,update:function(t){if(this.dt-=t,this.dx=this.direction.x*this.speed,this.dy=this.direction.y*this.speed,this.advance(t),this.dt<=0)switch(this.targetType){case 1:let e=tt.getEnemies();for(let s=0;s<e.length;s++){let a=e[s];if(this.hurtBox.intersects(a.hurtBox)){if(a?.takeDamage&&a.takeDamage(this.damage),this.removeOnHit){this.ttl=0;break}this.dt=this.cooldown}}break;case 2:if(this.hurtBox.intersects(c.hurtBox)){if(c?.takeDamage&&c?.takeDamage(this.damage),this.removeOnHit){this.ttl=0;break}this.dt=this.cooldown}break;default:}this.ttl<=0&&T.removeChild(this)}},i))},Ft=function(i){return new $(Object.assign({aiTransitions:{},aiState:"n",aiDt:0,aiLastStackReturn:null,update:function(t){this.advance(t),this.aiState in this&&this[this.aiState](),(this.aiTransitions[this.aiState]||[]).every(e=>(this.aiLastStackReturn=this[e.method](...(e.args||[]).concat([this.aiLastStackReturn])),this.aiLastStackReturn)),this.aiLastStackReturn=null},changeState(t){this.aiState=t},aiDeltaUpdate(t){return(this.aiDt<=0||this.aiDt>t)&&(this.aiDt=t),this.aiDt=this.aiDt-O,this.aiDt<=0}},i))},ct=function(i){return Ft(Object.assign({targetType:1,anchor:{x:.5,y:.5},bulletSpeed:15,reloadTime:1,maxAttackRange:50,shootSound:null,level:1,maxLevel:5,icon:null,damage:1,reload:function(){let t=Math.max(O,this.reloadTime*(1/this.level));return this.aiDeltaUpdate(t)},getClosestTargetInRange:Ot,fire:function(t){if(t==null)return null;let e=Yt(Object.assign({x:this.world.x,y:this.world.y,speed:this.bulletSpeed+(1-1/this.level)*this.bulletSpeed,direction:t.dir,ttl:1/O*5,color:"#00FF00",width:1,height:1,scaleX:1,scaleY:1,targetType:this.targetType,level:this.level,damage:this.damage*((this.targetType==1?1:0)+this.level)},this.bulletArgs));return this.shootSound&&this.shootSound.play(),e},addToMap:function(t){return t!=null&&T.addChild(t),!0},aiTransitions:{seek:[{method:"getClosestTargetInRange",args:[]},{method:"fire",args:[]},{method:"addToMap",args:[]},{method:"changeState",args:["reloadg"]}],reloadg:[{method:"reload",args:[]},{method:"changeState",args:["seek"]}]},aiState:"seek"},i))},at=.75,oe=function(){let i=new ht({x:0,y:4,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,animations:y[10].animations}),t=new ht({x:0,y:5.5,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,flipy:!0,animations:y[13].animations}),e=new $({score:0,xp:0,level:1,curHealth:10,maxHealth:10,speed:20,attractionRange:10,attractionSpeed:40,x:0,y:0,width:4,height:8,anchor:{x:.5,y:.5},scaleX:1,scaleY:1,groundFriction:8,animations:y[0].animations,hurtWidth:7,hurtHeight:7,reset:function(){this.score=0,this.xp=0,this.level=1,this.curHealth=10,this.maxHealth=10,this.attractionRange=10,this.speed=20,this.objects=[this.objects[0],this.objects[1]]},addXp:function(s){this.xp+=s,this.xp>=this.nextLevelXp()&&(this.xp-=this.nextLevelXp(),this.level+=1,this.levelUp())},nextLevelXp:function(){return this.level*5},levelUp:function(){let s=Object.keys(ut),a=this.objects.filter(d=>d?.level==d?.maxLevel).map(d=>d.itemType),o=this.objects.reduce((d,m)=>d+(m.itemFlavor=="d"?m.level:0),0),l=s.filter(d=>!a.includes(d)&&(bt[d]=="support"&&o>1||bt[d]!="support"));l.length>0&&this.addItem(ut[l[Math.floor(Z(0,1)*l.length)]]()),[1,2,3].forEach(d=>{T.addChild(Wt({x:this.world.x+Z(-8,8),y:this.world.y+Z(-8,8),animations:y[9].animations,scaleX:Z(.8,1.1),scaleY:Z(.8,1.1)}))}),W.lvlup.play()},getActions:function(){return{leftpressed:U("KeyA")||U("ArrowLeft"),rightpressed:U("KeyD")||U("ArrowRight"),downpressed:U("KeyS")||U("ArrowDown"),uppressed:U("KeyW")||U("ArrowUp")}},update:function(s){let a=this.getActions(),o=et({x:(a.leftpressed?-1:0)+(a.rightpressed?1:0),y:(a.uppressed?-1:0)+(a.downpressed?1:0)});this.dx=Mt(this.dx+o.x*this.speed,-this.speed,this.speed),this.dy=Mt(this.dy+o.y*this.speed,-this.speed,this.speed),o.x==0&&this.dx!=0&&(this.dx=Math.max(0,this.dx+-1*Math.sign(this.dx)*this.groundFriction),Math.abs(this.dx)<=1&&(this.dx=0)),o.y==0&&this.dy!=0&&(this.dy=Math.max(0,this.dy+-1*Math.sign(this.dy)*this.groundFriction),Math.abs(this.dy)<=1&&(this.dy=0)),this.dx!=0&&(this.flipx=this.dx<0),this.advance(s),this.objects[0].value=this.curHealth,this.objects[0].maxValue=this.maxHealth,this.objects[1].value=this.xp,this.objects[1].maxValue=this.nextLevelXp(),this.invunldt=Math.max(0,this.invunldt-s),this.invert=this.invunldt>0&&(this.invunldt/at>=.25&&this.invunldt/at<=.5||this.invunldt/at>=.75&&this.invunldt/at<=1)},takeDamage(s){this.invunldt>0||(this.curHealth=Math.max(0,this.curHealth-s),this.invunldt=at)},addItem(s){let a=this.objects.filter(o=>o?.itemType==s?.itemType);a.length>0?a[0].level=Math.min(a[0].level+1,a[0].maxLevel):(this.addChild(s),dt.addChild(new At({icon:s.icon,x:10,y:10,item:s,scaleX:1/(2/s.width),scaleY:1/(2/s.height)})))}});return e.addChild(i),e.addChild(t),e},Xt=function(i){let t=ct({x:0,y:0,width:7,height:7,scaleX:1,scaleY:1,bulletSpeed:0,maxAttackRange:3.5,targetType:2,damage:i.damage,level:i.level,bulletArgs:{anchor:{x:.5,y:.5},hurtHeight:i.hurtHeight||7,hurtWidth:i.hurtWidth||7,ttl:1,removeOnHit:!1}}),e=new ht({x:0,y:4,anchor:{x:.5,y:.5},width:12,height:4,scaleX:.75,scaleY:.5,value:30,animations:y[10].animations}),s=Ft(Object.assign({scoreAmt:1,curHealth:10,maxHealth:10,x:100,y:100,anchor:{x:.5,y:.5},animations:y[1].animations,scaleX:1,scaleY:1,hurtWidth:7,hurtHeight:7,createDropItem:Bt,_lastflipx:0,updateDirection:function(){return this._lastflipx=Math.max(0,this._lastflipx-O),this._lastflipx<=0&&(this.flipx=this.dx<0,this._lastflipx=.5),!0},takeDamage:function(a){this.curHealth=Math.max(0,this.curHealth-a),this.curHealth<=0?this.die():W.ehit.play()},updateHealthBar:function(){return this.objects[0].y=this.height/2*this.scaleY,this.objects[0].value=this.curHealth,this.objects[0].maxValue=this.maxHealth,this.objects[0].visible=this.curHealth!=this.maxHealth,!0},die:function(){this.curHealth=0,T.removeChild(this),T.addChild(Wt({x:this.world.x,y:this.world.y})),W.edie.play(),T.addChild(this.createDropItem({x:this.world.x,y:this.world.y,score:this.scoreAmt}))},reinit:function(a){this.init(a),this.objects[1].damage=a.damage,this.objects[1].level=a.level}},i));return s.addChild(e),s.addChild(t),s},xt=150,jt=class{constructor(t={}){Object.assign(this,Object.assign({enemyArgs:[],bossArgs:null,maxEnemies:50,sps:2},t)),this.x=0,this.y=0,this.dx=0,this.dy=0,this.ddx=0,this.ddy=0,this.scaleX=1,this.scaleY=1,this.width=1,this.height=1,this.world={x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},this.enemyList=[],this._dt=0}reset(){this.enemyList=[],this.boss=null,this._dt=0}_assignRandPos(t){let e=Lt({x:1,y:0},Z(-Math.PI,Math.PI));t.x=c.world.x+xt*e.x,t.y=c.world.y+xt*e.y}update(t=O){if(this._dt-=t,this._dt<=0){let p=Math.max(O,this.sps-Math.floor(P/15)*.25);this._dt=p;let j=this.getEnemies();if(j.length<this.maxEnemies){var e;j.length<this.enemyList.length?(e=this.enemyList.filter(r=>r.curHealth<=0)[0],e.reinit(this.pickEnemy())):(e=Xt(this.pickEnemy()),e.parent=this,this.enemyList.push(e)),e.speed=e.speed*Z(.9,1.1),this._assignRandPos(e)}!this?.boss&&P>=120&&(this.boss=Xt(this.bossArgs),this._assignRandPos(this.boss),this.enemyList.push(this.boss))}let s={},a=64,o=12,l=6,d=.3,m=.1,w=.1;this.getEnemies().forEach(p=>{it(c.world,p.world)>xt*2&&this._assignRandPos(p);let j=""+Math.floor(p.world.x/a)+","+Math.floor(p.world.y/a),r=s[j]||[];r.push(p),s[j]=r}),Object.values(s).forEach(p=>{if(p.length<=1)return;let j=p.map(r=>({x:r.x,y:r.y,world:r.world,dx:r.dx,dy:r.dy,enemy:r}));j.forEach(r=>{let u=0,B=0,I=K(r.world,c.world),_=0,L=0,b=0,C={x:0,y:0},g={x:0,y:0},S={x:0,y:0};if(p.forEach(n=>{n.etype==r.enemy.etype&&(g.x+=n.world.x,g.y+=n.world.y,_+=1),!(r.enemy==n||it(r,n)>o)&&(n.etype==r.enemy.etype&&(L+=1,C.x+=n.dx,C.y+=n.dy),b+=1,S.x+=n.world.x-r.world.x,S.y+=n.world.y-r.world.y)}),L>0||_>0||b>0){let n=1;L>0&&(C.x/=L,C.y/=L,C=et(C),n-=w),_>0&&(g.x=g.x/_-r.world.x,g.x=g.y/_-r.world.y,g=et(g),n-=m),b>0&&(S.x/=-1*b,S.y/=-1*b,S=et(S),n-=d);let v=et({x:r.dx,y:r.dy}),H=et({x:C.x*w+g.x*m+S.x*d+v.x*n,y:C.y*w+g.y*m+S.y*d+v.y*n});r.dx=H.x*r.enemy.speed,r.dy=H.y*r.enemy.speed}}),j.forEach(r=>{r.enemy.dx=r.dx,r.enemy.dy=r.dy})}),(this.getEnemies()||[]).forEach(p=>p.update&&p.update(t))}pickEnemy(){let t=Math.floor(P/30);return this.enemyArgs[Math.floor(Z(0,1)*Math.min(t,this.enemyArgs.length))]}getEnemies(){return this.enemyList.filter(t=>t.curHealth>0)}render(){h.save(),(this.x||this.y)&&h.translate(this.x,this.y),(this.getEnemies()||[]).forEach(t=>t.render&&t.render()),h.restore()}},de=function(){T=new wt({animations:y[11].animations}),c=oe(),tt=new jt({enemyArgs:[{etype:"blcat",scoreAmt:1,curHealth:3,maxHealth:3,damage:1,level:1,speed:15,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:y[1].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=K(this.world,c.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}},{etype:"brcat",scoreAmt:2,curHealth:8,maxHealth:8,damage:1,level:1,speed:15,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:y[2].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=K(this.world,c.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}},{etype:"ninja",scoreAmt:3,curHealth:10,maxHealth:10,damage:2,level:1,speed:20,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:y[3].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=K(this.world,c.world),e=it(this.world,c.world),s=Lt(t,Math.PI/4*Math.min(1,e/150));return this.dx=s.x*this.speed,this.dy=s.y*this.speed,!0}},{etype:"floaty",scoreAmt:3,curHealth:15,maxHealth:15,damage:3,level:1,speed:21,hurtWidth:7,hurtHeight:7,anchor:{x:.5,y:.5},animations:y[4].animations,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=K(this.world,c.world),e=ne(t);return e.x*=Math.sin(P*Math.PI),e.y*=Math.sin(P*Math.PI),this.dx=(t.x*2/3+e.x/3)*this.speed,this.dy=(t.y*2/3+e.y/3)*this.speed,!0}}],bossArgs:{etype:"bigcat",scoreAmt:13e3,curHealth:1e3,maxHealth:1e3,damage:2,level:1,speed:12,hurtWidth:7*3,hurtHeight:7*3,anchor:{x:.5,y:.5},scaleX:3,scaleY:3,animations:y[1].animations,createDropItem:le,aiTransitions:{seek:[{method:"updateDirection",args:[]},{method:"moveToPlayer",args:[]},{method:"updateHealthBar",args:[]}]},aiState:"seek",moveToPlayer:function(){let t=K(this.world,c.world);return this.dx=t.x*this.speed,this.dy=t.y*this.speed,!0}}});let i=W.background;P=0,yt=new _t({audio:i,speedCheck:0,maxAudioSpeed:5,_oldk:{},update:function(t){if(c.curHealth<=0){this.audio.pause(),!this._playedgover&&W.gover.play()&&(this._playedgover=!0),this.updateGameOver(t);return}if(ot){this.audio.pause(),!this._playedgover&&W.gwin.play()&&(this._playedgover=!0),this.updateGameOver(t);return}let e=U("KeyM");if(this._oldk.m&&!e&&(this.audio.paused?this.audio.play():this.audio.pause()),this._oldk.m=e,P+=t,T.update(t),dt.update(t),this.speedCheck-=t,this.speedCheck<=0){this.speedCheck=5;let a=.75+Math.abs(Math.sin(P*.5))*.25;this.audio.playbackRate=Math.max(.35,tt.getEnemies().length/tt.maxEnemies*this.maxAudioSpeed*a)}let s=Math.round(Math.max(0,5-P)/5*255);this.titleColor="#000000"+s.toString(16).padStart(2,"0")},updateGameOver:function(t){let e=U("Space");this._oldk.p&&!e&&this.reset(),this._oldk.p=e,this.titleColor="black"},reset:function(){ot=!1,this._playedgover=!1,P=0,dt.reset(),tt.reset(),this.speedCheck=0,c.reset(),c.x=50,c.y=50,c.addItem(ut.pew()),T.reset(),T.addChild(c),T.addChild(tt),this.audio.tryplay()},renderInside:function(){h.save(),T.render(),Q("score: "+c.score,{x:f.width/k/2-20,y:8},"8px serif"),Q("x: "+Math.round(c.world.x)+", y: "+Math.round(c.world.y),{x:0,y:8},"5px serif"),dt.render(),ot?(h.fillStyle="#44a35455",h.fillRect(0,0,f.width,f.height),h.fillStyle="#000000",Q("You Win",{x:f.width/k/2-42,y:f.height/k/2},"16px serif"),Q("<Space> to Restart",{x:f.width/k/2-75,y:f.height/k/2+16},"16px serif")):c.curHealth<=0&&(h.fillStyle="#a3464455",h.fillRect(0,0,f.width,f.height),h.fillStyle="#000000",Q("Game Over",{x:f.width/k/2-45,y:f.height/k/2},"16px serif"),Q("<Space> to Restart",{x:f.width/k/2-75,y:f.height/k/2+16},"16px serif")),h.fillStyle=this.titleColor,Q("Black Cat Survivor",{x:f.width/k/2-75,y:f.height/k/2-16},"16px serif"),h.fillStyle="#000000",h.restore()}}),yt.reset(),yt.start()};he("./assets/characters.png").then(()=>{y=[{idle:[0],img:A["./assets/characters.png"]},{idle:[1],img:A["./assets/characters.png"]},{idle:[1],img:F(A["./assets/characters.png"],{141414:"381616",282828:"382716",323232:"381d16","3c3c3c":"382716","1e1e1e":"382716"})},{idle:[27],img:A["./assets/characters.png"]},{idle:[33],img:A["./assets/characters.png"]}].map(i=>new E({image:i.img,frameWidth:8,frameHeight:8,animations:{idle:{frames:i.idle,frameRate:1,loop:!0}}})),y=y.concat(new E({image:F(A["./assets/characters.png"],{"000000":"5f6902",fafafa:"c4cb06"}),frameWidth:4,frameHeight:4,animations:{fly:{frames:[24,25],frameRate:8,loop:!0}}}),new E({image:F(A["./assets/characters.png"],{"000000":"ff5fff",fafafa:"ff9cec"}),frameWidth:4,frameHeight:4,animations:{fly:{frames:[36,37,38,39],frameRate:8,loop:!0}}}),new E({image:F(A["./assets/characters.png"],{323232:"670404",646464:"c11010"}),frameWidth:8,frameHeight:8,animations:{fly:{frames:[12,13,14,15],frameRate:4,loop:!0}}}),new E({image:A["./assets/characters.png"],frameWidth:16,frameHeight:16,animations:{explode:{frames:[1,2,5,8],frameRate:8,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{fafafa:"1ff1b7"}),frameWidth:16,frameHeight:16,animations:{explode:{frames:[1,2,5,8],frameRate:8,loop:!1}}}),new E({image:A["./assets/characters.png"],frameWidth:12,frameHeight:4,animations:{back:{frames:[24],frameRate:1,loop:!1},fore:{frames:[25],frameRate:1,loop:!1}}}),new E({image:A["./assets/characters.png"],frameWidth:8,frameHeight:8,animations:{variant1:{frames:[24],frameRate:1,loop:!1},variant2:{frames:[25],frameRate:1,loop:!1},variant3:{frames:[26],frameRate:1,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{323232:"3ba2ff",646464:"6ae4ff","000000":"3f37ff"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[84],frameRate:1,loop:!1},shine:{frames:[84,85,86,87,88,89],frameRate:6,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{aa3c3c:"3ba2ff"}),frameWidth:12,frameHeight:4,animations:{back:{frames:[24],frameRate:1,loop:!1},fore:{frames:[25],frameRate:1,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{323232:"a03030"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[78],frameRate:1,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{323232:"702b88"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[79],frameRate:1,loop:!1}}}),new E({image:F(A["./assets/characters.png"],{323232:"ad5fff",646464:"dcb1fe","000000":"8f0dff"}),frameWidth:4,frameHeight:4,animations:{idle:{frames:[84],frameRate:1,loop:!1},shine:{frames:[84,85,86,87,88,89],frameRate:6,loop:!1}}})),ae(),de()});})();
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
