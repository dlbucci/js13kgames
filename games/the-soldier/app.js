const e=globalThis;function t(t,n,a){if(!e.document)return;const o=Object.assign(document.createElement(t),n);return o.textContent=n.txt,a&&a.appendChild(o),o}function n(e,t){return Math.sqrt((e.x-t.x)**2+(e.y-t.y)**2)}const a=e=>e+String(Math.random()).split(".")[1],o=e=>Math.round(2e3-10*e);let s=!1;const r=6.283,c=e.document?.body,l={},i=()=>Object.values(l),m=(e,t)=>{delete l[e.id],t&&e.remove()},d={},y=()=>Object.values(d),u=e=>{e.remove(),delete d[e.id]},x=[{m:0,f:0,c:0,s:0},{m:0,f:0,c:0,s:0},{m:0,f:0,c:0,s:0},{m:0,f:0,c:0,s:0}],f=document.querySelectorAll("header li p");function h(t,n){const a=n.s?"s":n.c?"c":n.fem?"f":"m";x[n.we?0:1][a]++,document.querySelector("header").className="",t.p==e.p&&(x[n.we?2:3][a]++,document.querySelector("header li.me").className="me");for(let e=0;e<4;e++)f[e].textContent=`soldiers:${x[e].s} man:${x[e].m} woman:${x[e].f} children:${x[e].c}`}const v=e=>Object.values(x[e]).reduce((e,t)=>e+t),w=(e,t)=>Math.abs(e-t);Array.prototype.rnd=function(){return this[~~(Math.random()*this.length)]},e.camX=0,e.camY=0;const g=50,p=18;let b=99,M=0,$=0,k=0;const A=t("div",{id:"canvas-box"},c),T=t("div",{id:"canvas"},A);function N(t){if(t==e.p){const e=b-t.x,n=M-(t.y+t.h/2),a=(e>0?Math.min(e,30):Math.max(e,-30))/2,o=(n>0?Math.min(n,20):Math.max(n,-20))/3;t={x:t.x+a,y:t.y+o}}I((10*e.camX+t.x)/11,(10*e.camY+t.y)/11)}function I(t,n){e.camX=t,e.camY=n,T.style.left=g-e.camX+"em",T.style.bottom=p-e.camY+"em",O()}e.camTo={x:0,y:0};const L=t("div",{id:"target"},T);function O(){b=$/em-g+e.camX,M=-(k-Q-Z)/em-p+e.camY,L.style.left=b+"em",L.style.bottom=M+"em"}function C(){return{x:b,y:M}}function E(e){const n=t("o",{},T);n.t=Date.now(),n.id=e.id+n.t,n.p=e,n.vx=Math.cos(e.gun.a),n.vy=-Math.sin(e.gun.a),n.x=e.x+e.w/2+3*n.vx,n.y=e.y+e.h/2+3*n.vy,d[n.id]=n}function D(t,n){X(),setTimeout(()=>{T.className="",i().filter(t=>t!=e.p).forEach(m);for(let t of[...T.childNodes])t!=e.p&&t!=L&&t.remove();t(),setTimeout(Y,500,n)},2e3)}function X(){c.className="sOut"}function Y(e=w){c.className="sIn",setTimeout(()=>{c.className="",e()},2e3)}function j(n,a,o={}){const s=t("b",{className:"speak",style:`--s:${o.s||1.5}rem`},T),r=(t("p",{txt:a},s),t("i",{style:`--x:${n.w/2+1.5}em`},s)),c=()=>(n.x-2)*e.em;return s.style.bottom="999em",setInterval(()=>{const t=(100+e.camX)*e.em-s.clientWidth-51*e.em,a=-t+c();if(s.style.left=c()+"px",s.style.bottom=n.y+n.h+1+"em",r.style.transform="",r.className="",a>0){const e=s.clientWidth;s.style.left=t+"px";const o=a+(n.w+1)*em>e;r.style.transform=o?"rotate(-90deg)":`translateX(${a}px)`,o&&(r.className="offR")}else{const t=(e.camX-g+1)*e.em,a=t-c();if(a>0){s.style.left=t+"px";const o=a>n.w*e.em;r.style.transform=o?"rotate(90deg)":`translateX(${-a}px)`,o&&(r.className="offL")}}},60),Object.assign(s,{rm(){}})}function W(e,n,a,o={}){const s=t("div",{className:"news new "+o.c},c);s.show=()=>(setTimeout(()=>s.classList.remove("new"),50),s),t("h2",{txt:n},s);const r=t("header",{},t("header",{},s)),l=T.cloneNode(!0);l.style.left=1.4*-e.x+26+"em",l.style.bottom=1.4*-e.y+13+"em",r.appendChild(l),a=a.trim().split("\n").map(e=>e.trim()).join("\n");for(let e=0;e<2;e++){a+="\n\nBla";for(let t=0;t<30+10*e;t++)Math.random()<.7&&(a+=Math.random()<.2?[". Bla","! Bla",", "].rnd():" "),a+="bla";a+="."}return t("p",{txt:a},s),s}function H(n,s,r,c={}){const i=s-n;c.id??=a("w");const m=t("wall",{update(){m.style.setProperty("--o",e.p.y>r?.4:1)},className:"h "+c.c,style:`left:${n}em;bottom:${r}em;width:${i}em;z-index:${o(r)}`,...c,x1:n,x2:s,y:r,wall:1,h:1},T);l[m.id]=m}function z(e,n,s,r={}){r.d??=s-n,r.w??=1,r.id??=a("w");const c=t("wall",{update(){},className:"v "+r.c,style:`left:${e}em;bottom:${n}em;width:${r.w}em;height:${r.d+12}em;z-index:${o(n)}`,...r,x:e,y1:n,y2:s,wall:1,v:1},T);l[c.id]=c}function P(e,n,s,r,c={}){const i=e<s?-1:1,m=w(e,s);c.id??=a("w");const d=t("wall",{update(){},className:"d "+c.c,style:`left:${-1==i?e:s}em;bottom:${(n+r)/2}em;width:${m}em;z-index:${o(r)};transform:skewY(${i*Math.atan((r-n)/m)}rad)`,...c,x1:e,y1:n,x2:s,y2:r,skew:i,wall:1,dg:1},T);l[d.id]=d}function S(e,n,o,s,r,c={}){c.id??=a("b");const i=t("box",{style:`left:${e}em;bottom:${n}em;width:${o}em;height:${s+r}em`,update(){},...c},T);return t("div",{style:`height:${r}em`},i),l[i.id]=i}function F(n,r,c={}){c.rnd??=[],c.rndC??=[],c.id??=a("p");const i=t("p",{id:c.id,className:`person ${c.s&&"s"} ${c.we?"we":"they"} ${c.fem&&"fem"} ${c.c&&"c"} `+Array(9).fill(0).map((e,t)=>`rnd${t}-`+(c.rndC[t]??Math.floor(6*Math.random()))).join(" "),style:Array(9).fill(0).map((e,t)=>`--rnd${t}:`+(c.rnd[t]??Math.random())).join(";")},T);t("b",0,i);const d=t("h",0,i);t("w",0,d);t("a",0,i),t("f",0,i);const y=t("bl",{},i),u=t("g",{},i);u.a=.5,u.l=0,u.f=t("f",{},u),t("g1",{},u),t("g2",{},u),t("g3",{},u),t("a",{},u);const x=Object.assign(i,{p:1,w:c.c?2:3,h:c.c?2.5:5,d:1,x:n,y:r,vx:0,vy:0,v:0,a:0,turn:1,gun:u,update(){let t;if(x.x+=x.vx,x.y+=x.vy,x!=e.p&&(x.turn=Math.abs(x.a)>1.6?-1:1),!x.bless&&(t=V(x))){if(y.style.bottom=(t.y-x.y+x.h/2)/2+"em",x==te)return e.pDeadCb();m(x),h(t,x),x.die=1,x.gun.t=0,x.gun.a=x.turn>0?x.gun.a>0?1.8:-1.8:x.gun.a>0?1.3:-1.3,x.classList.add("die"),i.style.transition="cubic-bezier(0, 0, 1, .6) 1s"}const n=R(x);x.x+=n.x,x.y+=n.y,x.die||s&&x==e.p||(x.act?x.act(x):B(x)),x.s&&q(x),x.vx||x.vy?x.classList.add("walk"):x.classList.remove("walk"),i.style.left=x.x+"em",i.style.bottom=x.y+"em",i.style.transform=(c.c?`translate(-.6em,1.2em)scale(${x.die?".5,.66":".66,.5"})`:"")+(""+(x.die?`translate(${-x.turn*x.h/3}em,${x.h/4}em)rotate(${-90*x.turn}deg)`:""))+`scaleX(${x.turn})`,i.style.zIndex=o(x.y)},get isOld(){return 5==c.rndC[2]&&c.rnd[7]>.6}},c);return l[x.id]=x,x}function q(e){const t=-1==e.turn?-1*e.gun.a+Math.PI:e.gun.a;e.gun.style.transform=`scale(${e.c?.9:1},${e.c?1.2:1}) rotate(${t}rad)`;const n=e.we?200:300;e.gun.t&&e.gun.l<Date.now()-n?(e.gun.l=Date.now(),e.gun.f.style.opacity=1,E(e)):e.gun.f.style.opacity=0}function B(e){if(e.dest){if(w(e.dest.x,e.x)<.3&&w(e.dest.y,e.y)<.3)return e.vx=e.vy=0;e.a=Math.atan2(e.y-e.dest.y,e.dest.x-e.x)}e.panic&&(e.v=.4,e.a+=2*Math.random()-1),e.vx=Math.cos(e.a)*e.v,e.vy=-Math.sin(e.a)*e.v,e.s&&G(e)}function G(e){if(l[e.targ?.id]||(e.targ=null),e.targ||(e.targ=i().filter(t=>t.p&&!t.bless&&t.we!=e.we&&n(e,t)<100).rnd()),e.targ){const t=e.y+e.h/2;let n=Math.atan2(t-e.targ.y,e.targ.x-e.x);w(n+r,e.gun.a)<w(n,e.gun.a)&&(n+=r),w(n-r,e.gun.a)<w(n,e.gun.a)&&(n-=r),e.gun.a=(8*e.gun.a+n)/9,(e.gun.a-n)**2<.1&&(e.gun.t=1)}else e.gun.t=0,e.gun.a=1==e.turn?(8*e.gun.a+1)/9:(8*e.gun.a-4)/9;e.turn=e.gun.a>1.57||e.gun.a<-1.57?-1:1}function R(e){const t={x:0,y:0};for(const n of i())if(n!==e){const a=U(e,n);a&&(n.p&&(a.x/=2,a.y/=2),t.x+=a.x,t.y+=a.y)}return t}function U(e,t){let n=null;if(t.wall){if(t.dg){const a=e.x+e.w;if(1==t.skew&&(e.x>t.x1||a<t.x2)||-1==t.skew&&(e.x<t.x1||e.x>t.x2)||e.y<t.y1||e.y>t.y2)return n;const o=w(t.x1,t.x2),s=t.y2-t.y1,r=o*(e.y-t.y1)/s,c=-1==t.skew?t.x1+r:t.x1-r-e.w;(1==t.skew&&c<e.x||-1==t.skew&&c>e.x)&&(n={x:c-e.x,y:0})}if(t.v){if(e.y+e.d<t.y1||e.y>t.y2+.5)return n;const a=e.x+e.w,o=t.x+t.w;e.x<o&&e.x>t.x&&(n={y:0,x:o-e.x}),a>t.x&&a<o&&(n={y:0,x:t.x-a})}if(t.h){if(e.x+e.w<t.x1||e.x>t.x2)return n;const a=e.y+.2,o=e.y-.8,s=t.y+1;o<s&&o>t.y&&(n={x:0,y:s-o}),a>t.y&&a<s&&(n={x:0,y:t.y-a})}return n}const a=e.x,o=e.x+e.w,s=e.y,r=e.y+e.d,c=t.x,l=t.x+t.w,i=t.y,m=t.y+t.d,d=a>=c&&a<l,y=o<=l&&o>c,u=a<=c&&o>=l,x=c<=a&&l>=o,f=s>=i&&s<m;if(d||y||u||x){if(s<=i&&r>=m||i<=s&&m>=r)return d?{x:l-a,y:0}:{x:c-o,y:0};if(f||r<=m&&r>i)return n={x:0},n.y=f?m-s:i-r,u||x||(n.x=y?c-o:l-a),n}}function V(e){for(const t of y())if(t.x>e.x&&t.x<e.x+e.w&&t.y>e.y&&t.y<e.y+e.h)return u(t),t}let J,K,Q,Z;c?.addEventListener("pointermove",e=>{$=e.pageX,k=e.pageY,O()});const _=t("code",{style:"position:absolute; bottom:.5em"},c);function ee(){J=c.clientWidth,K=c.clientHeight,Z=.4*J,Q=(K-Z)/2,e.em=J/100}e.addEventListener("resize",ee),ee();const te=e.p=F(0,0,{id:"player",we:1,s:0,rnd:[.8,.85,.35,0,0,0],rndC:Array(9).fill(0)}),ne=.5;let ae=0,oe=0,se=0,re=0,ce=0,le=Date.now();function ie(){const e=C(),t=te.y+te.h/2;let n=Math.atan2(t-e.y,e.x-te.x);te.gun.a=n}function me(e,t){"arrowleft"!=(e=e.toLowerCase())&&"a"!=e||(ae=t),"arrowright"!=e&&"d"!=e||(oe=t),"arrowup"!=e&&"w"!=e||(se=t),"arrowdown"!=e&&"s"!=e||(re=t)}function de(){T.className="prologue",t("gr",{},T),t("r",{},T),P(-70,-20,-35,15,{c:"bric"});for(let e=-35;e<100;e+=20)H(e,e+13,15,{c:"bric"}),H(e+13,e+20,15,{c:"tree"});const n=e=>{ce%33==0&&(e.a=0),B(e)},a=e=>{ce%33==0&&(e.a=2),B(e)};e.p.bless=1,e.p.v=.2,e.p.dest={x:0,y:0},e.p.act=n;const o=F(4,0,{we:1,fem:1,rnd:[.6,.6,.4,.1,.1,.1,.9],rndC:[1,0,1],v:.2,dest:{x:4,y:0},act:a});for(let e=.3;e<r;e+=1)F(25*Math.cos(e),15*Math.sin(e),{we:1,v:.1,dest:{x:25*Math.cos(e),y:15*Math.sin(e)},act:n}),F(25*Math.cos(e)+4,15*Math.sin(e),{we:1,fem:1,v:.1,dest:{x:25*Math.cos(e)+4,y:15*Math.sin(e)},act:a});const s=[],l={x:-30,y:8};for(let e=0;e<r;e+=.3)s.push(F(5*Math.cos(e)+l.x,5*Math.sin(e)+l.y,{we:1,fem:Math.random()<.5,v:.1,dest:l,act(e){e.a+=Math.random()-.5,ce%222==0&&B(e)}}));let m=["𝆺𝅥𝅯","𝅘𝅥𝅮","𝅘𝅥𝅯","𝅘𝅥𝅰","𝅘𝅥𝅱","𝄢","𝄞","🎵","🎶","🎼"],d=j(s.rnd(),m.rnd());const y=setInterval(()=>{d.remove(),d=j(s.rnd(),m.rnd(),{s:3})},1e3),u=()=>({x:60*Math.random()-30,y:30*Math.random()-18}),f=[];for(let e=0;e<12;e++)f.push(F(u().x,u().y,{we:1,c:1,fem:Math.random()<.5,v:.2,dest:u(),act(e){e.a+=Math.random()-.5,ce%222==0&&B(e)}}));f.n=0;setInterval(()=>{f.n++,f[f.n%12].dest=u()},100);setTimeout(Y,500);let h,g,p,b,M=j(o,"Hey Honey,\nYou will not believe..."),$=0,k=0;function A(){if($++,console.log("Prologue:",$),1==$&&(M.remove(),M=j(e.p,"Tell me!")),2==$&&(M.remove(),M=j(o,"The most cuuuute thing\nI ever saw!"),g=W({x:-5,y:3},"Valentine's Day at Ourland Park","The lovers, friens and families are having a great day!").show()),3==$&&(g.remove(),M.remove(),M=j(e.p,"Oh! I think I already know...")),4==$&&(M.remove(),M=j(o,"A black kitten was\non my window today.")),5==$&&(M.remove(),M=j(e.p,"oOOOooowwww...")),6==$&&(k=1,M.remove(),h=[e.camTo=F(70,0,{we:0,s:1,a:2,vx:-.2,act:e=>{e.x<35&&(h[0].vx=h[1].vx=h[2].vx=0,h[0].act=h[1].act=h[2].act=w,A())}}),F(73,7,{we:0,s:1,a:2,vx:-.2,act:w}),F(73,-7,{we:0,s:1,a:2,vx:-.2,act:w})],h[0].gun.a=h[1].gun.a=h[2].gun.a=2),7==$&&(k=0,M=j(e.p,"WTF?"),e.camTo=e.p,h[0].targ=h[1].targ=h[2].targ=o,g=W({x:30,y:0},"Terrorists from They are invading","We don't know why, but they are here with guns threatening our people.")),8==$){M.remove(),clearInterval(y),d.remove(),h[0].act=h[1].act=h[2].act=null,k=1,i().forEach(t=>{t==e.p||t==o||t.s||(t.panic=1,t.act=t.dest=null)});const t=setInterval(()=>{v(0)>15&&(clearInterval(t),A())},100)}if(9==$){M=j(e.p,"Honey?");const t=setInterval(()=>{for(let e=0;e<3;e++)F(10*e-55+10*Math.random(),-30,{we:1,s:1,vy:.5-.1*e,act(t){t.y>0-2*e&&(t.vy=0,t.act=null)}});h.find(e=>!e.die)||(clearInterval(t),A())},1500)}10==$&&(k=0,M.remove(),M=j(e.p,"HONEY??"),p=W({x:-10,y:0},"Massive killing on Ourland Park",`${v(0)} inocent people, particularly ${x[0].c} children are dead. For now, the threat has been contained by our soldiers.`,{c:"n2"})),11==$&&(M.remove(),M=j(e.p,"HONEY????",{s:3})),12==$&&(M.remove(),M=j(e.p,"AAAAAAAAAAA\nAAAAAAAAA!!!",{s:4}),e.camTo={x:-1,y:0},b=setInterval(()=>{e.camTo.x=e.camTo.x<0?1.5:-1.5},60)),13==$&&(g.show(),p.show()),14==$&&(clearInterval(b),c.removeEventListener("click",N),g.remove(),p.remove(),ye())}const N=()=>k||A();c.addEventListener("click",N)}function ye(){let n,a,o=0,r=0;const l=()=>r||i();function i(){if(o++,console.log("Want to fight:",o),1==o&&(a.remove(),a=j(n,"Good.\nMove to the next room.\n\nUse W S A D or arrow keys.\n\nThere you will receive your\nuniform and weapon.")),2==o){a.remove(),r=s=1;const e=setInterval(()=>{te.x>-24&&(clearInterval(e),i())},50)}3==o&&(te.act=null,te.s=1,te.className+=" s",a=j(te,"Wow!\nMagick?"),setTimeout(i,2e3)),4==o&&(r=0,a.remove(),a=j(n,"Now, you point and click.\n\nCaution! You can kill a brother.")),5==o&&(r=1,setTimeout(()=>a.remove(),1e3),setTimeout(i,4e3)),6==o&&(r=0,a=j(n,"Ok. We are sending you with a retaliation group.")),7==o&&(c.removeEventListener("click",l),setTimeout(ue,1e3))}D(function(){T.className="want",t("gr",{},T),t("rv",{},T),t("fl",{},T),H(-50,200,30,{c:"tree"}),H(-50,200,-35,{c:"tree"}),z(-50,-20,15),z(-25,-20,-10),z(-25,5,15),z(100,-20,15),H(-50,100,15),H(-50,100,-20),S(-40,-5,5,10,3),e.camTo=te,te.v=te.vx=0,te.x=-45,te.dest=null,a=j(te,"I want to fight."),n=F(-30,-5,{we:1,s:1,a:2,bless:1})},()=>c.addEventListener("click",l))}function ue(){let n,a=0;function o(){n=setTimeout(o,1100-te.x),i().filter(e=>e.p).length>30||F(Math.min(te.x+100,990),300*Math.random()-150,{we:0,s:Math.random()<.5,a:2,v:.1,dist:te})}D(function(){T.className="first",t("gr",{},T),H(-200,800,-200,{c:"tree"}),H(-200,800,200,{c:"tree"}),z(-200,-200,200,{c:"tree"}),z(800,-200,200,{c:"tree"});for(let e=-200;e<700;e+=100)for(let t=-195;t<195;t+=15)H(e+30*Math.random()+t%2*50,e+100-30*Math.random()+t%2*50,t+5*Math.random(),{c:"tree"});e.camTo=te,te.vx=te.vy=0,te.x=-100,te.y=0,F(-100,-10,{we:1,s:1,a:2,vx:.1}),F(-100,10,{we:1,s:1,a:2,vx:.1})},function(){a++,console.log("First fight:",a),1==a&&(te.bless=0,o())})}setInterval(()=>{ce++,ce%10==0&&(_.textContent="FPS: "+(1e4/(Date.now()-le)).toFixed(1),le=Date.now());for(const e of y())e.x+=2*e.vx,e.y+=2*e.vy,e.style.left=e.x+"em",e.style.bottom=e.y+"em",Date.now()-e.t>3e3&&u(e);s&&(te.turn=C().x<te.x+1.5?-1:1,ie(),te.vx=(ae?-1:oe?1:0)*ne,te.vy=(re?-1:se?1:0)*ne,te.vx&&te.vy&&(te.vx*=.707,te.vy*=.707));for(const e of i())e.update();N(e.camTo)},20),c.addEventListener("keydown",e=>me(e.key,1)),c.addEventListener("keyup",e=>me(e.key,0)),A.addEventListener("pointerdown",e=>{0==e.button&&(te.gun.t=1)}),c.addEventListener("pointerup",e=>{0==e.button&&(te.gun.t=0)}),e.pDeadCb=()=>{e.pDeadCb=w,te.classList.add("die"),te.act=w,te.v=te.vx=te.vy=0,s=0,setTimeout(()=>{W(te,"A Hero Dies","Maybe he was not that great...").show()},1500)},de();
//# sourceMappingURL=app.js.map