var t=class{R;H;mesh;M;T;A;_;constructor(){this.R=new THREE.BufferGeometry,this.H=new THREE.MeshStandardMaterial({vertexColors:!0}),this.mesh=new THREE.Mesh(this.R,this.H),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.M=[],this.T=[],this.A=[],this._=0}resetBuffers(){this.M=[],this.T=[],this.A=[],this._=0,this.R.setAttribute("position",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setAttribute("color",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setAttribute("normal",new THREE.BufferAttribute(new Float32Array([]),3)),this.R.setIndex([])}addQuad(t,i){let s=t[0],e=t[1],o=(t[2],t[3]),h=(new THREE.Vector3).subVectors(e,s).cross((new THREE.Vector3).subVectors(o,s)).normalize(),n=[0,1,2,0,2,3];for(let s=0;s<6;s++){let e=n[s];this.M.push(t[e].x,t[e].y,t[e].z),this.A.push(h.x,h.y,h.z);let o=(i>>16&255)/255,r=(i>>8&255)/255,a=(255&i)/255;this.T.push(o,r,a),this._++}}updateBuffers(){this.R.setAttribute("position",new THREE.BufferAttribute(new Float32Array(this.M),3)),this.R.setAttribute("color",new THREE.BufferAttribute(new Float32Array(this.T),3)),this.R.setAttribute("normal",new THREE.BufferAttribute(new Float32Array(this.A),3)),this.R.computeVertexNormals(),this.R.attributes.position.needsUpdate=!0,this.R.attributes.color.needsUpdate=!0,this.R.attributes.normal.needsUpdate=!0}render(t){0!==this._&&(t.children.includes(this.mesh)||t.add(this.mesh))}},i=[0,4292465625,4290293945,4288319899,4285358189,4278190080,4280950826,4290938499,4289165163,4286995798,4285089604,4282263344,4287245887,4289216328,4291122768,4292048725,4292647261,4292789621,4289245540,4285503326,4282084184,4281157963,4282806135,4285307815,4288526533,4286483111,4283584371,4282921813,4284560993,4286725737,4290142332,4292059282,4292261809,4284448934,4283852692,4285817487,4285285242,4283709242,4284558136,4281743165,4282592578];function s(t){return i[t]||4294967295}var e=class{F;C;$;Y;X;Z;S;B;O;P;U;I;L;constructor(t){this.$=t?.metersX??10,this.Y=t?.metersY??10,this.X=t?.metersZ??10,this.Z=t?.voxelsPerMeter??8,this.S=1/this.Z,this.B=Math.max(0,this.$/this.S|0),this.O=Math.max(0,this.Y/this.S|0),this.P=Math.max(0,this.X/this.S|0),this.L=t?.origin??{x:0,y:0,z:0},this.U=this.B*this.O,this.I=this.U*this.P,this.F=new Uint8Array(this.I),this.C=null}N(t,i,s){let e=t-this.L.x,o=i-this.L.y,h=s-this.L.z;return e<0||e>=this.$||o<0||o>=this.Y||h<0||h>=this.X}V(t,i,s){let e=t-this.L.x,o=i-this.L.y,h=s-this.L.z,n=e/this.S|0,r=o/this.S|0;return(h/this.S|0)*this.B*this.O+r*this.B+n}D(t,i,s){return t>=0&&t<this.B&&i>=0&&i<this.O&&s>=0&&s<this.P}G(t,i,s){return s*this.U+i*this.B+t}J(t,i,s){return!this.D(t,i,s)||0===this.F[this.G(t,i,s)]}getCube(t,i,s){return this.N(t,i,s)?0:this.F[this.V(t,i,s)]}setCube(t,i,s,e){this.N(t,i,s)||(this.F[this.V(t,i,s)]=e)}K(t,i,s){return 0===this.getCube(t,i,s)}W(){this.C=new t;let i=0;for(let t=0;t<this.P;t++)for(let e=0;e<this.O;e++)for(let o=0;o<this.B;o++){let h=this.F[i++];if(0===h)continue;let n=s(h),r=o*this.S+this.L.x,a=e*this.S+this.L.y,l=t*this.S+this.L.z,u=r+this.S,f=a+this.S,c=l+this.S,d=new THREE.Vector3(r,f,c),m=new THREE.Vector3(u,f,c),E=new THREE.Vector3(u,f,l),w=new THREE.Vector3(r,f,l),p=new THREE.Vector3(r,a,c),y=new THREE.Vector3(u,a,c),R=new THREE.Vector3(u,a,l),v=new THREE.Vector3(r,a,l);this.J(o,e+1,t)&&this.C.addQuad([d,m,E,w],n),this.J(o,e-1,t)&&this.C.addQuad([v,R,y,p],n),this.J(o,e,t+1)&&this.C.addQuad([m,d,p,y],n),this.J(o,e,t-1)&&this.C.addQuad([w,E,R,v],n),this.J(o-1,e,t)&&this.C.addQuad([d,w,v,p],n),this.J(o+1,e,t)&&this.C.addQuad([E,m,y,R],n)}this.C.updateBuffers()}getMesh(t=!1){return(!this.C||t)&&this.W(),this.C.mesh}render(t){this.C&&this.C.render(t)}};function o(t,i,s=0,e=new THREE.Vector3(0,0,0)){let o=t.split("|"),h=o[0]||"",n=o[1]||"",r=o[2]||"",a=h?h.split(","):[],l=[];if(r){let t=r.split(",").filter(Boolean);for(let i=0;i<t.length;i++){let s=parseInt(t[i],10);l[i+1]=isNaN(s)?0:s}}let u=0;for(let t=0;t<8;t++)for(let o=0;o<8;o++){let h=n[u++],r=a["0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_".indexOf(h)];if(r)for(let h=0;h<8;h++){let n=parseInt(r[h]||"0",16);if(0!==n){let r=void 0!==l[n]?l[n]:n,a=t,u=o;switch(s){case 1:a=o,u=7-t;break;case 2:a=7-t,u=7-o;break;case 3:a=7-o,u=t}let f=a/8+e.x,c=h/8+e.y,d=u/8+e.z;i.setCube(f,c,d,r)}}}}var h=["11111111,22212221,00000000|0111011101110111222222222222222222222222222222222222222222222222|3,1","00000000,33330000,33333000,11111111,22212221,00002221,00000221,00000111,11112221|0012210034567584000000000000000000000000000000000000000000000000|3,1,5","11111111,22222222,00000000|0110011001100110222222222222222222222222222222222222222222222222|19,20","00000000,33330000,33333000,11111111,22222222,00002222,00000111|0012210034566543000000000000000000000000000000000000000000000000|19,20,5","12232333,12231223,11121223,23331223,12231112,00000000|0112311401123114555555555555555555555555555555555555555555555555|12,13,14","00000000,22220000,22222000,13343444,13341334,00001334,00000334,13341113|0012210034566547000000000000000000000000000000000000000000000000|12,5,13,14"],n=["00000000,11111111,00000001|0000000100000002000000020000000200000002000000020000000200000001|37","00000000,11111111|0000000100000000000000000000000000000000000000000000000000000001|37"],r=["00000000,33000000,22222220,22111120,11111120,11111111,02222222,02111111,02111122,00000033|0010000002344420555555555555555555555555555555550677786000000900|10,9,4","00000000,00000400,01100000,00004000,01100300,11123000,11120000,11122300,00000030,00000004|0000000000000000010223000045620000267200000228000000009000000000|28,20,19,17","00000000,00011130,01111110,11111110,00011110,01111100,11113110,01110000,11200000,00110000,01200000|01233240042332400056650000788700009aa900000990000000000000000000|1,34,4","00000000,00000020,11000000,00022220,01100020,02222220,00222220,00222200,02222200,22222200,00000200|0011110021333312456776541588885115999951a899998aa899998aa899998a|40,1","11111111,12232241,12322241,13222241,12222231,12222341,14443441,10000001,00000000|0123456007777770888888888888888888888888888888888888888888888888|10,23,24,22","11111111,12322651,13322261,14352221,14442251,14444421,13222521,00000000|0123456077777777777777777777777777777777777777777777777777777777|37,34,26,6,17,24","00000000,11110000,00010000|0000000000000000001221000022220000222200001221000000000000000000|10","11111111,01111110,01111111,01120000,01123000|0122221034444443344444433444444334444443344444433444444334444443|10,1,12","00000000,00010000,00011000,00011111,00001000,00000111|0123321001455410014444100111111000000000000000000000000000000000|4","11111114,22221224,22231234,00000004,00000000|0111111001111110011111100111111001111110011221103333333344444444|9,8,11,40","11111111,00000000,22222220,21111120,03444300|0000000000000000000000000000000000000000123222211141111111111111|2,1,4,40","00000000,11122222,00022222,00020000,11120000|0012210000333300003333000033330000433400000000000000000000000000|10,37","11111111,22213301,33012201,44415551,22013331,55010001,33312221,44410001,00010001,00013331,00000000|00000000012345600127456008279580aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa|10,21,12,16,15","00000002,11111112|0000000000000000000000000000000000000000000000000100000000000000|10,37","00022222,11111100,00020000,00020100|0000000012222221322222233222222332222223322222231222222122222222|10,12"],a=[[1,2],[0],[0,3],[2,4],[3,5,6],[4,10],[4,7,8],[6],[6,9],[8],[5]],l=[{origin:[0,0,5],size:[7,9,3],wallModel:2,doors:[{x:7,z:1,rotation:1},{x:1,z:9,rotation:0}],mouseHoles:[],contents:[{model:r[0],pos:[5,.125,0],rot:3},{model:r[0],pos:[5,1.125,0],rot:1},{model:r[4],pos:[2,1.125,.125],rot:3},{model:r[4],pos:[1,1.125,.125],rot:3},{model:r[6],pos:[1,.125,0],rot:3},{model:r[13],pos:[5,.125,7],rot:3},{model:r[13],pos:[4,.125,7],rot:2},{model:r[13],pos:[5,.125,6],rot:0},{model:r[13],pos:[4,.125,6],rot:1},{model:r[11],pos:[5,.125,5],rot:3}]},{origin:[7,0,5],size:[5,4,3],wallModel:4,doors:[{x:0,z:1,rotation:3}],mouseHoles:[{x:3,z:4,rotation:1}],contents:[{model:r[0],pos:[2,.125,3],rot:1},{model:r[0],pos:[2,1.125,3],rot:3}]},{origin:[0,0,14],size:[7,4,3],wallModel:2,doors:[{x:1,z:0,rotation:2},{x:7,z:1,rotation:1}],mouseHoles:[{x:0,z:2,rotation:0}],contents:[{model:r[4],pos:[3,1.125,2.875],rot:1},{model:r[4],pos:[2,1.125,2.875],rot:1},{model:r[5],pos:[3,1.125,.25],rot:3}]},{origin:[7,0,12],size:[5,5,3],wallModel:4,doors:[{x:0,z:3,rotation:3},{x:3,z:0,rotation:2}],mouseHoles:[{x:2,z:5,rotation:1},{x:1,z:0,rotation:3}],contents:[{model:r[14],pos:[3.75,.125,2],rot:2},{model:r[6],pos:[3.75,.125,3],rot:2},{model:r[1],pos:[3.75,.625,3],rot:2}]},{origin:[7,0,9],size:[8,3,3],wallModel:2,doors:[{x:3,z:3,rotation:0},{x:6,z:0,rotation:2},{x:6,z:3,rotation:0}],mouseHoles:[{x:2,z:0,rotation:3},{x:8,z:1,rotation:2}],contents:[{model:r[12],pos:[.25,.125,1],rot:0},{model:r[12],pos:[.25,1.125,1],rot:0},{model:r[5],pos:[3,1.125,.25],rot:3}]},{origin:[12,0,12],size:[6,6,3],wallModel:2,doors:[{x:1,z:0,rotation:2},{x:6,z:1,rotation:1}],mouseHoles:[{x:1,z:6,rotation:1},{x:4,z:0,rotation:3}],contents:[{model:r[7],pos:[3,.125,4.75],rot:1},{model:r[7],pos:[4,.125,4.75],rot:1},{model:r[7],pos:[3,.125,3.75],rot:3},{model:r[7],pos:[4,.125,3.75],rot:3},{model:r[6],pos:[2,.125,4.75],rot:0},{model:r[0],pos:[3,.125,0],rot:3},{model:r[0],pos:[3,1.125,0],rot:1}]},{origin:[12,0,5],size:[6,4,3],wallModel:2,doors:[{x:1,z:4,rotation:0},{x:2,z:0,rotation:2},{x:6,z:1,rotation:1}],mouseHoles:[{x:0,z:2,rotation:0}],contents:[{model:r[11],pos:[4.5,.125,2.5],rot:2},{model:r[12],pos:[.25,.125,1],rot:0},{model:r[12],pos:[.25,1.125,1],rot:0}]},{origin:[12,0,0],size:[5,5,3],wallModel:4,doors:[{x:2,z:5,rotation:0}],mouseHoles:[{x:0,z:2,rotation:0},{x:0,z:3,rotation:0},{x:5,z:1,rotation:2}],contents:[]},{origin:[18,0,4],size:[5,5,3],wallModel:0,doors:[{x:0,z:2,rotation:3},{x:3,z:5,rotation:0}],mouseHoles:[{x:5,z:3,rotation:2},{x:1,z:5,rotation:1}],contents:[{model:r[10],pos:[.25,.125,.25],rot:3},{model:r[10],pos:[.25,1.125,.25],rot:3},{model:r[9],pos:[1.25,.125,.25],rot:3},{model:r[9],pos:[2.25,.125,.25],rot:3},{model:r[9],pos:[3.25,.125,.25],rot:3},{model:r[8],pos:[3.25,1.5,.25],rot:3}]},{origin:[18,0,9],size:[5,3,3],wallModel:4,doors:[{x:3,z:0,rotation:2}],mouseHoles:[{x:2,z:3,rotation:1},{x:0,z:1,rotation:0}],contents:[]},{origin:[18,0,12],size:[5,4,3],wallModel:0,doors:[{x:0,z:1,rotation:3}],mouseHoles:[{x:2,z:4,rotation:1},{x:2,z:0,rotation:3}],contents:[{model:r[3],pos:[3.5,.125,2],rot:1},{model:r[3],pos:[3.5,.125,1],rot:3},{model:r[2],pos:[.25,.125,2.5],rot:0}]}];function u(t,i,s,e,r){let a=i.origin[0],u=i.origin[1],f=i.origin[2],c=i.size[0],d=i.size[1],m=i.size[2],E=(t,i)=>(0|t)+(0|i)*e;for(let i=0;i<c;i++)for(let s=0;s<d;s++)o("10000000,20000000,30000000|0001000101120112011201121222122200010001011201120112011212221222|3,2,1",t,0,new THREE.Vector3(a+i,u+0,f+s)),o("00000012,00000002|0000000001111110011111100111111001111110011111100111111000000000|37,2",t,0,new THREE.Vector3(a+i,u+(m-1)+.2,f+s));let w=(t,s,e)=>{if(i.doors&&!(s>=2))return i.doors.find(i=>i.x===t&&i.z===e)},p=(t,s,e)=>{if(i.mouseHoles&&!(s>=1))return i.mouseHoles.find(i=>i.x===t&&i.z===e)};for(let e=0;e<c;e++)for(let n=0;n<m;n++)!w(e,n,d)&&!p(e,n,d)&&(o(h[i.wallModel],t,1,new THREE.Vector3(a+e,u+n+.125,f+d-1)),0===n&&(s[E(a+e,f+d-1)]|=1));for(let e=0;e<c;e++)for(let n=0;n<m;n++)!w(e,n,0)&&!p(e,n,0)&&(o(h[i.wallModel],t,3,new THREE.Vector3(a+e,u+n+.125,f+0)),0===n&&(s[E(a+e,f+0)]|=2));for(let e=0;e<d;e++)for(let n=0;n<m;n++)!w(0,n,e)&&!p(0,n,e)&&(o(h[i.wallModel],t,0,new THREE.Vector3(a+0,u+n+.125,f+e)),0===n&&(s[E(a+0,f+e)]|=4));for(let e=0;e<d;e++)for(let n=0;n<m;n++)!w(c,n,e)&&!p(c,n,e)&&(o(h[i.wallModel],t,2,new THREE.Vector3(a+c-1,u+n+.125,f+e)),0===n&&(s[E(a+c-1,f+e)]|=8));if(i.doors)for(let s of i.doors)o(n[1],t,s.rotation,new THREE.Vector3(a+(1===s.rotation?s.x-1:s.x),.125,f+(0===s.rotation?s.z-1:s.z))),o(n[0],t,s.rotation,new THREE.Vector3(a+(1===s.rotation?s.x-1:s.x),1.125,f+(0===s.rotation?s.z-1:s.z)));if(i.mouseHoles)for(let e of i.mouseHoles){let n=2===e.rotation?-1:0,u=1===e.rotation?-1:0,c=a+e.x+n,d=f+e.z+u;s[E(c,d)]|=16+(0===e.rotation?4:1===e.rotation?1:2===e.rotation?8:2),r.registerMouseHole({x:c,z:d,rotation:e.rotation,roomid:l.indexOf(i)}),o(h[i.wallModel+1],t,e.rotation,new THREE.Vector3(c,.125,d))}if(i.contents)for(let e of i.contents)e.pos[1]<1&&(s[E(a+e.pos[0],f+e.pos[2])]|=32),o(e.model,t,e.rot??0,new THREE.Vector3(a+e.pos[0],u+e.pos[1],f+e.pos[2]))}AFRAME.registerComponent("world",{init:function(){this.engine=new e({metersX:30,metersY:4,metersZ:30}),this.game=this.el.sceneEl?.systems.game;let t=new Uint8Array(900);for(let i of l){u(this.engine,i,t,30,this.game);let s=document.createElement("a-entity");s.setAttribute("mixin","l"),s.setAttribute("position",`${i.origin[0]+i.size[0]/2} 2.8 ${i.origin[2]+i.size[1]/2}`),s.setAttribute("visible","false"),this.game.addLamp(s),this.el.sceneEl?.appendChild(s)}let i=document.createElement("a-entity");i.setAttribute("bomb",""),i.setAttribute("position","21 0 6"),this.el.sceneEl.appendChild(i),t[201]|=96,this.game.setGrid(30,30,t);let s=this.engine.getMesh();this.el.setObject3D("mesh",s),this.game.worldMesh=this.el.object3D.children[0],this.game.bomb=i.components.bomb,s.position.set(0,-.125,0)}}),AFRAME.registerComponent("paw",{schema:{gun:{type:"boolean",default:!1}},init:function(){let t=new e({metersX:1,metersY:1,metersZ:2}),i=["11000000,11100000,00000000|0000000011111111111111111111111111111111111111110000000022222222|5","11000000,00000000,11100000,21100000|0000001123223201333222202333232033322220232232010000001111111111|5,31","00000000,00000100,11000200,00000200,00001410,11102120,00001110,00002120,00003333,00003113,11121113,00001113,00002113,00000500|012113100456676089abbc6d0456676d89abbc6d045667600121131000000000|3,4,1,12,33"];o(i[0],t,0,new THREE.Vector3(0,0,0)),o(i[1],t,0,new THREE.Vector3(0,0,1)),this.data.gun&&o(i[2],t,0,new THREE.Vector3(0,0,.5));let s=t.getMesh();this.el.setObject3D("mesh",s)}}),AFRAME.registerSystem("coroutine",{schema:{},init(){this.tt=new Map,this.it=0},tick:function(t,i){for(let[t,s]of this.tt.entries())s.update(i)||this.tt.delete(t)},addCoroutine(t){let i=this.it++;return this.tt.set(i,t),i},stopCoroutine(t){this.tt.delete(t)}});var f=class{generator;constructor(t){this.generator=t}update(t){return!this.generator.next(t).done}};function*c(t){let i=0;for(;i<t;)i+=(yield)/1e3}var d=new THREE.Vector3,m=new THREE.Vector3;AFRAME.registerComponent("mouse",{schema:{t:{type:"number",default:200},s:{type:"number",default:.02},ar:{type:"number",default:1},hm:{type:"number",default:1200},r:{type:"number",default:2}},init:function(){let t=new e({metersX:1,metersY:1,metersZ:1});o("00000000,22000000,20000000,03000000,03300000,13300000,03330000,03333000,00333000,13332300,03333300,03430000|000122200344432005666520066666000766670089a6a98006b6b60000030000|4,30,3,12",t);let i=t.getMesh(),s=i.geometry;s.computeBoundingBox();let h=s.boundingBox,n=(h.min.x+h.max.x)/2,r=(h.min.z+h.max.z)/2;s.translate(-n,-h.min.y,-r),this.el.setObject3D("mesh",i),this.st=this.el.object3D.position.clone(),this.et=this.el.sceneEl.systems.game,this.ot=this.el.sceneEl.systems.coroutine.addCoroutine(new f(this.ai())),this.el.sceneEl.addEventListener("gamestatechange",t=>{let i=t.detail;(2===i.newState||3===i.newState)&&(this.el.sceneEl.systems.coroutine.stopCoroutine(this.ot),this.ht())})},tick:function(t,i){if(this.nt){void 0===this.rt&&(this.rt=0),this.rt+=i/1e3*1.3;let t=THREE.MathUtils.lerp(this.nt[0],this.nt[2],this.rt),s=THREE.MathUtils.lerp(this.nt[1],this.nt[3],this.rt);this.el.setAttribute("position",{x:t,y:0,z:s});let e=Math.atan2(this.nt[2]-this.nt[0],this.nt[3]-this.nt[1]);this.el.setAttribute("rotation",{x:0,y:180*e/Math.PI-90,z:0}),this.rt>1&&(this.rt=void 0,this.nt=void 0)}},lt:function(){return d.set(this.el.object3D.position.x,.5,this.el.object3D.position.z),m.set(this.et.currentPlayerPos[0],.5,this.et.currentPlayerPos[1]),this.et.rayCast(d,m).distance>d.distanceTo(m)},ht:function(){this.et.removeMouse(this.el.object3D),this.el.setAttribute("self-destruct",{timer:1})},ai:function*(){let t=0,i=0;for(;;){let s=this.el.object3D.position;if(s.x<-1||s.x>this.et.grid.w||s.z<-1||s.z>this.et.grid.d)return void this.ht();if(2===t){let t=this.st.x-s.x,e=this.st.z-s.z,o=Math.sqrt(t*t+e*e);if(!(o>1.8))return void this.ht();{let h=t/o,n=e/o,r=Math.abs(h)<.5?0:h>0?1:-1,a=Math.abs(n)<.5?0:n>0?1:-1,l=~~(s.x+r),u=~~(s.z+a);if(this.et.isEmpty(l,u))for(i=0,this.nt=[s.x,s.z,l+.5,u+.5];this.nt;)yield;else{if(i++,i>10)return void this.ht();this.nt=void 0,yield*c(.2)}}continue}if(0===t&&this.lt()&&(t=1),1===t){let i=this.et.currentPlayerPos[0]-s.x,e=this.et.currentPlayerPos[1]-s.z,o=Math.sqrt(i*i+e*e);if(o<this.data.ar){this.et.bite(),t=2;continue}let h=i/o,n=e/o,r=Math.abs(h)<.5?0:h>0?1:-1,a=Math.abs(n)<.5?0:n>0?1:-1,l=~~(s.x+r),u=~~(s.z+a);if(this.et.isEmpty(l,u))for(this.nt=[s.x,s.z,l+.5,u+.5];this.nt;)yield;else this.nt=void 0,t=0}if(0===t){let t=Math.round(2*Math.random())-1,i=Math.round(2*Math.random())-1,e=~~(s.x+t),o=~~(s.z+i);for(0===t&&0===i||!this.et.isEmpty(e,o)?(this.nt=void 0,yield):this.nt=[s.x,s.z,e+.5,o+.5];this.nt;)yield}}}});var E=new THREE.Vector3,w=new THREE.Euler(0,0,0,"YXZ");function p(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var s=this.b+this.c+this.e;if(s<.18){var e=.18/s;this.b*=e,this.c*=e,this.e*=e}}}new THREE.Vector3,AFRAME.registerComponent("smooth-locomotion",{schema:{speed:{type:"number",default:.005},camera:{type:"selector",default:"#camera"},rig:{type:"selector",default:"#rig"}},init:function(){this.ut=new THREE.Vector3;let t=this.el.sceneEl?.systems.game;this.ft=t.grid,this.ct=t=>{let{axis:i}=t.detail,s=this.data.speed;this.ut.z=i[3]*s,this.ut.x=i[2]*s},this.el.sceneEl.addEventListener("gamestatechange",t=>{let i=t.detail;(2===i.newState||3===i.newState)&&this.el.removeEventListener("axismove",this.ct)})},play:function(){this.el.addEventListener("axismove",this.ct)},pause:function(){this.el.removeEventListener("axismove",this.ct)},tick:function(t,i){let s=this.data.camera.getAttribute("rotation"),e=this.data.rig.getAttribute("rotation");E.copy(this.ut).multiplyScalar(i),w.set((s.x+e.x)*Math.PI/180,(s.y+e.y)*Math.PI/180,0),E.applyEuler(w);let o=this.data.rig.object3D.position,h=this.ft,n=.2,r=(t,i)=>{let s=(t,i)=>{let s=0|t;s<0?s=0:s>=h.w&&(s=h.w-1);let e=0|i;return e<0?e=0:e>=h.d&&(e=h.d-1),h.occ[s+e*h.w]};return!!(32&(s(t-n,i)|s(t+n,i)|s(t,i-n)|s(t,i+n))||E.x>0&&8&s(t-n,i)||E.x<0&&4&s(t+n,i)||E.z>0&&1&s(t,i-n)||E.z<0&&2&s(t,i+n))},a=o.x+E.x,l=o.z+E.z;r(a,l)?r(a,o.z)?r(o.x,l)||(o.z=l):o.x=a:o.set(a,o.y,l),this.data.rig.object3D.position.copy(o)}}),AFRAME.registerComponent("snap-rotate",{schema:{player:{type:"selector",default:"#rig"},degrees:{type:"int",default:30}},init:function(){this.dt=!1,this.Et=new THREE.Vector3,this.wt=new THREE.Vector3,this.yt=new THREE.Vector3,this.ct=t=>{let i=t.detail?.axis;if(!i||i.length<3)return;let s=i[2];if(s>-.2&&s<.2)return void(this.dt=!1);if(Math.abs(s)<.8||!this.data.player)return;this.data.player.object3D.getWorldPosition(this.Et),s<-.8&&!this.dt&&(this.data.player.object3D.rotateY(this.data.degrees*Math.PI/180),this.dt=!0),s>.8&&!this.dt&&(this.data.player.object3D.rotateY(-this.data.degrees*Math.PI/180),this.dt=!0),this.data.player.object3D.getWorldPosition(this.wt),this.yt.subVectors(this.Et,this.wt);let e=this.data.player.object3D.parent;e&&e.worldToLocal(this.yt),this.data.player.object3D.position.add(this.yt)}},play:function(){this.el.addEventListener("axismove",this.ct)},pause:function(){this.el.removeEventListener("axismove",this.ct)}});var y=new function(){var t,i,s,e,o,h,n,r,a,l,u,f;this.Rt=new p,this.reset=function(){var t=this.Rt;e=100/(t.f*t.f+.001),o=100/(t.g*t.g+.001),h=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(u=.5-t.n/2,f=5e-5*-t.o),r=1+t.l*t.l*(t.l>0?-.9:10),a=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var e=this.Rt;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,s=e.e*e.e*1e5+12,3*((t+i+s)/3|0)},this.synthWave=function(c,d){var m=this.Rt,E=1!=m.s||m.v,w=m.v*m.v*.1,p=1+3e-4*m.w,y=m.s*m.s*m.s*.1,R=1+1e-4*m.t,v=1!=m.s,H=m.x*m.x,x=m.g,M=m.q||m.r,b=m.r*m.r*m.r*.2,T=m.q*m.q*(m.q<0?-1020:1020),z=m.p?32+((1-m.p)*(1-m.p)*2e4|0):0,g=m.d,A=m.j/2,_=m.k*m.k*.01,F=m.a,k=t,C=1/t,$=1/i,Y=1/s,X=5/(1+m.u*m.u*20)*(.01+y);X>.8&&(X=.8),X=1-X;for(var Z,S,B,O,P,U,I=!1,L=0,N=0,V=0,D=0,G=0,Q=0,j=0,q=0,J=0,K=0,W=Array(1024),tt=Array(32),it=W.length;it--;)W[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<d;it++){if(I)return it;if(z&&++J>=z&&(J=0,this.reset()),l&&++a>=l&&(l=0,e*=r),(e*=h+=n)>o&&(e=o,x>0&&(I=!0)),S=e,A>0&&(S*=1+Math.sin(K+=_)*A),(S|=0)<8&&(S=8),F||((u+=f)<0?u=0:u>.5&&(u=.5)),++N>k)switch(N=0,++L){case 1:k=i;break;case 2:k=s}switch(L){case 0:V=N*C;break;case 1:V=1+2*(1-N*$)*g;break;case 2:V=1-N*Y;break;case 3:V=0,I=!0}M&&((B=0|(T+=b))<0?B=-B:B>1023&&(B=1023)),E&&p&&((w*=p)<1e-5?w=1e-5:w>.1&&(w=.1)),U=0;for(var st=8;st--;){if(++j>=S&&(j%=S,3==F))for(var et=tt.length;et--;)tt[et]=2*Math.random()-1;switch(F){case 0:P=j/S<u?.5:-.5;break;case 1:P=1-j/S*2;break;case 2:P=.225*(((P=1.27323954*(O=6.28318531*((O=j/S)>.5?O-1:O))+.405284735*O*O*(O<0?1:-1))<0?-1:1)*P*P-P)+P;break;case 3:P=tt[Math.abs(32*j/S|0)]}E&&(Z=Q,(y*=R)<0?y=0:y>.1&&(y=.1),v?(G+=(P-Q)*y,G*=X):(Q=P,G=0),D+=(Q+=G)-Z,P=D*=1-w),M&&(W[q%1024]=P,P+=W[(q-B+1024)%1024],q++),U+=P}U*=.125*V*H,c[it]=U>=1?32767:U<=-1?-32768:32767*U|0}return d}},R=function(t){y.Rt.setSettings(t);var i=y.totalReset(),s=new Uint8Array(4*((i+1)/2|0)+44),e=2*y.synthWave(new Uint16Array(s.buffer,44),i),o=new Uint32Array(s.buffer,0,44);o[0]=1179011410,o[1]=e+36,o[2]=1163280727,o[3]=544501094,o[4]=16,o[5]=65537,o[6]=44049,o[7]=88200,o[8]=1048578,o[9]=1635017060,o[10]=e,e+=44;for(var h=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="data:audio/wav;base64,";h<e;h+=3){var a=s[h]<<16|s[h+1]<<8|s[h+2];r+=n[a>>18]+n[a>>12&63]+n[a>>6&63]+n[63&a]}return r},v=[],H=[],x=null,M=0,b=[R([1,,.1272,,.3603,.6492,.2,-.2783,,,,,,.7756,-.6954,,,,1,,,.228,,1]),R([3,,.242,.5252,.272,.0531,,-.0104,,,,.444,.7092,,,,.09972,-.2081,1,,,,,1]),R([3,.09,.67,.35,.93,.2,,-.12,,,,-.3774,.62,,,,.1399,-.3,1,,,,,.5]),R([3,,.2043,.5884,.2696,.1493,,-.35,,,,,,,,,,,1,,,,,.5]),,,R([0,,.0343,,.2762,.533,,-.4588,,,,,,.2202,,,,,1,,,,,1]),R([0,,.1957,,.1236,.5185,,.1997,,,,,,.2281,,,,,.8683,,,,,.5])],T=function(t){x&&(v[M].src=b[t],v[M].play(),M=(M+1)%25)},z=new THREE.Vector3,g=new THREE.Vector3;AFRAME.registerComponent("shoot",{schema:{},init:function(){this.vt=this.el.sceneEl.systems.game;let t=document.createElement("a-light");t.setAttribute("type","point"),t.setAttribute("intensity",0),t.setAttribute("distance",10),t.setAttribute("color","cyan"),t.setAttribute("position","0.007 0.07 -.07"),this.el.appendChild(t);let i=document.createElement("a-box");i.setAttribute("position","0.007 0.07 -5.021"),i.setAttribute("depth","10"),i.setAttribute("height","0.007"),i.setAttribute("width","0.007"),i.setAttribute("material","color: cyan; shader: flat"),i.setAttribute("visible","false"),this.el.appendChild(i),this.Ht=s=>{if(0!==s.detail.id)return;T(0),this.el.object3D.getWorldPosition(z),z.y+=.07,this.el.object3D.getWorldDirection(g),g.multiplyScalar(-1);let e=this.vt.rayCastD(z,g);if(i.setAttribute("visible","true"),t.setAttribute("intensity",2),setTimeout(()=>{i.setAttribute("visible","false"),t.setAttribute("intensity",0)},50),(e?.object).el.classList?.contains("m")){setTimeout(()=>{T(1)},100);let t=document.createElement("a-entity");t.setAttribute("position",e.point),t.setAttribute("particles",{}),this.el.sceneEl.appendChild(t),(e?.object).el.components.mouse.ht()}else if(e){let t=document.createElement("a-box");t.setAttribute("position",e.point),t.setAttribute("scale",{x:.05,y:.05,z:.05}),t.setAttribute("color","black"),t.setAttribute("self-destruct",{timer:2500}),this.el.sceneEl.appendChild(t)}}},play:function(){this.el.addEventListener("buttondown",this.Ht)},pause:function(){this.el.removeEventListener("buttondown",this.Ht)}}),AFRAME.registerComponent("self-destruct",{schema:{timer:{default:5e3}},tick:function(t,i){this.data.timer-=i,this.data.timer<0&&this.el.remove()}}),AFRAME.registerComponent("head-offset",{schema:{height:{type:"number",default:.5},Camera:{type:"selector",default:"#camera"}},init:function(){this.xt=this.el.getAttribute("position"),this.Mt=0,this.bt=30,this.Tt=!1,this.el.sceneEl.addEventListener("enter-vr",()=>{this.Mt=0,this.Tt=!0})},tick:function(t,i){if(!this.Tt)return;let s=new THREE.Vector3;this.data.Camera.object3D.getWorldPosition(s);let e=s.y;if((this.Mt||0)<(this.bt||30)&&Math.abs(e)<.001)return void(this.Mt=(this.Mt||0)+1);let o=this.data.height-e,h=this.el.getAttribute("position")||{x:0,y:0,z:0},n=h.y+o;this.el.setAttribute("position",{x:h.x,y:n,z:h.z}),this.Tt=!1}});var A=(t,i)=>t+Math.random()*(i-t);AFRAME.registerComponent("particles",{schema:{},init:function(){let t=new THREE.Group,i=new THREE.BoxGeometry(.05,.05,.05),s=new THREE.MeshLambertMaterial({color:"red"});this.particles=[];for(let e=0;e<25;e++){let e=new THREE.Mesh(i,s);e.velocity=new THREE.Vector3(A(-.03,.03),A(.001,.05),A(-.03,.03)),e.acceleration=new THREE.Vector3(0,-.003,0),t.add(e),this.particles.push(e)}this.el.object3D.add(t),this.el.setAttribute("self-destruct",{timer:500})},tick:function(t,i){for(let t of this.particles)t.velocity&&t.acceleration&&(t.velocity.add(t.acceleration),t.position.add(t.velocity))}});var _=new THREE.Vector3;AFRAME.registerComponent("interact",{schema:{},init:function(){this.Ht=t=>{0===t.detail.id&&(this.el.object3D.getWorldPosition(_),this.el.sceneEl.emit("interact",{pos:_.clone()}))},this.zt=t=>{0===t.detail.id&&this.el.sceneEl.emit("interactEnd")}},play:function(){this.el.addEventListener("buttondown",this.Ht),this.el.addEventListener("buttonup",this.zt)},pause:function(){this.el.removeEventListener("buttondown",this.Ht),this.el.removeEventListener("buttonup",this.zt)}}),AFRAME.registerComponent("bomb",{schema:{},init:function(){let t=new e({metersX:1,metersY:1,metersZ:1});o("14410000,04410000,04010000,10010000,10410000,11110000,00000000,14010000,35353600,33333600,14410600,35353700,25252000,25252600,00000600|0120034567000005664000566689a056668ba5666cdedc666cc6cc6666666666|16,12,38,17,6,2,1",t,0,new THREE.Vector3),this.el.setObject3D("mesh",t.getMesh()),this.el.sceneEl.addEventListener("gamestatechange",t=>{1===t.detail.newState?this.start():this.el.sceneEl.systems.coroutine.stopCoroutine(this.ot)})},start:function(){this.ot=this.el.sceneEl.systems.coroutine.addCoroutine(new f(this.gt()))},gt:function*(){let t=this.el.sceneEl.systems.game;t.notify("Bomb activated!\nYou have 10 minutes to defuse it!"),yield*c(300),t.notify("5 minutes remaining!"),yield*c(120),t.notify("3 minutes remaining!"),yield*c(120),t.notify("1 minutes remaining!"),yield*c(30),t.notify("30 seconds remaining!"),yield*c(20),t.notify("10 seconds remaining!"),yield*c(10),t.boom()}});var F=new THREE.Vector3;AFRAME.registerSystem("game",{schema:{},init(){this.gameState=0,this.At=9,this._t=new Map,this.tt=new Map,this.Ft=[],this.kt=[],this.Ct=this.el.sceneEl.systems.coroutine,this.currentRoom=-1,this.text=this.el.sceneEl.querySelector("#t"),this.text.setAttribute("visible","false"),this.el.sceneEl.addEventListener("enter-vr",()=>{(function(){(x=new AudioContext).listener.upY.value=1;let t=x.createGain();t.connect(x.destination);for(let i=0;i<25;i++){let i=new Audio;v.push(i);let s=x.createMediaElementSource(i),e=new PannerNode(x,{panningModel:"HRTF",distanceModel:"exponential"});s.connect(e),e.connect(t),H.push(e)}})(),this.el.sceneEl.querySelector("#title").setAttribute("visible","false"),this.changeGameState(1)}),this.el.sceneEl.addEventListener("interact",t=>{let i=t.detail;if(64&this.grid.occ[(0|i.pos.x)+(0|i.pos.z)*this.grid.w]){if(this.el.sceneEl.querySelector("#win").setAttribute("visible","true"),this.bomb){this.bomb.el.setAttribute("visible","false"),this.changeGameState(3),this.tt.forEach(t=>{this.Ct.stopCoroutine(t)});let t=document.getElementsByClassName("m");for(let i=0;i<t.length;i++)t[i].remove()}}else this.blockMouseHole(i.pos.x,i.pos.z)}),this.el.sceneEl.addEventListener("interactEnd",t=>{})},notify(t){this.notifyCRID&&this.Ct.stopCoroutine(this.notifyCRID),this.notifyCRID=this.Ct.addCoroutine(new f(this.notifyCR(t)))},bite(){this.At--,this.At<=0?this.gameOver():(T(6),this.notify(`Ouch! You have ${this.At} lives left.`))},notifyCR:function*(t){this.text.setAttribute("text","value",t),this.text.setAttribute("visible","true"),yield*c(3),this.text.setAttribute("visible","false")},updateLamps(){for(let t=0;t<this.kt.length;t++)t===this.currentRoom||a[this.currentRoom]?.includes(t)?this.kt[t].setAttribute("visible","true"):this.kt[t].setAttribute("visible","false")},tick:function(t,i){if(1!==this.gameState)return;this.currentPlayerPos=this.$t();let[s,e]=this.currentPlayerPos;s|=0,e|=0,l.forEach((t,i)=>{s>=t.origin[0]&&s<t.origin[0]+t.size[0]&&e>=t.origin[2]&&e<t.origin[2]+t.size[1]&&this.currentRoom!==i&&(this.currentRoom=i,this.updateLamps(),this._t.forEach(t=>{if(t.roomid===i)t.active||(t.active=this.Yt(t));else{t.active=!1;let i=`${t.x},${t.z}`;this.Ct.stopCoroutine(this.tt.get(i)),this.tt.delete(i)}}))})},isEmpty(t,i){let s=this.grid;return t>=0&&i>=0&&t<s.w&&i<s.d&&0===s.occ[i*s.w+t]},addLamp(t){1==this.kt.push(t)&&this.kt[0].setAttribute("visible","true")},rayCastD(t,i){let s=new THREE.Raycaster(t,i,.25,25).intersectObjects([this.worldMesh,...this.Ft],!0);return s.length>0?s[0]:null},rayCast(t,i){let s=i.clone().sub(t).normalize();return this.rayCastD(t,s)},changeGameState(t){this.gameState=t,this.el.sceneEl.emit("gamestatechange",{newState:t})},boom(){this.gameOver()},gameOver(){this.changeGameState(2),T(2),this.el.sceneEl.querySelector("#go").setAttribute("visible","true"),this.tt.forEach(t=>{this.Ct.stopCoroutine(t)});let t=document.getElementsByClassName("m");for(let i=0;i<t.length;i++)t[i].remove()},setGrid(t,i,s){this.grid={w:t,d:i,occ:s}},registerMouseHole(t){let i=`${t.x},${t.z}`;this._t.set(i,t)},blockMouseHole(t,i){let s=`${t|=0},${i|=0}`,h=this._t.get(s);if(h){T(3);let t=document.createElement("a-entity"),i=new e({metersX:1,metersY:1,metersZ:1});o("00000000,01200000,01300000,02110000,00210000,00110000,00121000,00011000,00013000|0000000000000000123456780000000000000000000000000000000000000000|9,10,40",i,h.rotation,new THREE.Vector3),t.setObject3D("mesh",i.getMesh()),t.setAttribute("position",`${h.x} 0 ${h.z}`),t.classList.add("b"),this.el.sceneEl?.appendChild(t),this.Ct.stopCoroutine(this.tt.get(s)),this._t.delete(s)}},playerPos(){return this.currentPlayerPos},$t:function(){return this.el.sceneEl.camera.getWorldPosition(F),[F.x,F.z]},Yt(t){let i=this.Ct.addCoroutine(new f(this.Xt(t)));return this.tt.set(`${t.x},${t.z}`,i),!0},removeMouse(t){let i=this.Ft.indexOf(t);-1!==i&&this.Ft.splice(i,1)},Xt:function*(t){for(yield*c(2*Math.random());;){T(7);let i=document.createElement("a-entity");i.setAttribute("mixin","ms"),i.classList.add("r","m"),i.setAttribute("position",{x:t.x+.5,y:0,z:t.z+.5}),this.el.sceneEl?.appendChild(i),this.Ft.push(i.object3D),yield*c(t.spawnRate||5)}}});