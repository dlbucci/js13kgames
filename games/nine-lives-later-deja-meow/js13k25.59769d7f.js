let e,t,o,n,i,s,l,a,r,d,c,u,h;const f=function(){let e=document.createElement("canvas");e.width=640,e.height=400;let t=e.getContext("2d"),o=t.createLinearGradient(0,0,40,0);o.addColorStop(0,"rgba(0,0,0,0.5)"),o.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=o,t.fillRect(0,0,40,400),(o=t.createLinearGradient(640,0,600,0)).addColorStop(0,"rgba(0,0,0,0.5)"),o.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=o,t.fillRect(600,0,40,400),(o=t.createLinearGradient(0,0,0,40)).addColorStop(0,"rgba(0,0,0,0.5)"),o.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=o,t.fillRect(0,0,640,40),(o=t.createLinearGradient(0,400,0,360)).addColorStop(0,"rgba(0,0,0,0.5)"),o.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=o,t.fillRect(0,360,640,40),t.beginPath(),t.strokeStyle="#00000012";for(let e=0;e<=640;e+=40)t.moveTo(e,0),t.lineTo(e,400);for(let e=0;e<=400;e+=40)t.moveTo(0,e),t.lineTo(640,e);return t.stroke(),e}(),y=(e,t)=>!e.hi&&!t.hi&&w(e,t)&&e.m&t.c&&t.m&e.c,w=(e,t)=>!e.hi&&!t.hi&&!(e.x+e.w<t.x||e.x>t.x+t.w||e.y+e.h<t.y||e.y>t.y+t.h),x=(e,t)=>{let o=e.x+e.w/2,n=e.y+e.h/2,i=t.x+t.w/2,s=t.y+t.h/2,l=o-i,a=(e.w+t.w)/2-Math.abs(l),r=n-s,d=(e.h+t.h)/2-Math.abs(r);a<d?(e.x+=l<0?-a:a,e.dx=-e.dx):(e.y+=r<0?-d:d,e.dy=-e.dy),e.justB=!0,e.justBDT=0},m=(e,t,o)=>(e.save(),e.shadowBlur=5,e.shadowColor="rgba(0,0,0,.7)",e.fillText(t,o.x+o.w/2,o.y+o.h/2),e.restore()),p=(e,t,o)=>({x:e,y:t,w:20,h:20,t:"e",e:"m",dx:.5>Math.random()?1.5:-1.5,dy:.5>Math.random()?1.5:-1.5,c:2,m:15,...o}),D=(e,t,o,n,i)=>({x:e,y:t,w:o,h:n,t:"w",c:8,m:7,...i}),g=(e,t,o,n,i)=>({x:e,y:t,w:o,h:n,t:"x",c:16,m:1,...i}),v=(e,t)=>({x:e,y:t,w:20,h:20,t:"e",e:"d",dx:.5>Math.random()?1:-1,dy:.5>Math.random()?1:-1,c:2,m:79}),S=(e,t,o,n,i,s)=>({x:e,y:t,w:o,h:n,t:"d",d:i,c:64,m:7,...s}),b=(e,t,o,n,i,s)=>({x:e,y:t,h:n,w:o,te:i,t:"et",...s,c:256}),C=(e,t,o,n,i)=>({x:e,y:t,w:o,h:n,mv:i,t:"x",a:1,c:16,m:1}),L=(e,t,o,n,i,s,l,a)=>({x:e,y:t,w:o,h:n,t:"n",a:0,tdx:i,tdy:s,tx:l,...a}),E=(e,t,o,n,i)=>({x:e,y:t,w:o,h:n,t:"bw",c:8,m:7,...i}),T=e=>`stefor.js13k2025.cat.${e}`,R=e=>(console.log("ls load",T(e)),localStorage.getItem(T(e))),M=(e,t)=>{localStorage.setItem(T(e),t)},I=e=>JSON.parse(R(e)),B=(e,t)=>{M(e,JSON.stringify(t))};var k=function(){var e,t,o,n,i,s=function(e){return Math.sin(6.283184*e)},l=function(e){return .003959503758*2**((e-128)/12)},a=function(e,t,o){var n,i,s,a,d,c,u=r[e.i[0]],h=e.i[1],f=e.i[3]/32,y=r[e.i[4]],w=e.i[5],x=e.i[8]/32,m=e.i[9],p=e.i[10]*e.i[10]*4,D=e.i[11]*e.i[11]*4,g=e.i[12]*e.i[12]*4,v=1/g,S=-e.i[13]/16,b=e.i[14],C=o*2**(2-e.i[15]),L=new Int32Array(p+D+g),E=0,T=0;for(n=0,i=0;n<p+D+g;n++,i++)i>=0&&(b=b>>8|(255&b)<<4,i-=C,d=l(t+(15&b)+e.i[2]-128),c=l(t+(15&b)+e.i[6]-128)*(1+8e-4*e.i[7])),s=1,n<p?s=n/p:n>=p+D&&(s=(1-(s=(n-p-D)*v))*3**(S*s)),E+=d*s**f,a=u(E)*h,T+=c*s**x,a+=y(T)*w,m&&(a+=(2*Math.random()-1)*m),L[n]=80*a*s|0;return L},r=[s,function(e){return e%1<.5?1:-1},function(e){return e%1*2-1},function(e){var t=e%1*4;return t<2?t-1:3-t}];this.init=function(s){e=s,t=s.endPattern,o=0,i=new Int32Array(n=s.rowLen*s.patternLen*(t+1)*2)},this.generate=function(){var l,d,c,u,h,f,y,w,x,m,p,D,g,v,S=new Int32Array(n),b=e.songData[o],C=e.rowLen,L=e.patternLen,E=0,T=0,R=!1,M=[];for(c=0;c<=t;++c)for(u=0,y=b.p[c];u<L;++u){var I=y?b.c[y-1].f[u]:0;I&&(b.i[I-1]=b.c[y-1].f[u+L]||0,I<17&&(M=[]));var B=r[b.i[16]],k=b.i[17]/512,A=2**(b.i[18]-9)/C,P=b.i[19],F=b.i[20],$=135.82764118168*b.i[21]/44100,j=1-b.i[22]/255,W=1e-5*b.i[23],O=b.i[24]/32,U=b.i[25]/512,N=6.283184*2**(b.i[26]-9)/C,G=b.i[27]/255,J=b.i[28]*C&-2;for(h=0,p=(c*L+u)*C;h<4;++h)if(f=y?b.c[y-1].n[u+h*L]:0){M[f]||(M[f]=a(b,f,C));var Y=M[f];for(d=0,l=2*p;d<Y.length;d++,l+=2)S[l]+=Y[d]}for(d=0;d<C;d++)(m=S[w=(p+d)*2])||R?(D=$,P&&(D*=B(A*w)*k+.5),E+=(D=1.5*Math.sin(D))*T,g=j*(m-T)-E,T+=D*g,m=3==F?T:1==F?g:E,W&&(m*=W,m=(m<1?m>-1?s(.25*m):-1:1)/W),m*=O,R=m*m>1e-5,v=m*(1-(x=Math.sin(N*w)*U+.5)),m*=x):v=0,w>=J&&(v+=S[w-J+1]*G,m+=S[w-J]*G),S[w]=0|v,S[w+1]=0|m,i[w]+=0|v,i[w+1]+=0|m}return++o/e.numChannels},this.createAudioBuffer=function(e){for(var t=e.createBuffer(2,n/2,44100),o=0;o<2;o++)for(var s=t.getChannelData(o),l=o;l<n;l+=2)s[l>>1]=i[l]/65536;return t},this.createWave=function(){var e=44+2*n-8,t=e-36,o=new Uint8Array(44+2*n);o.set([82,73,70,70,255&e,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,t>>8&255,t>>16&255,t>>24&255]);for(var s=0,l=44;s<n;++s){var a=i[s];a=a<-32767?-32767:a>32767?32767:a,o[l++]=255&a,o[l++]=a>>8&255}return o},this.getData=function(e,t){for(var o=2*Math.floor(44100*e),n=Array(t),s=0;s<2*t;s+=1){var l=o+s;n[s]=e>0&&l<i.length?i[l]/32768:0}return n}};const A={songData:[{i:[0,48,128,0,3,75,128,0,0,0,5,9,58,0,0,0,0,195,6,1,2,69,0,0,32,147,6,95,6],p:[1,1,1,1,1,1,,,,,,,,,,,,,,,,,,,1,1,1,1],c:[{n:[138,137,138,135,,,,,138,137,138,,131,,,,138,137,138,135,,,,,138,137,138,137,131,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142,140,142,138],f:[]}]},{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135,,,,135],f:[]}]},{i:[0,91,128,64,0,103,128,0,120,135,4,7,52,85,0,0,0,24,1,1,2,255,0,0,32,61,5,0,6],p:[,,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,2,1,1,1,1],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,135,,,135,,135,135,135],f:[]}]},{i:[2,84,128,0,1,113,128,0,0,0,0,6,29,0,0,0,0,43,2,1,3,5,23,7,108,79,3,37,6],p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,3,4,1,2,3,4,1,2,1,2,1,2,1,2],c:[{n:[114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126,114,126],f:[]},{n:[111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123,111,123],f:[]},{n:[107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119,107,119],f:[]},{n:[109,121,109,121,109,121,109,121,109,121,109,121,109,121,109,121,109,121,109,121,109,121,109,121,111,123,111,123,114,126,114,126],f:[]}]},{i:[3,100,128,0,2,201,128,0,0,0,3,32,43,4,0,0,0,92,3,1,2,35,32,0,19,147,6,76,8],p:[,,1,2,1,2,3,4,3,5,3,4,,,,,,,,,3,5,3,4],c:[{n:[,,142,,,,,,,,,,,,142,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,143,,,,,,,,140],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,138,,142,,,,,,,,142,,,138,,,,,,,,,,,,137,,,,,,,,140,,,,,,,,143,,,,,,,,140],f:[]},{n:[,,142,,,,,,,,,,,,142,,,,142,,,,,,,,,,,,,,138,,,143,,,,,,,,,,,,,138,,,143,,,142,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,143,,,,,,,,140],f:[]},{n:[,,,,,,,,,,,,,,,,,,143,,,,,,,,,,145,,,,143,,142,,,,,142,,,,,,138,,142,,,,,,,,,,,138,,,,,,,,,,,,138,,,,,,,,,,,,,,,,143,,,,,,,,140],f:[]},{n:[,,142,,,,,,,,,,,,138,,,,140,,,,,,,,,,,,,,138,,,143,,,,,,,,,,,,,142,,,142,,,142,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,143,,,,,,,,140],f:[]}]},{i:[2,100,128,0,3,115,128,0,0,0,5,6,58,0,0,0,0,195,4,1,2,47,0,0,32,147,6,69,6],p:[,,,,,,1,3,1,2,1,3,,,,,,,,,1,2,1,3],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,142,130,138],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142,,,142,143,,138],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,143,,142],f:[]}]},{i:[3,113,128,0,1,136,128,6,0,0,134,119,158,0,0,0,0,0,0,0,2,15,64,0,13,0,0,24,8],p:[,,,,1,2,1,2,1,2,1,2,,,,,1,2,3,4,1,2,1,2],c:[{n:[126,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138],f:[]},{n:[123,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142],f:[]},{n:[119,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,131],f:[]},{n:[121,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,133],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,39,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,25,5,16,4],p:[,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135,,135],f:[10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,10,,39,,103,,39,,103,,39,,103,,39,,103,,39,,103,,39,,103,,39,,103,,39,,103]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,,,,,,,,,,,1,2,3,4,1,2,3,4],c:[{n:[,,,,142,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,142],f:[]},{n:[,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]},{n:[,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,140],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,133,,,,,,,,,,,,,,,,142,,,,,,,,,,,,,,,,,,,,137,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,140],f:[]}]},{i:[0,100,128,0,1,115,128,0,0,0,7,6,58,0,0,0,0,81,2,1,2,60,16,0,21,64,6,69,4],p:[,,,,,,,,,,,,1,2,3,4,1,2,3,4],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,138,,137,,,,138,,,,142],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,130,131,142,,138,,137],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,138,,,,,,,,142],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,140,,,,,,140,,,,,,,,,,140,,,,,,143,,,,,,,,138,,,,,,137,,,,,,,,,,,,,,142,,,,,,142],f:[]}]}],rowLen:6125,patternLen:32,endPattern:27,numChannels:10},P={songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,47,19,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[135],f:[]}]}],rowLen:5513,patternLen:3,endPattern:0,numChannels:1},F={songData:[{i:[0,73,107,55,3,57,128,76,36,0,5,51,58,0,55,4,2,195,6,1,1,20,27,0,32,16,2,121,2],p:[1],c:[{n:[162,159,161,155,157,154,150,147,149,145,143,140,142],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},$={songData:[{i:[3,255,128,0,0,255,140,0,0,180,2,2,47,61,138,3,0,0,3,1,3,79,79,0,32,84,2,12,4],p:[1],c:[{n:[123],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},j={songData:[{i:[3,116,106,64,2,65,106,60,64,0,5,7,71,0,0,0,0,138,9,1,3,62,76,19,56,0,5,25,1],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:4,endPattern:0,numChannels:1},W=document.getElementById("c"),O=W.getContext("2d"),U=document.getElementById("ov"),N=U.getContext("2d"),G=+new URLSearchParams(location.search).get("dpr")||window.devicePixelRatio||1;t={},e={};const J={x:0,y:1},Y=`
    Use left mouse button to shoot hairballs. (... have I already told myself this?)
    ||Magic pen records for future and past. Use space bar to activate pen mode and draw with mouse. Right mouse to erase. Find and draw the trap to the right.
    ||Who closed this wall?
    ||Already looked, nothing to the south
    ||*Sigh* Told you so...
    ||Sacrifice to void to get a glimpse into future. For those that comes after.
    ||You should play blue prince
    ||Secret south door in room with an H
    ||Shoot hairball on yourself in potato room
    ||Trap shapes can form numbers
    ||Sometimes it's better to die and try again
    ||Trap shapes can form numbers
    ||Trap shapes can form numbers
    ||Thank you for playing. I had more ideas but the jam fell under the song of silk. If you want the game to be over, it's over.
    ||Send cheese signal by pressing 'g'
    ||Reach my family grave without spilling any of our blood
    ||Traps will hide when you leave a room, mark them with pen
    `.replaceAll("\n","").split("||").map(e=>e.trim()),q=()=>{window.sounds&&window.sounds.playSong(0,.4),e={},t={},o=[],n=(({ov:e,ot:t,cv:o}={})=>{let n=!1,i=window.devicePixelRatio||1,s=-1,l=-1,a=!0;addEventListener("keydown",t=>{"Space"===t.code&&(t.preventDefault(),(n=!n)||function(){let t=document.createElement("canvas"),o=t.getContext("2d");t.width=640,t.height=400,o.setTransform(1,0,0,1,0,0),o.imageSmoothingEnabled=!1,o.drawImage(e,0,0,e.width,e.height,0,0,640,400),M(`${s},${l}`,t.toDataURL("image/png"))}(),e.style.opacity=n?1:.3,o.style.opacity=n?.5:1,document.body.style.cursor="crosshair")}),addEventListener("mousedown",function(e){n&&a&&(r=!0,t.lineWidth=(u=2===e.button)?10*i:3*i,[d,c]=h(e),e.preventDefault())}),addEventListener("mousemove",function(e){if(!r)return;let[o,n]=h(e);u?t.clearRect(o,n,t.lineWidth,t.lineWidth):(t.beginPath(),t.moveTo(d,c),t.lineTo(o,n),t.stroke()),[d,c]=[o,n]}),addEventListener("mouseup",f),addEventListener("mouseleave",f);let r=!1,d=0,c=0,u=!1;function h(t){let o=e.getBoundingClientRect(),n=o.width/640;return[(t.clientX-o.left)/n,(t.clientY-o.top)/n]}function f(){r=!1}return{update:(e,t)=>!!n,load:function(e,o){s=e,l=o,a=!1;let n=R(`${s},${l}`);t.clearRect(0,0,640,400),n?(console.log("found room for",s,l),(async()=>{let e=new Image;e.src=n,await e.decode(),t.drawImage(e,0,0,640,400,0,0,640,400),a=!0})()):(console.log("did not find room for",s,l),a=!0)}}})({ov:U,ot:N,cv:W}),i=(({}={})=>{let e=40,t=200,o=0,n=1,i=0,s=9,l=0,a=0,r=510,d={c:0},c=0,u="\uD83D\uDE3A";function h(o){o.beginPath(),o.strokeStyle="#232323",o.moveTo(e+10,t+10),o.lineTo(e+10+24*n,t+10+24*i),o.stroke(),m(o,u,{x:e,y:t,w:20,h:20})}function f(){window.sounds&&window.sounds.sfx(1),s--,a=500,p(l)}let x={s:{x:300,y:40},n:{x:300,y:340},w:{x:590,y:200},e:{x:50,y:200}};function p(o){({x:e,y:t}=x[o]),l=o}let D=0;function g(){d.c>0&&d.c--}return{x:40,y:200,r:10,adx:1,ady:0,updatePlayer:function(s,l,a,u,h){let x=!!l.d-!!l.a,m=!!l.s-!!l.w;if(x||m){let e=Math.hypot(x,m);x/=e,m/=e}let p=e+3*x*(s/16),D=t+3*m*(s/16),g={x:p,y:D,w:20,h:20,c:1,m:r};for(let o of(c>0&&(c=Math.max(0,c-s)),h.collisions))if("n"===o.t){let e=w(g,o);0===o.a&&e?o.a=1:e||1!==o.a||(o.a=0)}else if(y(g,o)){if("x"===o.t)return f(),o.a=1,o;if("d"===o.e&&0===c)return c=2e3,f(),o;if("d"===o.t||"e"===o.t)return o;"c"===o.t&&(d.c++,o.mfd=!0),p=e,D=t}e=p,n=Math.cos(o=Math.atan2(u-(t=D),a-e)),i=Math.sin(o)},drawPlayer:h,getBullet:function(){return{x:e+10+24*n,y:t+10+24*i,dx:5*n,dy:5*i,w:5,h:5,c:4,m:331}},newRoom:p,death:f,dc:function(o,n){if(!a)return!1;u="\uD83D\uDE3F";let i=(a=Math.max(0,a-o))>400?4:a>300?3:a>200?2:+(a>100);return i!==D&&(i%2?h(n):i&&n.clearRect(e,t,20,20),D=i),0===a&&(u="\uD83D\uDE3A"),a},invText:function(){return`\u{1F408}\u{200D}\u{2B1B}${s} \u{1F9C0}${d.c}`},isDead:function(){return s<=0},setRooms:function(e){},canOpen:function(e){if(e.dt){if(d.c<1)return!1;e.dt=!1,g()}return!0},getPosRect:function(){return{x:e,y:t,w:20,h:20,c:1,m:r}},useCheese:g,ic:u}})(),s=0,l=0,a=0,J.x=0,J.y=1,c=0,u={t:0,a:!1,d:0},h={t:0,proph:Y[Math.floor(5*Math.random()+6)]},r=(d=X.map(e=>(({rects:e=[],doors:t="",x:o=0,y:n=0,w:i=640,h:s=400,bw:l=16}={})=>{let a=e.slice(),r=t.toLowerCase();a.push(D(0,0,i,l)),a.push(D(0,0,l,s)),a.push(D(0,s-l,i,l)),a.push(D(i-l,0,i,s)),r.includes("n")&&a.push(S(i-80>>1,0,80,l,"n",{dt:t.includes("N")})),r.includes("s")&&a.push(S(i-80>>1,s-l,80,l,"s",{dt:t.includes("S")})),r.includes("w")&&a.push(S(0,s-80>>1,l,80,"w",{dt:t.includes("W")})),r.includes("e")&&a.push(S(i-l,s-80>>1,l,80,"e",{dt:t.includes("E")}));let d={e:(e,t)=>m(e,"d"===t.e?"\uD83D\uDC36":"\uD83D\uDC2D",t),x:(e,t)=>t.a&&(e.fillStyle="#3337",e.strokeRect(t.x,t.y,t.w,t.h),e.fillRect(t.x,t.y,t.w,t.h),e.fillStyle="#333",e.fillText("☠️",t.x+t.w/2,t.y+t.h/2)),c:(e,t)=>e.fillText("\uD83E\uDDC0",t.x+t.w/2,t.y+t.h/2),w:(e,t)=>(e.fillStyle=4&t.m?"#333":"rgba(195, 235, 255, 0.9)",e.fillRect(t.x,t.y,t.w,t.h)),d:(e,t)=>(e.globalAlpha=t.alpha??1,e.fillStyle=t.dt?"#b29a39":"#556CC9",e.fillRect(t.x,t.y,t.w,t.h),e.globalAlpha=1,t.dt&&(e.save(),e.font="14px monospace",e.fillText("\uD83E\uDDC0",t.x+t.w/2,t.y+t.h/2),e.restore())),o:(e,t)=>(e.fillStyle="#6cf",e.fillRect(t.x,t.y,t.w,t.h)),t:(e,t)=>(e.fillStyle="#000000cc",e.fillText(t.m,t.x+t.w/2,t.y+t.h/2)),et:(e,t)=>(e.globalAlpha=t.alpha??1,e.fillStyle="#000",e.fillText(t.te,t.x+t.w/2,t.y+t.h/2),e.globalAlpha=1),n:(e,t)=>{e.fillStyle="#333",e.fillText("\uD83D\uDCD3",t.x+t.w/2,t.y+t.h/2),t.a&&function(e,t,o,n,i){let s=parseInt(e.font)||16;n.split("\n").forEach(n=>{let l=n.split(" "),a="";for(let n=0;n<l.length;n++){let r=a+(a?" ":"")+l[n];e.measureText(r).width>i&&a?(e.fillText(a,t,o),o+=s,a=l[n]):a=r}e.fillText(a,t,o),o+=s})}(e,t.x+t.tdx,t.y+t.tdy,t.tx,t.tdw??250)},bw:(e,t)=>(e.fillStyle="#ffbe7cff",e.fillRect(t.x,t.y,t.w,t.h))};return{collisions:a,update:e=>{for(let t=a.length;t--;){let o=a[t];if(o.dx||o.dy){if(o.tim){o.tim-=e,o.tim<0&&(o.tim=0);continue}let n=o.x+o.dx*(e/16),i=o.y+o.dy*(e/16);for(let s=a.length;s--;)t!==s&&(o.justB&&(o.justBDT+=e),o.justB&&o.justBDT>3e3&&(o.justB=!1),y({x:n,y:i,w:o.w,h:o.h,c:o.c,m:o.m},a[s])?(o.x=n,o.y=i,o.justB||x(o,a[s]),(o.x<10||o.y<10||o.x>630||o.y>390)&&(o.x=30,o.y=30,o.dx=1,o.dy=1)):(o.x=n,o.y=i))}else if(o.mv&&e){o.mv.o=(o.mv.o+e)%(2*o.mv.t);let t=o.mv.o/o.mv.t;t>1&&(t=2-t),o.x=o.mv.x+o.mv.dx*t,o.y=o.mv.y+o.mv.dy*t}o.mfd&&("m"===o.e&&a.push({x:o.x,y:o.y,w:o.w,h:o.h,t:"c",c:128,m:1}),a.splice(t,1))}},draw:e=>{e.drawImage(f,0,0);for(let t=0;t<a.length;t++)a[t].hi||d[a[t].t](e,a[t]);4===o&&0===n&&function(e,t,o,n,i,s){e.save(),e.fillStyle="#000",e.fillRect(15,15,610,200);let l=t+n/2,a=o+i/2,r=Math.hypot(n,i)/2,d=.001*s;e.lineWidth=2;for(let t=120;t--;){let o=t/120,n=r*o,i=d+8*o,c=.5*Math.sin(97*t+.01*s);n*=1+.05*c,i+=.6*c,(t+s/50|0)%17!=0&&(e.strokeStyle=t%4?"#E68E35":"#ffffff",e.beginPath(),e.moveTo(l+Math.cos(i)*n,a+Math.sin(i)*n),e.lineTo(l+Math.cos(i+.25)*n*.98,a+Math.sin(i+.25)*n*.98),e.stroke())}e.restore()}(e,15,15,610,200,performance.now())},x:o,y:n}})(JSON.parse(JSON.stringify(e))))).find(e=>e.x===J.x&&e.y===J.y),n.load(J.x,J.y),i.newRoom("e"),i.setRooms(d),B("cc",(I("cc")??0)+1),requestAnimationFrame(V)};function H(){let e=Math.min(innerWidth/640,innerHeight/400),t=(t,o)=>{t.style.width=640*e+"px",t.style.height=400*e+"px",t.width=640*G,t.height=400*G,o.setTransform(G,0,0,G,0,0),o.font="18px monospace",o.textAlign="center",o.textBaseline="middle"};t(W,O),t(U,N),n&&n.load()}const X=[{rects:[L(200,200,20,20,10,-100,Y[0])],doors:"n",x:0,y:1},{rects:[D(210,130,20,140),D(220,250,130,20),D(350,130,20,140,{m:3}),D(210,130,140,20),b(280,160,20,20,"⚫",{m:5,ac:12,as:0}),L(280,220,20,20,140,-25,Y[16])],doors:"we",x:1,y:0},{rects:[p(200,200),v(100,100),v(300,200)],doors:"wE",x:2,y:0},{rects:[g(140,130,20,185),g(290,220,100,50)],doors:"wns",x:3,y:0},{rects:[],doors:"nsew",x:3,y:1},{rects:[D(15,300,500,15),b(18,20,20,20,"\uD83D\uDC1F",{alpha:.2,hi:1}),g(100,100,15,60),g(100,160,60,15),g(160,100,15,120)],doors:"ne",x:3,y:2},{rects:[b(200,100,20,20,"⚫",{m:5,ac:3,as:0}),b(300,100,20,20,"⚫",{m:5,ac:4,as:0}),b(400,100,20,20,"⚫",{m:5,ac:5,as:0})],doors:"w",x:4,y:2},{rects:[b(305,30,32,32,'"exit"'),b(530,184,32,32,"\uD83D\uDCBB",{hi:1}),D(500,140,600,15,{m:3}),D(500,245,600,15,{m:3}),D(485,140,15,120,{m:3}),b(230,300,20,20,"\uD83D\uDC1F0",{m:5,ac:8,av:0}),b(280,300,20,20,"\uD83D\uDC360",{m:5,ac:9,av:0}),b(330,300,20,20,"\uD83E\uDD6C0",{m:5,ac:10,av:0}),b(380,300,20,20,"\uD83E\uDD5D0",{m:5,ac:11,av:0})],doors:"wen",x:4,y:1},{rects:[],doors:"sWe",x:3,y:-1},{rects:[g(105,85,80,245),g(265,125,110,25),g(315,195,125,20),g(215,265,145,25),g(435,310,30,75),g(490,20,40,220)],doors:"ew",x:4,y:-1},{rects:[D(240,0,10,80),D(250,80,110,10,{m:3}),D(360,0,10,80),b(290,20,20,20,"⚫",{m:5,ac:6,as:0}),D(140,130,380,10),D(550,0,20,400),g(450,50,70,70),g(70,70,70,50),v(300,200),v(100,300),L(600,100,20,20,-160,10,Y[2],{hi:1})],doors:"ew",x:5,y:-1},{rects:[D(140,120,10,170),D(220,200,230,20),D(510,120,10,170),C(160,20,150,90,{t:5e3,x:100,y:70,o:0,dx:250,dy:0}),p(50,50),v(300,300),v(200,200),v(100,100),S(280,384,80,16,"s",{dt:0,alpha:0}),C(160,20,60,40,{t:2e3,x:140,y:30,o:0,dx:0,dy:100})],doors:"wN",x:6,y:-1},{rects:[g(510,250,10,110),g(520,250,50,10),g(520,350,50,10),g(560,310,10,40),g(520,300,50,10),b(600,50,20,20,"\uD83E\uDD6C",{alpha:.2,hi:1})],doors:"w",x:6,y:0},{rects:[],doors:"ne",x:5,y:0},{rects:[g(480,150,15,100),L(400,200,20,20,10,-120,Y[1],{tdw:300})],doors:"se",x:0,y:0},{rects:[D(0,120,130,10,{m:3}),E(120,15,40,3),E(220,117,40,3),E(300,15,40,3),E(290,15,30,3),E(390,110,80,3,{mv:{t:2e3,x:390,y:117,o:0,dx:100,dy:0}}),D(130,80,10,50),D(140,120,420,10),D(560,0,10,400),D(380,0,10,40),b(460,40,20,20,"⚫",{m:5,ac:7,as:0})],doors:"es",x:6,y:-2},{rects:[v(50,50),v(390,50),v(120,350),v(520,250),D(190,160,10,90),D(200,160,40,10),D(240,170,10,70),g(200,240,40,10),g(280,170,10,70),D(290,240,60,10),D(350,170,10,70),g(290,160,60,10),D(380,160,10,90),D(390,240,50,10),g(440,200,10,50),D(410,190,40,10),g(390,160,60,10),v(200,200)],doors:"ne",x:2,y:-1},{rects:[g(120,70,410,240),p(200,200)],doors:"SWe",x:2,y:1},{rects:[L(200,200,20,20,10,-30,Y[3])],doors:"es",x:1,y:1},{rects:[],doors:"ns",x:1,y:2},{rects:[],doors:"ns",x:1,y:3},{rects:[L(400,300,20,20,10,-30,Y[4])],doors:"n",x:1,y:4},{rects:[b(305,80,32,32,"\uD83E\uDEA6"),b(240,60,128,32,"\uD83D\uDC2D",{alpha:.6}),D(0,120,640,10)],doors:"ns",x:2,y:-2},{rects:[b(300,300,20,20,"\uD83E\uDD5D",{alpha:.2,hi:1}),g(80,60,20,230)],doors:"s",x:2,y:-3},{rects:[L(200,300,20,20,10,-70,Y[5])],doors:"s",x:4,y:0},{rects:[L(500,200,20,20,-50,-100,Y[13])],doors:"w",x:5,y:1},{rects:[g(0,310,640,30),b(200,80,32,32,"\uD83E\uDD54"),L(200,350,20,20,10,-100,Y[14])],doors:"n",x:2,y:2},{rects:[L(200,350,20,20,10,-50,Y[15]),b(160,350,20,20,"\uD83D\uDC2D",{alpha:.6})],doors:"w",x:7,y:-2}],z=()=>{"4,5,6,1"==`${d[7].collisions[5].av},${d[7].collisions[6].av},${d[7].collisions[7].av},${d[7].collisions[8].av}`&&(d[7].collisions[4].hi=1)},K=[0,1,e=>{d[5].collisions[1].hi=1,d[12].collisions[5].hi=1;for(let e=0;e<3;e++)r.collisions[e].te="⚫",r.collisions[e].as=0},e=>{K[2](),e.as=1,e.te=e.as?"\uD83D\uDC1F":"⚫",d[5].collisions[1].hi=0,window.sounds&&window.sounds.sfx(3)},e=>{K[2](),e.as=1,e.te=e.as?"\uD83E\uDD6C":"⚫",d[12].collisions[5].hi=0,window.sounds&&window.sounds.sfx(3)},e=>{K[2](),e.as=1,e.te=e.as?"\uD83E\uDD5D":"⚫",d[23].collisions[0].hi=0,window.sounds&&window.sounds.sfx(3)},e=>{e.as=+(0===e.as),r.collisions[5].hi=+(0!==e.as),e.te=0===e.as?"⚫":"\uD83D\uDFE2",window.sounds&&window.sounds.sfx(3)},e=>{e.as=+(0===e.as),r.collisions[8].hi=+(0!==e.as),e.te=0===e.as?"⚫":"\uD83D\uDFE2",window.sounds&&window.sounds.sfx(3)},e=>{e.av=(e.av+1)%10,e.te="\uD83D\uDC1F"+e.av,z()},e=>{e.av=(e.av+1)%10,e.te="\uD83D\uDC36"+e.av,z()},e=>{e.av=(e.av+1)%10,e.te="\uD83E\uDD6C"+e.av,z()},e=>{e.av=(e.av+1)%10,e.te="\uD83E\uDD5D"+e.av,z()},e=>{e.as=+(0===e.as),r.collisions[2].hi=+(0!==e.as),e.te=0===e.as?"⚫":"\uD83D\uDFE2",window.sounds&&window.sounds.sfx(3)}],Q={"6,-1":()=>{let e=d.find(e=>5===e.x&&-1===e.y);e.collisions[5].hi=0,e.collisions[3].as=0,e.collisions[3].te="⚫",d.find(e=>5===e.x&&-1===e.y).collisions[10].hi=0},"2,-2":()=>{let e=d.find(e=>2===e.x&&-2===e.y);e.collisions[1].te="\uD83D\uDC2D "+c,0===c?e.collisions[2].hi=1:e.collisions[2].hi=0}};function V(f){let m=Math.min(50,f-a);if(a=f,i.isDead()&&0===h.t&&(window.sounds&&window.sounds.sfx(4),window.sounds&&window.sounds.pauseSong(0),h.t=m,O.fillStyle="#fff",O.fillText("Again",320,200),h.prev=-1),n.update(J.x,J.y));else if(u.a){r.draw(O);let e=u.d?u.t/250:1-u.t/250;O.fillStyle=`rgba(0,0,0,${Math.min(e,1)})`,O.fillRect(0,0,640,400),u.t+=m,u.d&&u.t>=75&&(u.h(),u.t=1,u.d=0),!u.d&&u.t>=150&&(u.a=!1,U.style.display="block")}else if(h.t>0||4===J.x&&0===J.y&&w(i.getPosRect(),{x:0,y:0,w:640,h:180})){h.t||(O.fillStyle="#fff",O.fillText(h.proph,320,120),h.prev=-1),h.t+=m;let e=Math.floor(h.t/500);e>h.prev&&(O.fillStyle="rgba(0, 0, 0, 0.1)",O.fillRect(0,0,640,400),h.prev=e)}else if(i.dc(m,O));else{if(O.clearRect(0,0,640,400),e.g&&r.collisions.filter(e=>"d"===e.t&&e.dt).forEach(e=>e.dt=0),t["0"]||t["2"]){let e={...i.getBullet(),t:t["2"]};o.push(e),t["0"]=0,t["2"]=0}let a=i.updatePlayer(m,e,s,l,r);for(let e of o)for(let t of(e.x+=e.dx*(m/16)*2,e.y+=e.dy*(m/16)*2,2===r.x&&2===r.y&&y(e,i.getPosRect())&&(r.collisions[0].hi=1),r.collisions))if(y(e,t)){if("m"===t.e&&(t.mfd=!0,c++,B("mc",(I("mc")??0)+1)),"d"!==t.e||t.tim||(t.tim=1500),t.ac>0&&K[t.ac](t),"bw"===t.t){x(e,t);continue}e.mdf=!0}o=o.filter(e=>!e.mdf),r.update(m),r.draw(O);let h="";for(let e of o){let t=e.t?"hotpink":"blue";t!==h&&(O.fillStyle=t,h=t),O.fillText("\uD83E\uDDF6",e.x,e.y)}i.drawPlayer(O),a&&(a.t,"e"===a.t||"d"===a.t&&i.canOpen(a)&&("e"===a.d&&J.x++,"w"===a.d&&J.x--,"s"===a.d&&J.y++,"n"===a.d&&J.y--,U.style.display="none",u.a=!0,u.t=0,u.d=1,u.h=()=>{r=d.find(e=>e.x===J.x&&e.y===J.y),n.load(J.x,J.y),console.log("entering room",J),o=[],i.newRoom(a.d),window.sounds&&window.sounds.sfx(2),r.collisions.forEach(e=>{"x"!==e.t||e.mv||(e.a=0)}),Q[`${J.x},${J.y}`]?.()})),O.fillStyle="#461E52",O.fillText(i.invText(),575,35)}h.t>3e3?q():requestAnimationFrame(V)}O.textAlign="center",O.textBaseline="middle",addEventListener("resize",H),H(),onkeydown=t=>e[t.key.toLowerCase()]=1,onkeyup=t=>{e[t.key.toLowerCase()]=0},oncontextmenu=e=>e.preventDefault(),onmousemove=e=>{let t=W.getBoundingClientRect();s=(e.clientX-t.left)*640/t.width,l=(e.clientY-t.top)*400/t.height},onmousedown=e=>t[e.button.toString()]=1,onmouseup=e=>t[e.button.toString()]=0,window.warp=(e,t)=>{J.x=e,J.y=t,n.load(e,t),r=d.find(o=>o.x===e&&o.y===t),o=[],i.newRoom("w"),window.sounds&&window.sounds.sfx(1),Q[`${J.x},${J.y}`]?.()},O.fillStyle="#000000cc",O.fillText("loading...",320,200),window.sounds=new class{constructor(){this.player=new k,this.soundsLoading=[A,P,$,j,F],this.sounds=[],this.currentlyLoadingIndex=0,this.startedLoading=!1}load(e){if(this.startedLoading||(this.player.init(this.soundsLoading[this.currentlyLoadingIndex]),this.startedLoading=!0),1>this.player.generate())return void setTimeout(()=>this.load(e),100);{let t=this.player.createWave(),o=document.createElement("audio");o.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),this.sounds.push(o),this.currentlyLoadingIndex++,this.currentlyLoadingIndex<this.soundsLoading.length?(this.player.init(this.soundsLoading[this.currentlyLoadingIndex]),this.load(e)):(this.sounds[0].loop=!0,this.sounds[0].volume=0,e())}}playSong(e,t=0){this.sounds[e].loop=!0,this.sounds[e].volume=t,this.sounds[e].play()}pauseSong(e){this.sounds[e].pause()}stopSong(e){this.pauseSong(e),this.sounds[e].currentTime=0}sfx(e){this.sounds[e].play()}fade(e,t){this.intervalID&&clearInterval(this.intervalID),this.sounds[e].play(),this.intervalID=setInterval(()=>{if(this.sounds[e].volume<.9){let o=this.sounds[e].volume+.1;if(o>.9&&(o=.9),this.sounds[e].volume=o.toFixed(2),this.sounds[t].volume>0){let e=.9-o;e<0&&(e=0),this.sounds[t].volume=e.toFixed(2)}}else clearInterval(this.intervalID),this.intervalID=void 0},100)}}(void 0),window.sounds.load(()=>{O.clearRect(0,0,640,400),O.save(),O.font="64px monospace",O.shadowBlur=15,O.shadowColor="rgba(0,0,0,.7)",O.fillText("\uD83D\uDE3C",320,130),O.restore(),O.fillStyle="#000000cc",O.fillText("nine lives later - déjà meow",320,200),O.fillText("click to start",320,240);let e=()=>{window.removeEventListener("click",e),q()};window.addEventListener("click",e)});