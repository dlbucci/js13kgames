(()=>{var vt=`
    _______
  _/_/\\_/\\_\\_
    ( O.o )
     > ^ <
    < | | >
    -------
      //
      \\\\//

`,Ct=`
    _______
  _/_/\\_/\\_\\_
    ( O.o )
     > ^ <
    < | | >
    -------
       \\\\
     \\\\//

`,xt=`
    _______
  _/_/\\_/\\_\\_
    ( O.o )
     > ^ <
    < | | >
    -------
       ||
       ||
       ||
`;function Q(){let r=0,t=document.querySelector("#ascii-cat"),e=setInterval(()=>{r===0||r===2?(r++,t.innerHTML=`<pre>${xt}</pre>`):r===1?(r++,t.innerHTML=`<pre>${vt}</pre>`):(r=0,t.innerHTML=`<pre>${Ct}</pre>`)},500);return()=>{clearInterval(e),t.innerHTML=""}}var d=new(window.AudioContext||window.webkitAudioContext),At=110,wt=60/At,N=d.createGain();N.connect(d.destination);function O(r,t,e="sine",n=d.currentTime,o=.3){let a=d.createOscillator(),i=d.createGain();a.type=e,a.frequency.setValueAtTime(r,n),i.gain.setValueAtTime(0,n),i.gain.linearRampToValueAtTime(o,n+.01),i.gain.exponentialRampToValueAtTime(.001,n+t),a.connect(i).connect(N),a.start(n),a.stop(n+t)}function kt(r){O(100,.5,"sine",r,.8)}function It(r){let t=d.createBufferSource(),e=d.createBuffer(1,d.sampleRate*.2,d.sampleRate),n=e.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=Math.random()*2-1;t.buffer=e;let o=d.createGain();o.gain.setValueAtTime(.4,r),o.gain.exponentialRampToValueAtTime(.01,r+.2);let a=d.createBiquadFilter();a.type="highpass",a.frequency.setValueAtTime(1e3,r),t.connect(a).connect(o).connect(N),t.start(r),t.stop(r+.2)}function qt(r){let t=d.createBufferSource(),e=d.createBuffer(1,d.sampleRate*.05,d.sampleRate),n=e.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=Math.random()*2-1;t.buffer=e;let o=d.createGain();o.gain.setValueAtTime(.15,r),o.gain.exponentialRampToValueAtTime(.01,r+.05);let a=d.createBiquadFilter();a.type="highpass",a.frequency.setValueAtTime(5e3,r),t.connect(a).connect(o).connect(N),t.start(r),t.stop(r+.05)}var X=[55,65,73,82],Z=[220,247,220,262,0,220,196,0],A=0,w=0,V=!1;function tt(){for(;A<d.currentTime+.1;){if(w%8===0&&kt(A),w%8===4&&It(A),w%2===0&&qt(A),w%2===0){let t=X[w/2%X.length];O(t,.4,"sawtooth",A,.3)}let r=Z[w%Z.length];r&&O(r,.2,"square",A,.15),A+=wt/2,w++}V||requestAnimationFrame(tt)}function et(){V=!1,d.state==="suspended"&&d.resume(),A=d.currentTime+.1,w=0,tt()}function it(){console.log("stop song"),N.gain.setValueAtTime(0,0),V=!0}var D=class{conductor;name;pack;lastRepeatCount=0;volumeLevel=1;articulationGapPercentage=.05;totalDuration=0;bufferPosition=0;instrument;notes=[];getPackName(){return this.pack}constructor(t,e,n){if(!n)throw new Error("Conductor instance is required to create an Instrument.");this.conductor=n,this.name=t||"sine",this.pack=e||"oscillators";let o=T.getInstrumentPack(this.pack);if(!o)throw new Error(`${this.pack} is not a currently loaded Instrument Pack or failed to retrieve.`);this.instrument=o(this.name,this.conductor.audioContext)}getDuration(t){if(typeof this.conductor.notes[t]>"u")throw new Error(`${t} is not a correct rhythm.`);return this.conductor.notes[t]*this.conductor.tempo/this.conductor.noteGetsBeat*10}clone(t){return t===null||typeof t!="object"?t:{...t}}setVolume(t){let e=t;return t>1&&t<=100&&(e=t/100),this.volumeLevel=Math.max(0,Math.min(1,e)),this}note(t,e,n){let o=this.getDuration(t),a=n?0:o*this.articulationGapPercentage,i=e;if(e){let s=typeof e=="string"?e.split(",").map(c=>c.trim()):Array.isArray(e)?e.map(c=>typeof c=="string"?c.trim():c):[e];if(this.pack==="noises")i=s.length===1?s[0]:s;else{let c=[...s];for(let u=0;u<c.length;u++){let l=c[u];if(typeof l=="string"&&typeof this.conductor.pitches[l]>"u"){let p=Number.parseFloat(l);if(Number.isNaN(p)||p<0)throw new Error(`Pitch "${l}" is not a valid named pitch or frequency.`);c[u]=p}}i=c.length===1?c[0]:c}}return this.notes.push({rhythm:t,pitch:i,duration:o,articulationGap:a,tie:n,startTime:this.totalDuration,stopTime:this.totalDuration+o-a,volumeLevel:this.volumeLevel/4}),this.totalDuration+=o,this}rest(t){let e=this.getDuration(t);return this.notes.push({rhythm:t,pitch:!1,duration:e,articulationGap:0,startTime:this.totalDuration,stopTime:this.totalDuration+e}),this.totalDuration+=e,this}repeatStart(){return this.lastRepeatCount=this.notes.length,this}repeatFromBeginning(t=1){return this.lastRepeatCount=0,this.repeat(t),this}repeat(t=1){let e=this.notes.slice(this.lastRepeatCount);for(let n=0;n<t;n++)for(let o=0;o<e.length;o++){let a=e[o],i=this.clone(a);i.startTime=this.totalDuration,i.stopTime=this.totalDuration+i.duration-i.articulationGap,this.notes.push(i),this.totalDuration+=i.duration}return this}resetDuration(){this.totalDuration=0;for(let t=0;t<this.notes.length;t++){let e=this.notes[t],n=this.getDuration(e.rhythm),o=e.tie?0:n*this.articulationGapPercentage;e.duration=n,e.startTime=this.totalDuration,e.stopTime=this.totalDuration+n-o,e.pitch!==!1&&(e.articulationGap=o),this.totalDuration+=n}}};var S=class{conductor;bufferTimeout;allNotes;currentPlayTime=0;totalPlayTime=0;faded=!1;paused=!1;playing=!1;looping=!1;muted=!1;constructor(t){this.conductor=t,this.allNotes=this.bufferNotes(),this.calculateTotalDuration(),this.getCurrentPlayTime=()=>this.currentPlayTime,this.getTotalPlayTime=()=>this.totalPlayTime,this.getTimeOffset=()=>this.conductor.audioContext.currentTime-this.totalPlayTime}reset(t=!1){let e=-1,n=this.conductor.instruments.length;for(;++e<n;){let o=this.conductor.instruments[e];t?(o.resetDuration(),o.bufferPosition=0):o.bufferPosition=this.findBufferPositionForTime(o,this.totalPlayTime)}for(t&&(this.calculateTotalDuration(),this.totalPlayTime=this.conductor.percentageComplete*this.conductor.totalDuration),e=-1;++e<this.allNotes.length;)this.allNotes[e]?.gain&&this.allNotes[e].gain.disconnect();clearTimeout(this.bufferTimeout),this.allNotes=this.bufferNotes()}findBufferPositionForTime(t,e){for(let n=0;n<t.notes.length;n++){let o=t.notes[n];if(o&&o.stopTime>e)return n}return t.notes.length}fade(t,e,n=!1){this.faded=t==="down",t==="up"?(this.conductor.masterVolume.gain.linearRampToValueAtTime(0,this.conductor.audioContext.currentTime),this.conductor.masterVolume.gain.linearRampToValueAtTime(this.conductor.masterVolumeLevel,this.conductor.audioContext.currentTime+.2)):(this.conductor.masterVolume.gain.linearRampToValueAtTime(this.conductor.masterVolumeLevel,this.conductor.audioContext.currentTime),this.conductor.masterVolume.gain.linearRampToValueAtTime(0,this.conductor.audioContext.currentTime+.2)),setTimeout(()=>{typeof e=="function"&&e.call(this),n&&(this.faded=!this.faded,this.conductor.masterVolume.gain.linearRampToValueAtTime(this.conductor.masterVolumeLevel,this.conductor.audioContext.currentTime))},.2*1e3)}calculateTotalDuration(){let t=-1,e=0;for(;++t<this.conductor.instruments.length;){let n=this.conductor.instruments[t];n.totalDuration>e&&(e=n.totalDuration)}this.conductor.totalDuration=e}bufferNotes(){let t=[],e=-1,n=this.conductor.noteBufferLength;for(;++e<this.conductor.instruments.length;){let o=this.conductor.instruments[e],a=n,i=-1;for(;++i<a;){let s=o.notes[o.bufferPosition+i];if(typeof s>"u")break;let{pitch:c,startTime:u,stopTime:l,volumeLevel:p,tie:g}=s,m=typeof p=="number"?p:1;if(l<=this.totalPlayTime){a++;continue}if(c===!1)continue;let h=this.conductor.audioContext.createGain();h.connect(this.conductor.masterVolume),h.gain.value=m;let y;if(o.getPackName()!=="noises"&&c!==void 0){let f=Array.isArray(c)?c[0]:c;typeof f=="string"?y=this.conductor.pitches[f.trim()]||Number.parseFloat(f):y=f,Number.isNaN(y)&&(y=void 0)}let k=o.instrument.createNote(h,y);t.push({startTime:u,stopTime:l,node:k,gain:h,volumeLevel:m,tie:g}),Array.isArray(c)&&c.slice(1).forEach(f=>{let P=this.conductor.audioContext.createGain();P.connect(this.conductor.masterVolume),P.gain.value=m;let M;typeof f=="string"?M=this.conductor.pitches[f.trim()]||Number.parseFloat(f):M=f;let Tt=o.instrument.createNote(P,M);t.push({startTime:u,stopTime:l,node:Tt,gain:P,volumeLevel:m,tie:!0})})}o.bufferPosition+=a}return t}totalPlayTimeCalculator(){!this.paused&&this.playing&&(this.conductor.totalDuration<this.totalPlayTime?(this.stop(!1),this.looping?this.play():this.conductor.onFinishedCallback()):(this.updateTotalPlayTime(),setTimeout(()=>this.totalPlayTimeCalculator(),1e3/60)))}updateTotalPlayTime(){this.totalPlayTime+=this.conductor.audioContext.currentTime-this.currentPlayTime;let t=Math.round(this.totalPlayTime);t!==this.conductor.currentSeconds&&(setTimeout(()=>{this.conductor.onTickerCallback(t)},1),this.conductor.currentSeconds=t),this.conductor.percentageComplete=this.totalPlayTime/this.conductor.totalDuration,this.currentPlayTime=this.conductor.audioContext.currentTime}play(){this.playing=!0,this.paused=!1,this.currentPlayTime=this.conductor.audioContext.currentTime,this.totalPlayTimeCalculator();let t=this.conductor.audioContext.currentTime-this.totalPlayTime,e=o=>{let a=-1;for(;++a<o.length;){let i=o[a],{startTime:s,stopTime:c}=i,u=c-s;if(!i.tie){s>0&&(s-=.001),c+=.001;let f=typeof i.volumeLevel=="number"?i.volumeLevel:1;if(i.gain.gain.setValueAtTime(0,s),i.gain.gain.linearRampToValueAtTime(f,s+.001),i.gain.gain.setValueAtTime(f,i.stopTime-.001),i.gain.gain.linearRampToValueAtTime(0,i.stopTime),i.node.frequency){let P=i.node.frequency.value;u<2}}let l=i.startTime,p=i.stopTime,g=p-l,m,h=0;if(l<this.totalPlayTime){if(p<=this.totalPlayTime)continue;m=this.conductor.audioContext.currentTime,h=this.totalPlayTime-l}else m=this.conductor.audioContext.currentTime+(l-this.totalPlayTime),h=0;if(m<this.conductor.audioContext.currentTime){let f=this.conductor.audioContext.currentTime-m;m=this.conductor.audioContext.currentTime,"buffer"in i.node&&i.node.buffer!==null&&(h+=f)}let y=g-h;if(y<=0)continue;let k=m+y;if(i.node&&typeof i.node.start=="function")try{"buffer"in i.node&&i.node.buffer!==null?i.node.start(m,h):i.node.start(m),i.node.stop(k)}catch(f){console.error("Error scheduling note:",{noteStartTime:l,noteStopTime:p,totalPlayTime:this.totalPlayTime,scheduleTime:m,playOffset:h,remainingDuration:y,audioCurrentTime:this.conductor.audioContext.currentTime,error:f})}}},n=()=>{this.bufferTimeout=setTimeout(()=>{if(this.playing&&!this.paused){let o=this.bufferNotes();o.length>0&&(e(o),this.allNotes=this.allNotes.concat(o),n())}},this.conductor.tempo*5e3)};e(this.allNotes),n(),this.faded&&!this.muted&&this.fade("up")}stop(t=!0){this.playing=!1,this.conductor.currentSeconds=0,this.conductor.percentageComplete=0,t&&!this.muted?this.fade("down",()=>{this.totalPlayTime=0,this.reset(),setTimeout(()=>{this.conductor.onTickerCallback(this.conductor.currentSeconds)},1)},!0):(this.totalPlayTime=0,this.reset(),setTimeout(()=>{this.conductor.onTickerCallback(this.conductor.currentSeconds)},1))}pause(){this.paused=!0,this.updateTotalPlayTime(),this.muted?this.reset():this.fade("down",()=>{this.reset()})}loop(t){this.looping=t}setTime(t){this.totalPlayTime=typeof t=="string"?Number.parseInt(t):t,this.reset(),this.playing&&!this.paused&&this.play()}resetTempo(){this.reset(!0),this.playing&&!this.paused&&this.play()}mute(t){this.muted=!0,this.fade("down",t)}unmute(t){this.muted=!1,this.fade("up",t)}};var T=class r{static packs={instrument:{},rhythm:{},tuning:{}};static signatureToNoteLengthRatio={2:6,4:3,8:4.5};audioContext;masterVolume;instruments=[];player=null;pitches;notes;masterVolumeLevel=1;beatsPerBar=4;noteGetsBeat=3;tempo=60/120;totalDuration=0;currentSeconds=0;percentageComplete=0;noteBufferLength=20;onTickerCallback=()=>{};onFinishedCallback=()=>{};onDurationChangeCallback=()=>{};constructor(t="equalTemperament",e="northAmerican"){if(typeof r.packs.tuning[t]>"u")throw new Error(`${t} is not a valid tuning pack.`);if(typeof r.packs.rhythm[e]>"u")throw new Error(`${e} is not a valid rhythm pack.`);this.audioContext=new AudioContext,this.masterVolume=this.audioContext.createGain(),this.masterVolume.connect(this.audioContext.destination),this.pitches=r.packs.tuning[t],this.notes=r.packs.rhythm[e],this.setMasterVolume(1),this.setTempo(120),this.setTimeSignature(4,4)}load(t){if(this.instruments.length>0&&this.destroy(),!t)throw new Error("JSON is required for this method to work.");if(!t.instruments||Object.keys(t.instruments).length===0)throw new Error("You must define at least one instrument.");if(!t.notes||Object.keys(t.notes).length===0)throw new Error("You must define notes for each instrument.");t.timeSignature&&this.setTimeSignature(t.timeSignature[0],t.timeSignature[1]),t.tempo&&this.setTempo(t.tempo);let e={};for(let n in t.instruments)if(Object.prototype.hasOwnProperty.call(t.instruments,n)){let o=t.instruments[n];e[n]=this.createInstrument(o.name,o.pack)}for(let n in t.notes)if(Object.prototype.hasOwnProperty.call(t.notes,n)){let o=e[n];if(!o){console.warn(`Notes defined for unknown instrument alias: ${n}`);continue}let a=t.notes[n];for(let i of a)if(typeof i=="string"){let s=i.split("|"),c=s[0],u=s[1],l=s[2];u==="rest"?o.rest(c):o.note(c,u,l==="true"||l==="tie")}else i.type==="rest"?o.rest(i.rhythm):i.type==="note"&&o.note(i.rhythm,i.pitch||[],i.tie)}return this.finish()}createInstrument(t,e){let n=new D(t,e,this);return this.instruments.push(n),n}finish(){return this.player=new S(this),this.player}destroy(){this.audioContext?.close&&this.audioContext.close().catch(t=>console.error("Error closing AudioContext:",t)),this.audioContext=new AudioContext,this.masterVolume=this.audioContext.createGain(),this.masterVolume.connect(this.audioContext.destination),this.instruments=[],this.totalDuration=0,this.currentSeconds=0,this.percentageComplete=0,this.player,this.player=null}setMasterVolume(t){this.masterVolumeLevel=Math.max(0,Math.min(1,t)),this.masterVolume?.gain&&this.masterVolume.gain.setValueAtTime(this.masterVolumeLevel,this.audioContext.currentTime)}getTotalSeconds(){return Math.round(this.totalDuration)}setTickerCallback(t){if(typeof t!="function")throw new Error("Ticker must be a function.");this.onTickerCallback=t}setTimeSignature(t,e){if(typeof r.signatureToNoteLengthRatio[e]>"u")throw new Error(`The bottom time signature (${e}) is not supported.`);this.beatsPerBar=t,this.noteGetsBeat=r.signatureToNoteLengthRatio[e]}setTempo(t){this.tempo=60/t,this.player&&(this.player.resetTempo(),this.onDurationChangeCallback())}setOnFinishedCallback(t){if(typeof t!="function")throw new Error("onFinished callback must be a function.");this.onFinishedCallback=t}setOnDurationChangeCallback(t){if(typeof t!="function")throw new Error("onDurationChanged callback must be a function.");this.onDurationChangeCallback=t}setNoteBufferLength(t){this.noteBufferLength=t}static getInstrumentPack(t){if(Object.prototype.hasOwnProperty.call(r.packs.instrument,t))return r.packs.instrument[t]}static loadPack(t,e,n){if(["tuning","rhythm","instrument"].indexOf(t)===-1)throw new Error(`${t} is not a valid Pack Type.`);if(!Object.prototype.hasOwnProperty.call(r.packs[t],e))switch(t){case"tuning":r.packs.tuning[e]=n;break;case"rhythm":r.packs.rhythm[e]=n;break;case"instrument":if(typeof n=="function")r.packs.instrument[e]=n;else throw new Error(`Invalid data provided for instrument pack "${e}". Expected a function.`);break}}};var nt={C0:16.35,"C#0":17.32,Db0:17.32,D0:18.35,"D#0":19.45,Eb0:19.45,E0:20.6,F0:21.83,"F#0":23.12,Gb0:23.12,G0:24.5,"G#0":25.96,Ab0:25.96,A0:27.5,"A#0":29.14,Bb0:29.14,B0:30.87,C1:32.7,"C#1":34.65,Db1:34.65,D1:36.71,"D#1":38.89,Eb1:38.89,E1:41.2,F1:43.65,"F#1":46.25,Gb1:46.25,G1:49,"G#1":51.91,Ab1:51.91,A1:55,"A#1":58.27,Bb1:58.27,B1:61.74,C2:65.41,"C#2":69.3,Db2:69.3,D2:73.42,"D#2":77.78,Eb2:77.78,E2:82.41,F2:87.31,"F#2":92.5,Gb2:92.5,G2:98,"G#2":103.83,Ab2:103.83,A2:110,"A#2":116.54,Bb2:116.54,B2:123.47,C3:130.81,"C#3":138.59,Db3:138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185,Gb3:185,G3:196,"G#3":207.65,Ab3:207.65,A3:220,"A#3":233.08,Bb3:233.08,B3:246.94,C4:261.63,"C#4":277.18,Db4:277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,Gb4:369.99,G4:392,"G#4":415.3,Ab4:415.3,A4:440,"A#4":466.16,Bb4:466.16,B4:493.88,C5:523.25,"C#5":554.37,Db5:554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,Gb5:739.99,G5:783.99,"G#5":830.61,Ab5:830.61,A5:880,"A#5":932.33,Bb5:932.33,B5:987.77,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01};function Pt(r){return["white","pink","brown","brownian","red"].includes(r)}function Nt(r,t){let e=2*r.sampleRate,n=r.createBuffer(1,e,r.sampleRate),o=n.getChannelData(0);for(let i=0;i<e;i++)o[i]=Math.random()*2-1;let a=r.createBufferSource();return a.buffer=n,a.loop=!0,a.connect(t),a}function Dt(r,t){let e=2*r.sampleRate,n=r.createBuffer(1,e,r.sampleRate),o=n.getChannelData(0),a=0,i=0,s=0,c=0,u=0,l=0,p=0;for(let m=0;m<e;m++){let h=Math.random()*2-1;a=.99886*a+h*.0555179,i=.99332*i+h*.0750759,s=.969*s+h*.153852,c=.8665*c+h*.3104856,u=.55*u+h*.5329522,l=-.7616*l-h*.016898,o[m]=a+i+s+c+u+l+p+h*.5362,o[m]*=.11,p=h*.115926}let g=r.createBufferSource();return g.buffer=n,g.loop=!0,g.connect(t),g}function St(r,t){let e=2*r.sampleRate,n=r.createBuffer(1,e,r.sampleRate),o=n.getChannelData(0),a=0;for(let s=0;s<e;s++){let c=Math.random()*2-1;o[s]=(a+.02*c)/1.02,a=o[s],o[s]*=3.5}let i=r.createBufferSource();return i.buffer=n,i.loop=!0,i.connect(t),i}function Et(r,t){if(!Pt(r))throw new Error(`Invalid noise type: "${r}". Must be one of 'white', 'pink', 'brown', 'brownian', 'red'.`);return{createNote:(e,n)=>{switch(r){case"white":return Nt(t,e);case"pink":return Dt(t,e);case"brown":case"brownian":case"red":return St(t,e)}}}}var rt=Et;var ot={whole:1,dottedHalf:.75,half:.5,dottedQuarter:.375,tripletHalf:.33333334,quarter:.25,dottedEighth:.1875,tripletQuarter:.166666667,eighth:.125,dottedSixteenth:.09375,tripletEighth:.083333333,sixteenth:.0625,tripletSixteenth:.041666667,thirtySecond:.03125};function Bt(r){return["sine","square","sawtooth","triangle"].includes(r)}function _t(r,t){if(!Bt(r))throw new Error(`Invalid oscillator name: "${r}". Must be one of 'sine', 'square', 'sawtooth', 'triangle'.`);return{createNote:(e,n)=>{let o=t.createOscillator();return o.connect(e),o.type=r,typeof n=="number"&&(o.frequency.value=n),o}}}var st=_t;T.loadPack("tuning","equalTemperament",nt);T.loadPack("rhythm","northAmerican",ot);T.loadPack("instrument","oscillators",st);T.loadPack("instrument","noises",rt);var at=()=>{let r={timeSignature:[2,2],tempo:104,instruments:{leftHand:{name:"triangle",pack:"oscillators"},rightHand:{name:"square",pack:"oscillators"},drum:{name:"white",pack:"noises"},arrows:{name:"square",pack:"oscillators"}}},t=["quarter|D5","quarter|D5","quarter|rest","quarter|D5","quarter|F5","quarter|D5","quarter|rest","quarter|D5","quarter|D5","quarter|D5","quarter|rest","quarter|D5","quarter|C5","quarter|D5","quarter|rest","quarter|D5"],e="quarter|A1",n="quarter|B1",o="quarter|C1",a="quarter|D1",i=[e,"quarter|rest","quarter|rest","quarter|rest",o,"quarter|rest","quarter|rest","quarter|rest",a,"quarter|rest","quarter|rest","quarter|rest",n,"quarter|rest","quarter|rest","quarter|rest"];i.push(e,"quarter|rest",a,"quarter|rest",o,"quarter|rest",n,"quarter|rest",a,"quarter|rest",e,"quarter|rest",n,"quarter|rest",o,"quarter|rest");let s=["quarter|D5","quarter|rest","quarter|rest","quarter|rest","quarter|F5","quarter|rest","quarter|rest","quarter|rest","quarter|E5","quarter|rest","quarter|rest","quarter|rest","quarter|C5","quarter|rest","quarter|rest","quarter|rest"];s.push("quarter|D5","quarter|rest","quarter|D5","quarter|rest","quarter|F5","quarter|rest","quarter|F5","quarter|rest","quarter|E5","quarter|rest","quarter|E5","quarter|rest","quarter|C5","quarter|rest","quarter|C5","quarter|rest");let c=["quarter","quarter|rest"],u=[],l=[],p=[],g=[],m=[];new Array(5).fill(0).forEach(()=>u.push(...t)),new Array(8).fill(0).forEach(()=>l.push("quarter|rest")),new Array(4).fill(0).forEach(()=>p.push(...i)),new Array(4).fill(0).forEach(()=>g.push(...s)),new Array(4).fill(0).forEach(()=>m.push(...c));let h={...r,notes:{leftHand:[...l,...u],rightHand:[...l,...g],drum:[...m],arrows:[...l,...p]}},y=new T,k=y.load(h);return y.instruments[3].notes.forEach(f=>f.volumeLevel=0),k.resetTempo(),{conductor:y,player:k,arrowInstrumentIndex:3}};var ct=()=>{let r={timeSignature:[4,4],tempo:84,instruments:{leftHand:{name:"triangle",pack:"oscillators"},rightHand:{name:"square",pack:"oscillators"},drum:{name:"white",pack:"noises"},arrows:{name:"pink",pack:"noises"}}},t="whole|Ab4,C5,D#5",e="whole|Bb4,C#5,F5",n="whole|Db4,F4,G#4",o=["whole|rest",t,e,t,n,t,e,t,n,t,n,t,n,t,n,t,n],a=["quarter|C6","quarter|Ab5","quarter|F5","quarter|Eb5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","quarter|C6","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","quarter|C6","quarter|C6","quarter|Bb5","quarter|Ab5","eighth|F5","quarter|Eb5","eighth|rest","quarter|Bb5","quarter|rest","quarter|D#6","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","quarter|C6","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","eighth|Ab5","quarter|C6","quarter|C6","quarter|Ab5","eighth|C6","quarter|C6","quarter|Ab5","eighth|Bb5","eighth|C6","eighth|C6","eighth|C6","eighth|Bb5","eighth|Ab5","eighth|F5","quarter|Ab5","quarter|rest","eighth|Eb6","quarter|F6","quarter|Ab5","eighth|Bb5","eighth|C6","eighth|C6","eighth|C6","eighth|Bb5","eighth|Ab5","eighth|F5","quarter|Ab5","quarter|rest","eighth|Eb6","quarter|F6","quarter|Ab5","eighth|Bb5","eighth|C6","eighth|C6","eighth|C6","eighth|Bb5","eighth|Ab5","eighth|F5","quarter|Ab5","quarter|rest","eighth|Eb6","quarter|F6","quarter|Ab5","eighth|Bb5","eighth|C6","eighth|C6","eighth|C6","eighth|Bb5","eighth|Ab5","eighth|F5","quarter|C6","eighth|rest","half|Ab5"],i="eighth|A1",s="eighth|B1",c="eighth|C1",u="eighth|D1",l=["whole|rest",i,"eighth|Ab5",u,"eighth|Ab5",i,"eighth|Ab5",c,"eighth|rest",u,"eighth|Ab5",i,"eighth|Ab5",u,"eighth|Ab5",c,"eighth|rest",u,"eighth|rest",i,"eighth|rest",u,"eighth|rest",c,"eighth|rest",s,"eighth|rest","eighth|rest","eighth|A1,B1","eighth|rest","eighth|rest","eighth|C1,D1","eighth|rest"];l.push(i,"eighth|Ab5",u,"eighth|Ab5",i,"eighth|Ab5",c,"eighth|rest",u,"eighth|Ab5",i,"eighth|Ab5",u,"eighth|Ab5",c,"eighth|rest",u,"eighth|rest",i,"eighth|rest",u,"eighth|rest",c,"eighth|rest",s,"eighth|rest",c,"eighth|C6",s,"eighth|C6",u,"eighth|Ab5",i,"eighth|Ab5",i,"eighth|rest",u,"eighth|rest",c,"eighth|rest",i,"eighth|rest",c,"eighth|C6",s,"eighth|C6",u,"eighth|Ab5",i,"eighth|Ab5",i,"eighth|rest",u,"eighth|rest",c,"eighth|rest",i,"eighth|rest",c,"eighth|C6",s,"eighth|C6",u,"eighth|Ab5",i,"eighth|Ab5",i,"eighth|rest",u,"eighth|rest",c,"eighth|rest",i,"eighth|rest",c,"eighth|C6",s,"eighth|C6",u,"eighth|Ab5",i,"eighth|Ab5",i,"eighth|rest",s);let p={...r,notes:{leftHand:[...o],rightHand:[...a],arrows:[...l]}},g=new T,m=g.load(p);return g.instruments[0].notes.forEach(h=>{h.volumeLevel=.1}),g.instruments[3].notes.forEach(h=>{h.volumeLevel=0}),m.resetTempo(),{conductor:g,player:m}};var _=class{canvas;ctx;columns;columnWidth;items;songStartTime;songElapsedTime;itemHeight;speed;song;activeHits;activeMisses;constructor(t=4,e=100){let n=document.createElement("canvas");n.id="notes-canvas",n.width=800,n.height=600,document.body.appendChild(n),this.canvas=n,this.ctx=n.getContext("2d"),this.columns=t,this.columnWidth=this.canvas.width/this.columns,this.items=[],this.songStartTime=0,this.songElapsedTime=0,this.itemHeight=14,this.speed=e,this.activeHits={0:0,1:0,2:0,3:0},this.activeMisses={0:0,1:0,2:0,3:0}}start(t,e){this.song=e,this.songStartTime=t,this.songElapsedTime=0,this.items=[],this.clearCanvas()}addItem(t,e,n){if(e<0||e>=this.columns)throw new Error(`Invalid column: ${e}. Must be between 0 and ${this.columns-1}.`);this.items.push({text:t,column:e,startTime:n})}update(t){this.songElapsedTime=t-this.songStartTime,this.clearCanvas(),this.renderItems(),this.renderLines()}clearCanvas(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}renderItems(){this.items.forEach(t=>{let e=this.songElapsedTime-t.startTime*1e3;if(e>=-2e4){let n=t.column*this.columnWidth+this.columnWidth/2,o=e*this.speed+this.canvas.height-50;o<this.canvas.height&&this.drawText(t.text,n,o)}})}getItemY(t){return(this.songElapsedTime-t.startTime*1e3)*this.speed+this.canvas.height-50}renderLines(){this.ctx.strokeStyle="rgba(0, 255, 0, 1)",this.ctx.fillStyle="rgba(0, 255, 0, 1)";let t=["A","S","D","F"];this.ctx.fillText(`${t[0]}:/`,15,this.canvas.height-50);for(let e=1;e<this.columns;e++){let n=e*this.columnWidth;this.ctx.beginPath(),this.ctx.moveTo(n,0),this.ctx.lineTo(n,this.canvas.height),this.ctx.stroke(),this.ctx.fillText(`${t[e]}:/`,n+15,this.canvas.height-50)}this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height-70),this.ctx.lineTo(this.canvas.width,this.canvas.height-70),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height-30),this.ctx.lineTo(this.canvas.width,this.canvas.height-30),this.ctx.stroke();for(let e=0;e<this.columns;e++)if(this.activeHits[e]>0){let n=e*this.columnWidth;this.ctx.fillStyle="rgba(0, 255, 0, 0.5)",this.ctx.fillRect(n,0,this.columnWidth,this.canvas.height),this.activeHits[e]--}for(let e=0;e<this.columns;e++)if(this.activeMisses[e]>0){let n=e*this.columnWidth;this.ctx.fillStyle="rgba(255, 0, 0, 0.5)",this.ctx.fillRect(n,0,this.columnWidth,this.canvas.height),this.activeMisses[e]--}}drawText(t,e,n){this.ctx.font=`${this.itemHeight}px Arial`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="rgba(0, 255, 0, 1)",this.ctx.fillText(t,e,n)}destroy(){this.canvas.remove()}hitColumn(t){console.log("hit column"),this.activeHits[t]=5}missColumn(t){console.log("miss column"),this.activeMisses[t]=5}};var L="",I="",W=0,E=0,R=5,H=null,$=8e3,Lt=200,Ft=!0,Y=!1;function mt(){L=U(),I="",z(),Gt()}function z(){terminal.innerHTML=`> ${L}
> ${I}<span id="inputLine"></span>`,status.textContent=`score: ${W} | trace: ${E}/${R}`}function Gt(){clearTimeout(H),H=setTimeout(()=>{E++,gt(),pt(),dt(),Y||mt()},$)}function dt(){console.log("check GO",E,R),E>=R&&(terminal.innerHTML=`> CONNECTION TERMINATED
> FINAL SCORE: ${W}

`,console.log("GO",terminal.innerHTML),document.removeEventListener("keydown",ft),clearTimeout(H),Y=!0,gt("gameover"),clearInterval(cancelCatFront),catBack())}function pt(){document.body.classList.add("flash"),setTimeout(()=>document.body.classList.remove("flash"),100)}function ft(r){Ft||r.ctrlKey||r.metaKey||r.key.length===1&&(I+=r.key,L.startsWith(I)?(z(),I===L&&(W++,$=Math.max(1e3,$-Lt),mt())):(E++,pt(),I="",dt(),Y||z()))}var ut=["purr","whisker","tail","furball","napStack","yarn","paw","scratch","meow","claw","hiss"],lt=["connect","init","push","log","deploy","encrypt","chase","splice","compile","attack","trace"],ht=["'mouse'","'laser'","'bed'","'intruder'","'fish'","'data'","'firewall'","'sock'","'admin'"];function U(){let r=ut[Math.floor(Math.random()*ut.length)],t=lt[Math.floor(Math.random()*lt.length)];if(Math.random()<.5){let n=ht[Math.floor(Math.random()*ht.length)];return`${r}.${t}(${n})`}else return`${r}.${t}()`}var C=new(window.AudioContext||window.webkitAudioContext);function gt(r="success"){let t=C.createOscillator(),e=C.createGain();switch(t.connect(e),e.connect(C.destination),r){case"success":t.type="square",t.frequency.value=880,e.gain.setValueAtTime(.1,C.currentTime);break;case"fail":t.type="sawtooth",t.frequency.setValueAtTime(200,C.currentTime),e.gain.setValueAtTime(.2,C.currentTime);break;case"gameover":t.type="triangle",t.frequency.setValueAtTime(100,C.currentTime),e.gain.setValueAtTime(.3,C.currentTime);break}t.start(),t.stop(C.currentTime+.15)}document.addEventListener("keydown",ft);var v={},Mt=r=>{v[r]||(v[r]={}),!v[r].down&&(v[r].justUp=!1,v[r].down=!0,v[r].justDown=!0,setTimeout(()=>{v[r].justDown=!1},0))},Ot=r=>{v[r]&&(v[r].justUp=!0,v[r].down=!1,v[r].justDown=!1,setTimeout(()=>{v[r].justUp=!1},0))};document.addEventListener("keydown",r=>{Mt(r.key)});document.addEventListener("keyup",r=>{Ot(r.key)});var B=v;var q=class{canvas;ctx;text;animationFrameId=null;offset=0;yOffset;constructor(t,e){let n=document.createElement("canvas");n.id="wavyCanvas",document.body.appendChild(n),this.canvas=n,this.ctx=n.getContext("2d"),this.text=t,this.yOffset=e,this.canvas.width=800,this.canvas.height=400,this.animate()}drawText(){let{ctx:t,canvas:e,text:n,offset:o}=this;t.clearRect(0,0,e.width,e.height),t.font="30px monospace",t.textAlign="center",t.fillStyle="#00ff00";let a=e.width/2,i=e.height/2+this.yOffset;for(let s=0;s<n.length;s++){let c=n[s],u=a-n.length*20/2+s*20,l=i+Math.sin((s+o)*.5)*10;t.fillText(c,u,l)}}animate=()=>{this.offset+=.1,this.drawText(),this.animationFrameId=requestAnimationFrame(this.animate)};stop(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}destroy(){this.canvas.remove()}};var Vt=`
    _______
  _/_______\\_
    (     )
   _ >   < /
    <     >
    --------
      //
      \\\\//

`,Rt=`
    _______
  _/_______\\_
    (     )
   \\ >   < _
    <     >
    --------
       \\\\
     \\\\//

`,Ht=`
    _______
  _/_______\\_
    (     )
   _ >   < _
    <     >
    --------
       ||
       ||
       ||
`;function bt(){let r=0,t=document.querySelector("#ascii-cat"),e=setInterval(()=>{r===0||r===2?(r++,t.innerHTML=`<pre>${Ht}</pre>`):r===1?(r++,t.innerHTML=`<pre>${Vt}</pre>`):(r=0,t.innerHTML=`<pre>${Rt}</pre>`)},500);return()=>{clearInterval(e),t.innerHTML=""}}var x={hits:0,misses:0,total:0},b=null,K,j,yt=(r,t)=>{K=new q(r.name,0),j=bt(),x={hits:0,misses:0,total:r.conductor.instruments[3].notes.filter(i=>i.pitch&&(i.pitch.includes("A1")||i.pitch.includes("B1")||i.pitch.includes("C1")||i.pitch.includes("D1"))).reduce((i,s)=>i+(Array.isArray(s.pitch)?s.pitch.length:1),0)},r.conductor.setOnFinishedCallback(()=>zt()),console.log("start song",x),r.conductor.setTempo(t),r.player.resetTempo(),b=new _(4,.4),b.start(performance.now(),r);let e=i=>{switch(i){case"A1":return 0;case"B1":return 1;case"C1":return 2;case"D1":return 3;default:return-1}},n=[],o=i=>{!i.pitch||e(i.pitch)===-1||(b?.addItem(U(),e(i.pitch),i.startTime),i.column=e(i.pitch),n.push(i))};r.conductor.instruments[3].notes.forEach(i=>{Array.isArray(i.pitch)?i.pitch.forEach(s=>o({...i,pitch:s})):o(i)});function a(){b&&(b.update(performance.now()),B.a?.justDown&&(console.log("a check"),n.forEach(i=>{i.column===0&&F(i)})),B.s?.justDown&&(console.log("s check"),n.forEach(i=>{i.column===1&&F(i)})),B.d?.justDown&&(console.log("s check"),n.forEach(i=>{i.column===2&&F(i)})),B.f?.justDown&&(console.log("s check"),n.forEach(i=>{i.column===3&&F(i)})),n.forEach(i=>{!i.hit&&!i.miss&&(b?.getItemY(i)??0)>(b?.canvas?.height??900)&&(x.misses++,i.miss=!0,console.log("MISS Out of bounds",i.column,x),b?.missColumn(i.column))}),requestAnimationFrame(a))}a(),r.player.play()};function F(r){let t=b?.getItemY(r)??0,e=(b?.canvas?.height??800)-30,n=(b?.canvas?.height??800)-70;t<e&&t>n&&!r.hit&&!r.miss&&(x.hits++,r.hit=!0,console.log("HIT",r.column,x),b?.hitColumn(r.column)),t<e+50&&t>n-50&&!r.hit&&!r.miss&&(x.misses++,r.miss=!0,console.log("MISS",r.column,x),b?.missColumn(r.column))}function $t(r,t){let{hits:e,misses:n,total:o}=t,a="o_O",i=e/o*100;n===0?a="A+":i>=90?a="A":i>=80?a="B":i>=70?a="C":i>=60?a="D":i>=50?a="F":i>=30&&(a="F-");let s=document.createElement("div");s.id="level-state-ui",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.display="flex",s.style.flexDirection="column",s.style.justifyContent="center",s.style.alignItems="center",s.style.color="var(--green-700)",s.style.fontSize="24px",s.style.zIndex="1000",s.innerHTML=`
    <div style="text-align: center;">
      <p>Level Complete!</p>
      <p>Hits: ${e}</p>
      <p>Misses: ${n}</p>
      <p>Grade: ${a}</p>
      <button id="close-level-state-ui" style="padding: 10px 20px; font-size: 18px;">Close</button>
    </div>
  `,document.body.appendChild(s),document.getElementById("close-level-state-ui")?.addEventListener("click",()=>{document.body.removeChild(s),r()})}function zt(){console.log("end level"),b?.destroy(),b=null,j?.(),K?.destroy(),K=null,j=null,$t(()=>{G()},x)}var Wt=[{name:"Basic Baps",tempos:[60,80,100],factory:at},{name:"Catnip",tempos:[70,90,110],factory:ct}];function G(){let r=document.body,t=document.createElement("div");t.className="container";let e=document.createElement("h2");e.textContent="Attack Pattern",t.appendChild(e);let n=document.createElement("div");n.className="song-list",t.appendChild(n);let o=document.createElement("div");o.className="tempo-list",o.style.display="none",t.appendChild(o);let a=document.createElement("p");a.id="output",t.appendChild(a),Wt.forEach(s=>{let c=document.createElement("button");c.textContent=s.name,c.className="song-button",c.addEventListener("click",()=>{i(s)}),n.appendChild(c)});function i(s){o.innerHTML="",o.style.display="block",n.style.display="none",s.tempos.forEach(c=>{let u=document.createElement("button");u.textContent=`${c} BPM`,u.className="tempo-button",u.addEventListener("click",()=>{a.textContent=`You selected: ${s.name} at ${c} BPM`;let l=s.factory();it(),l.name=s.name,yt(l,c),Yt(t)}),o.appendChild(u)}),a.textContent=`You selected: ${s.name}`}return r.appendChild(t),t}function Yt(r){r.remove()}var J=document.getElementById("terminal"),Re=document.getElementById("status");function Ut(r,t,e=500){let n=0;function o(){n<r.length?(J.textContent+=r[n++]+`
`,setTimeout(o,e)):t()}o()}function Kt(){let r=["BL@CK C@T SYSTEM v0.13","Initializing...","Patching firewall claws...","Uploading furball payload...","Injecting pawprints...",`Ready. Bap to start.
`];J.textContent="",Ut(r,()=>{booting=!1;let t=0,e,n,o=()=>{t?(G(),n&&n(),e&&e.destroy(),document.removeEventListener("keydown",o),document.removeEventListener("click",o)):(J.textContent="",e=new q("Bl@ck H@t // Bl@ck C@t",0),n=Q(),et()),t++};document.addEventListener("keydown",o),document.addEventListener("click",o)},400)}Kt();})();
